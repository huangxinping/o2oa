o2.require("MWF.widget.Dialog",null,!1),o2.xDesktop.Dialog=o2.DDL=new Class({Extends:o2.widget.Dialog,options:{maxHeightPercent:"98%"},_markShow:function(){if(this.options.mark){if(!this.markNode){var t=MWF.getMarkSize(this.options.maskNode),o=this.options.container||$(document.body);this.markNode=new Element("iframe",{styles:this.css.mark}).inject(o),this.markNode.set("styles",{height:t.y,width:t.x}),this.markNode_up||(this.markNode_up=new Element("div",{styles:this.css.mark}).inject(o)),this.markNode_up.set("styles",{height:t.y,width:t.x})}this.markNode.setStyle("display","block")}},getDialogNode:function(){this.width=this.options.width,this.height=this.options.height,this.node.set("styles",this.css.from);var t=this.options.container||$(document.body);this.node.inject(t),this.title=this.node.getElement(".MWF_dialod_title"),this.titleCenter=this.node.getElement(".MWF_dialod_title_center"),this.titleText=this.node.getElement(".MWF_dialod_title_text"),this.titleAction=this.node.getElement(".MWF_dialod_title_action"),this.content=this.node.getElement(".MWF_dialod_content"),this.bottom=this.node.getElement(".MWF_dialod_bottom"),this.resizeNode=this.node.getElement(".MWF_dialod_bottom_resize"),this.button=this.node.getElement(".MWF_dialod_button"),this.options.buttonList&&0!==this.options.buttonList.length||this.options.buttons?(this.okButton=this.node.getElement(".MWF_dialod_ok_button"),this.cancelButton=this.node.getElement(".MWF_dialod_cancel_button")):(this.button.setStyle("display","none"),this.buttonDisable=!0),this.backAction=this.node.getElement(".MWF_dialod_Action_back"),this.options.isTitle||(this.title.destroy(),this.title=null,this.titleCenter=null,this.titleRefresh=null,this.titleText=null,this.titleAction=null),this.title&&this.setTitleEvent(),this.content&&this.getContent(),this.titleAction&&this.getAction(),this.resizeNode&&this.setResizeNode(),this.content&&this.setContentSize(),this.backAction&&this.backAction.addEvent("click",this.close.bind(this))},getButton:function(){for(i in this.options.buttons)new Element("input",{type:"button",value:i,styles:this.css.button,class:"mainColor_bg",events:{click:this.options.buttons[i].bind(this)}}).inject(this.button);this.options.buttonList&&this.options.buttonList.each(function(t){var o,i=this.css.button;"ok"===t.type&&this.css.okButton&&(i=this.css.okButton),"cancel"===t.type&&this.css.cancelButton&&(i=this.css.cancelButton),t.styles&&(i=t.styles),"ok"===t.type&&this.okButton?(o=this.okButton).show():"cancel"===t.type&&this.cancelButton?(o=this.cancelButton).show():o=t.tag?new Element(t.tag,{}).inject(this.button):new Element("input",{type:"button"}).inject(this.button),"button"===o.get("type")?o.set({value:t.text,title:t.title,styles:i,class:"cancel"!==t.type?"mainColor_bg":"",events:{click:function(o){t.action.call(this,this,o)}.bind(this)}}):o.set({text:t.text,title:t.title,styles:i,class:"cancel"!==t.type?"mainColor_bg":"",events:{click:function(o){t.action.call(this,this,o)}.bind(this)}})}.bind(this))},setTitleEvent:function(){var t;this.options.isMove&&(layout.app&&(t=layout.app.content),layout.desktop.currentApp&&(t=layout.desktop.currentApp.content),this.containerDrag=new Drag.Move(this.node,{handle:this.title,container:this.options.positionNode||this.options.container||this.markNode||t,snap:5}))},getAction:function(){this.options.isClose&&(this.closeAction=new Element("div",{styles:this.css.closeAction}).inject(this.titleAction),this.closeAction.addEvent("click",this.close.bind(this))),this.options.isMax&&(this.maxAction=new Element("div",{styles:this.css.maxAction}).inject(this.titleAction),this.maxAction.addEvent("click",this.maxSize.bind(this)),this.restoreAction=new Element("div",{styles:this.css.restoreAction}).inject(this.titleAction),this.restoreAction.hide(),this.restoreAction.addEvent("click",this.restoreSize.bind(this)),this.title&&this.title.addEvent("dblclick",function(){this.switchMax()}.bind(this)))},switchMax:function(){this.isMax?this.restoreSize():this.maxSize()},maxSize:function(){this.oldNodeSize||(this.oldNodeSize={width:this.nodeWidth,height:this.nodeHeight}),this.oldContentSize||(this.oldContentSize={width:this.contentWidth,height:this.contentHeight});var t=$(document.body);layout.desktop.currentApp?t=layout.desktop.currentApp.content:this.options.container&&this.options.container.getSize().y<$(document.body).getSize().y&&(t=this.options.container);var o=t.getSize();this.options.width=o.x,this.options.height=o.y,this.setContentSize(o.y,o.x),this.node.setStyles({width:o.x+"px",height:o.y+"px",top:"0px",left:"0px"}),this.maxAction.setStyle("display","none"),this.restoreAction.setStyle("display",""),this.isMax=!0,this.fireEvent("max")},restoreSize:function(){this.contentHeight=this.oldContentSize.height,this.contentWidth=this.oldContentSize.width,this.nodeHeight=this.oldNodeSize.height,this.nodeWidth=this.oldNodeSize.width,this.content.setStyles(this.oldContentSize),this.node.setStyles(this.oldNodeSize),this.reCenter(),this.maxAction.setStyle("display",""),this.restoreAction.setStyle("display","none"),this.isMax=!1,this.fireEvent("restore")},reCenter:function(){var t;t=null===this.node.offsetParent?this.node.measure((function(){return this.getSize()})):this.node.getSize(),this.options.positionWidth&&(t.x=parseInt(this.options.positionWidth)),this.options.positionHeight&&(t.y=parseInt(this.options.positionHeight));var o=$(document.body);this.options.positionNode&&this.options.positionNode.getSize().y<$(document.body).getSize().y?o=this.options.positionNode:layout.desktop.currentApp?o=layout.desktop.currentApp.content:this.options.container&&this.options.container.getSize().y<$(document.body).getSize().y&&(o=this.options.container);var i=o2.getCenter(t,o,o);i.y<(this.options.minTop||0)&&(i.y=this.options.minTop||0),this.options.top=i.y,this.options.left=i.x,this.css.to.top=this.options.top+"px",this.css.to.left=this.options.left+"px",this.node.setStyles({top:this.css.to.top,left:this.css.to.left})},getOffsetY:function(t){return(t.getStyle("margin-top").toInt()||0)+(t.getStyle("margin-bottom").toInt()||0)+(t.getStyle("padding-top").toInt()||0)+(t.getStyle("padding-bottom").toInt()||0)+(t.getStyle("border-top-width").toInt()||0)+(t.getStyle("border-bottom-width").toInt()||0)},getOffsetX:function(t){return(t.getStyle("margin-left").toInt()||0)+(t.getStyle("margin-right").toInt()||0)+(t.getStyle("padding-left").toInt()||0)+(t.getStyle("padding-right").toInt()||0)+(t.getStyle("border-left-width").toInt()||0)+(t.getStyle("border-right-width").toInt()||0)},getMarginY:function(t){return(t.getStyle("margin-top").toInt()||0)+(t.getStyle("margin-bottom").toInt()||0)},getMarginX:function(t){return(t.getStyle("margin-left").toInt()||0)+(t.getStyle("margin-right").toInt()||0)},setContentHeightAuto:function(){var t=this.getMaxHeight(),o=0,i=0;this.title&&(o=o+this.getOffsetY(this.title)+this.title.getSize().y),this.bottom&&(o=o+this.getOffsetY(this.bottom)+this.bottom.getSize().y),this.button&&!this.buttonDisable&&(o=o+this.getOffsetY(this.button)+this.button.getSize().y),i=this.content?(o+=this.getMarginY(this.content))+this.content.getSize().y:o,"number"===typeOf(t)&&i>t?(this.options.height=t,this.options.contentHeight=null,this.options.fromTop=this.options.fromTop.toFloat()-o/2,this.options.top=this.options.top.toFloat()-o/2,this.css.to.height=t+"px",this.css.to.top=this.options.top+"px",this.css.from.top=this.options.fromTop+"px",this.node.setStyles({height:t}),this.contentHeight=t-o,this.content&&this.content.setStyles({height:t-o,"overflow-y":"auto"})):(this.options.height=i,this.options.contentHeight=null,this.options.fromTop=this.options.fromTop.toFloat()-o/2,this.options.top=this.options.top.toFloat()-o/2,this.css.to.height=i+"px",this.css.to.top=this.options.top+"px",this.css.from.top=this.options.fromTop+"px",this.node.setStyles({height:i}),this.contentHeight=i-o,this.content&&this.content.setStyles({height:i-o,"overflow-y":"hidden"}))},getMaxHeight:function(){var t,o;if(this.options.maxHeightPercent&&(t=this.options.maxHeightPercent,"string"===typeOf(t)&&"%"===t.substr(t.length-1,1))){var i=(this.options.positionNode||this.options.container||$(document.body)).getSize().y;(t=parseInt(i*parseInt(t)/100))+(this.options.minTop||0)>i&&(t=i-this.options.minTop)}return this.options.maxHeight&&"NaN"!==parseFloat(this.options.maxHeight).toString()?(o=parseFloat(this.options.maxHeight),"number"===typeOf(t)&&(o=Math.min(o,t))):"number"===typeOf(t)&&(o=t),o},getNodeSize:function(){return{height:this.nodeHeight+"px",width:this.nodeWidth+"px"}},getContentSize:function(t,o){var i,e;if(t)this.nodeHeight=t;else if(this.options.contentHeight)i=t=this.options.contentHeight.toFloat(),this.contentHeight=t;else{t=this.options.height.toFloat();var s=this.getMaxHeight();"number"===typeOf(s)&&s<t&&(t=s),this.nodeHeight=t}o?this.nodeWidth=o:this.options.contentWidth?(e=o=this.options.contentWidth.toFloat(),this.contentWidth=o):(o=this.options.width.toFloat(),this.nodeWidth=o);var n,h=0;if(this.title){var l=this.title.getSize().y,p=this.title.getStyle("padding-top").toFloat(),a=this.title.getStyle("padding-bottom").toFloat(),d=this.title.getStyle("margin-top").toFloat(),g=this.title.getStyle("margin-bottom").toFloat();h+=l+p+a+d+g}if(this.bottom){var c=this.bottom.getSize().y,r=this.bottom.getStyle("padding-top").toFloat(),f=this.bottom.getStyle("padding-bottom").toFloat(),m=this.bottom.getStyle("margin-top").toFloat(),y=this.bottom.getStyle("margin-bottom").toFloat();h+=c+r+f+m+y}if(this.button&&!this.buttonDisable){var u=this.button.getSize().y,S=this.button.getStyle("padding-top").toFloat(),b=this.button.getStyle("padding-bottom").toFloat(),x=this.button.getStyle("margin-top").toFloat(),F=this.button.getStyle("margin-bottom").toFloat();h+=u+S+b+x+F}var w=this.content.getStyle("padding-top").toFloat(),v=this.content.getStyle("padding-bottom").toFloat(),W=this.content.getStyle("margin-top").toFloat(),z=this.content.getStyle("margin-bottom").toFloat();if(h+=w+v+W+z,i?i=i+h+2:t-=h,n=this.content.getStyle("padding-left").toFloat()+this.content.getStyle("padding-right").toFloat()+this.content.getStyle("margin-left").toFloat()+this.content.getStyle("margin-right").toFloat(),e?e+=n:o-=n,i?(this.nodeHeight=i,this.options.height=i,this.options.contentHeight=null,this.options.fromTop=this.options.fromTop.toFloat()-h/2,this.options.top=this.options.top.toFloat()-h/2,this.css.to.height=i+"px",this.css.to.top=this.options.top+"px",this.css.from.top=this.options.fromTop+"px"):this.contentHeight=t,e?(this.nodeWidth=e,this.options.width=e,this.options.contentWidth=null,this.options.fromLeft=this.options.fromLeft.toFloat()-n/2,this.options.left=this.options.left.toFloat()-n/2,this.css.to.width=e+"px",this.css.to.left=this.options.left+"px",this.css.from.left=this.options.fromLeft+"px"):this.contentWidth=o,!t||t<0){this.content.setStyles({overflow:"hidden",height:"auto",width:o+"px"});var H=(t=this.content.getSize().y)+l+p+a+d+g;H=(H=(H=H+c+r+f+m+y)+u+S+b+x+F)+w+v+W+z,this.css.to.height=H}return{height:t+"px",width:o+"px"}},setContentHeight:function(t){var o;if(t)this.nodeHeight=t;else if(this.options.contentHeight)o=t=this.options.contentHeight.toFloat(),this.contentHeight=t;else{t=this.options.height.toFloat();var i=this.getMaxHeight();"number"===typeOf(i)&&i<t&&(t=i),this.nodeHeight=t}var e=0;if(this.title){var s=this.title.getSize().y,n=this.title.getStyle("padding-top").toFloat(),h=this.title.getStyle("padding-bottom").toFloat(),l=this.title.getStyle("margin-top").toFloat(),p=this.title.getStyle("margin-bottom").toFloat();e+=s+n+h+l+p}if(this.bottom){var a=this.bottom.getSize().y,d=this.bottom.getStyle("padding-top").toFloat(),g=this.bottom.getStyle("padding-bottom").toFloat(),c=this.bottom.getStyle("margin-top").toFloat(),r=this.bottom.getStyle("margin-bottom").toFloat();e+=a+d+g+c+r}if(this.button&&!this.buttonDisable){var f=this.button.getSize().y,m=this.button.getStyle("padding-top").toFloat(),y=this.button.getStyle("padding-bottom").toFloat(),u=this.button.getStyle("margin-top").toFloat(),S=this.button.getStyle("margin-bottom").toFloat();e+=f+m+y+u+S}var b=this.content.getStyle("padding-top").toFloat(),x=this.content.getStyle("padding-bottom").toFloat(),F=this.content.getStyle("margin-top").toFloat(),w=this.content.getStyle("margin-bottom").toFloat();if(e+=b+x+F+w,o?o=o+e+2:t-=e,o?(this.nodeHeight=o,this.options.height=o,this.options.contentHeight=null,this.options.fromTop=this.options.fromTop.toFloat()-e/2,this.options.top=this.options.top.toFloat()-e/2,this.css.to.height=o+"px",this.css.to.top=this.options.top+"px",this.css.from.top=this.options.fromTop+"px"):this.contentHeight=t,!t||t<0){this.content.setStyles({overflow:"hidden",height:"auto"});var v=(t=this.content.getSize().y)+s+n+h+l+p;v=(v=(v=v+a+d+g+c+r)+f+m+y+u+S)+b+x+F+w,this.css.to.height=v}else this.content.setStyles({height:t})},setContentWidthAuto:function(){var t=this.options.maxWidth||"100%";if("string"===typeOf(t)&&"%"===t.substr(t.length-1,1)){var o=(this.options.positionNode||this.options.container||$(document.body)).getSize().x;t=parseInt(o*parseInt(t)/100)}var i=0,e=0;(e=this.content?(i+=this.getMarginX(this.content))+this.content.getSize().x:i)>t?(this.nodeWidth=t,this.options.width=t,this.options.contentWidth=null,this.options.fromLeft=this.options.fromLeft.toFloat()-i/2,this.options.left=this.options.left.toFloat()-i/2,this.css.to.width=t+"px",this.css.to.left=this.options.left+"px",this.css.from.left=this.options.fromLeft+"px",this.node.setStyles({width:t}),this.contentWidth=t-this.getOffsetX(this.content),this.content&&this.content.setStyles({width:this.contentWidth,"overflow-x":"auto"})):(this.nodeWidth=e,this.options.width=e,this.options.contentHeight=null,this.options.fromLeft=this.options.fromLeft.toFloat()-i/2,this.options.left=this.options.left.toFloat()-i/2,this.css.to.width=e+"px",this.css.to.left=this.options.left+"px",this.css.from.left=this.options.fromLeft+"px",this.node.setStyles({width:e}),this.contentWidth=e-this.getOffsetX(this.content),this.content&&this.content.setStyles({width:this.contentWidth,"overflow-x":"hidden"}))},setContentWidth:function(t){var o;t?this.nodeWidth=t:this.options.contentWidth?(o=t=this.options.contentWidth.toFloat(),this.contentWidth=t):(t=this.options.width.toFloat(),this.nodeWidth=t);var i;if(i=this.content.getStyle("padding-left").toFloat()+this.content.getStyle("padding-right").toFloat()+this.content.getStyle("margin-left").toFloat()+this.content.getStyle("margin-right").toFloat(),o)o+=i;else{var e=t;t-=i}o?(this.nodeWidth=o,this.options.width=o,this.options.contentWidth=null,this.css.to.left=this.options.left+"px",this.css.from.left=this.options.fromLeft+"px",this.css.to.width=o+"px",this.options.fromLeft=this.options.fromLeft.toFloat()-i/2,this.options.left=this.options.left.toFloat()-i/2,this.node.setStyle("width",o)):(this.contentWidth=t,this.node.setStyle("width",e)),this.content.setStyles({width:t})},setContentSize:function(t,o){var i=t;i||(i=this.options.contentHeight?this.options.contentHeight:this.height);var e=o;e||(e=this.options.contentWidth?this.options.contentWidth:this.width),"auto"===i||"auto"===e?("auto"===i?this.setContentHeightAuto():this.setContentHeight(t),"auto"===e?this.setContentWidthAuto():this.setContentWidth(o)):(this.content.setStyles(this.getContentSize(t,o)),this.content.setStyle("width","auto"))}}),o2.DL.open=function(t){var o;t||(t={}),t.style||(t.style="user"),t.duration||(t.duration=200),!1!==t.isClose&&(t.isClose=!0),t.width&&"auto"!=t.width||t.contentWidth||t.content&&(t.content.show(),o=t.content.getComputedSize(),t.contentWidth=o.totalWidth.toFloat()),t.height&&"auto"!=t.height||t.contentHeight||t.content&&(o||(t.content.show(),o=t.content.getComputedSize()),t.contentHeight=o.totalHeight.toFloat()+2),t.width||t.contentWidth||(t.width=300),t.height||t.contentHeight||(t.height=150),!t.container&&layout&&layout.desktop.currentApp&&(t.container=layout.desktop.currentApp.content);var i=t.positionNode||t.container||$(document.body);if("auto"!==t.width&&"auto"!==t.height){if("string"==typeOf(t.width)&&1<t.width.length&&"%"==t.width.substr(t.width.length-1,1)&&(t.width=parseInt(i.getSize().x*parseInt(t.width,10)/100,10)),"string"==typeOf(t.height)&&1<t.height.length&&"%"==t.height.substr(t.height.length-1,1)&&(t.height=parseInt(i.getSize().y*parseInt(t.height,10)/100,10)),void 0===t.top&&void 0===t.left){var e=o2.getCenter({x:t.width||t.contentWidth,y:t.height||t.contentHeight+120},i,i);t.top=e.y<0?0:e.y,t.left=e.x<0?0:e.x}if(void 0===t.fromTop&&void 0===t.fromLeft){e=o2.getCenter({x:0*(t.width||t.contentWidth),y:0*(t.height||t.contentHeight+120)},i,i);t.fromTop=e.y<0?0:e.y,t.fromLeft=e.x<0?0:e.x}t.offset&&(t.offset.y&&(t.top=t.top+t.offset.y.toInt(),t.fromTop=t.fromTop+t.offset.y.toInt()),t.offset.x&&(t.left=t.left+t.offset.x.toInt(),t.fromLeft=t.fromLeft+t.offset.x.toInt())),t.top<0&&(t.top=0),t.left<0&&(t.left=0),t.fromTop<0&&(t.fromTop=0),t.fromLeft<0&&(t.fromLeft=0)}else void 0===t.top&&(t.top=0),void 0===t.left&&(t.left=0),void 0===t.fromTop&&(t.fromTop=0),void 0===t.fromLeft&&(t.fromLeft=0);t.mark=!(!1===t.mask);var s=new o2.DDL(t);return"auto"!==t.width&&"auto"!==t.height||s.reCenter(),s.show(),s};