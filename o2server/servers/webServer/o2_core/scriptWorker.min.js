window=self,window.addEvent=function(){},self.window=window,window.execScript=function(text){return eval(text)},this.document||(document={window:self,head:"head",location:"url",documentElement:{style:{color:""}},html:{style:{color:""}},readyState:"loaded",addEventListener:function(){},removeEventListener:function(){},createElement:function(){return{contains:null,getAttribute:function(){return null},cloneNode:function(){return{firstChild:{childNodes:{length:1},value:"s"}}},firstChild:{childNodes:{length:1},value:"s"},getAttributeNode:function(){return null},childNodes:[""],style:{},appendChild:function(){}}}}),self.importScripts("../o2_core/o2.min.js"),layout=window.layout||{},layout.desktop=layout,layout.desktop.type="app";var locate=window.location;layout.protocol=locate.protocol,layout.inBrowser=!0,layout.session=layout.session||{},layout.debugger=-1!==locate.href.toString().indexOf("debugger"),layout.anonymous=-1!==locate.href.toString().indexOf("anonymous"),o2.xApplication=o2.xApplication||{},o2.xDesktop=o2.xDesktop||{},o2.xDesktop.requireApp=function(e,t,n,o){o2.requireApp(e,t,n,o)},layout.openApplication=function(){},layout.refreshApp=function(){},layout.load=function(){},layout.readys=[],layout.addReady=function(){for(var e=0;e<arguments.length;e++)"function"===o2.typeOf(arguments[e])&&layout.readys.push(arguments[e])},o2.addReady((function(){var e=function(e,t){layout.serviceAddressList=e,layout.centerServer=t,layout.desktop.serviceAddressList=e,layout.desktop.centerServer=t},t=function(t){if("auto"===layout.config.app_protocol&&(layout.config.app_protocol=window.location.protocol),layout.config.configMapping&&(layout.config.configMapping[window.location.host]||layout.config.configMapping[window.location.hostname])){var n=layout.config.configMapping[window.location.host]||layout.config.configMapping[window.location.hostname];n.servers?(layout.serviceAddressList=n.servers,layout.desktop.serviceAddressList=n.servers,n.center&&(center="array"===o2.typeOf(n.center)?n.center[0]:n.center),layout.centerServer=center,layout.desktop.centerServer=center,t&&t()):(n.center&&(layout.config.center="array"===o2.typeOf(n.center)?n.center:[n.center]),o2.xDesktop.getServiceAddress(layout.config,function(n,o){e(n,o),t&&t()}.bind(this)))}else o2.xDesktop.getServiceAddress(layout.config,function(n,o){e(n,o),t&&t()}.bind(this))},n=function(){var e={name:"anonymous",roleList:[]};o2.Actions.get("x_organization_assemble_authentication").getAuthentication(function(t){e=t.data}.bind(this),null,!1),function(e){for(e&&(layout.user=e,layout.session=layout.session||{},layout.session.user=e,layout.session.token=e.token,layout.desktop.session=layout.session);layout.readys&&layout.readys.length;)layout.readys.shift().apply(window)}(e)};layout.config=null;var o=!1,r=!1,i=!1,a=o2.session.path+"/lp/"+o2.language+".js",s=function(){r=!0;o2.require(["o2.xDesktop.$all"],{onSuccess:function(){i=!0,o&&i&&r&&t((function(){n()}))}})};o2.LP?s():o2.load(a,s),o2.getJSON("../x_desktop/res/config/config.json",(function(e){layout.config=e,(o=!0)&&i&&r&&t((function(){n()}))}))}));var _worker=self;layout.addReady((function(){window.isCompletionEnvironment=!0,_worker.runtimeEnvironment={},_worker.createEnvironment=function(e,t){return new Promise((function(n,o){o2.xhr_get(t,(function(t){t.responseText&&(_worker.createRuntime(e,t.responseText),n&&n())}),(function(e){o(e)}))}))},_worker.createRuntime=function(e,t){var n="o2.Macro.swapSpace.tmpMacroCompletionFunction = function (){\n"+t+"\nreturn bind;\n};";Browser.exec(n);var o=o2.Macro.swapSpace.tmpMacroCompletionFunction();_worker.runtimeEnvironment[e]={environment:o,exec:function(e){try{return o2.Macro.exec(e,this.environment)}catch(e){return null}}}},_worker.getCompletionEnvironment=function(e){return _worker.runtimeEnvironment[e]?Promise.resolve():new Promise((function(t){o2.require("o2.xScript.Macro",(function(){switch(e){case"service":t(_worker.getServiceCompletionEnvironment());break;case"server":t(_worker.getServerCompletionEnvironment());break;case"all":t(_worker.getAllCompletionEnvironment());break;default:t(_worker.getDefaultCompletionEnvironment())}}))}))},_worker.getServiceCompletionEnvironment=function(){return _worker.createEnvironment("service","../x_desktop/js/initalServiceScriptSubstitute.js")},_worker.getServerCompletionEnvironment=function(){return _worker.createEnvironment("server","../x_desktop/js/initalScriptSubstitute.js")},_worker.getDefaultCompletionEnvironment=function(){return new Promise((function(e){o2.getJSON("../o2_core/o2/widget/$JavascriptEditor/environment.json",(function(t){json=t,_worker.runtimeEnvironment.web=new o2.Macro.FormContext(json),e&&e()}))}))},_worker.getAllCompletionEnvironment=function(){var e=[_worker.getServiceCompletionEnvironment(),_worker.getServerCompletionEnvironment(),_worker.getDefaultCompletionEnvironment()];return Promise.all(e).then((function(){if(_worker.runtimeEnvironment.service&&_worker.runtimeEnvironment.server&&_worker.runtimeEnvironment.web){var e=Object.merge(_worker.runtimeEnvironment.service.environment,_worker.runtimeEnvironment.server.environment,_worker.runtimeEnvironment.web.environment);_worker.runtimeEnvironment.all={environment:e,exec:function(e){try{return o2.Macro.exec(e,this.environment)}catch(e){return null}}}}}))},_worker.getMonacoCompletions=function(e,t,n){var o=[];return e="array"==o2.typeOf(e)?e[0]:e,Object.keys(e).each((function(r){if("__type__"!=r){var i=typeOf(e[r]),a=Object.clone(t);switch(i){case"function":for(var s=e[r].length,u=r+"(",c=1;c<=s;c++)u+=c==s?"par"+c:"par"+c+", ";u+=")",r+="()",o.push({label:r,kind:1,insertText:u,detail:i,range:a});break;default:var l=r,p=r,f=3;if(e[r]){var d="array"==i&&e[r][0]&&e[r][0].__type__?e[r][0].__type__:e[r].toString(),y=d.indexOf(":");-1!=y&&(i=d.substr(0,y),d=d.substr(y+1)),"object array"==(e.__type__?e.__type__.substr(0,e.__type__.indexOf(":")):o2.typeOf(e))&&("]"!==n.substr(-1)&&(l="[0]."+r,a.startColumn=a.startColumn-1),p="."+p)}switch(i){case"array":case"object array":f=15,r+="[]"}o.push({label:r,filterText:p,key:r,kind:f,insertText:l,detail:i,documentation:d,range:a})}}})),o},_worker.getAceCompletions=function(e,t,n){var o=[];return e="array"==o2.typeOf(e)?e[0]:e,Object.keys(e).each((function(r){if("__type__"!=r){var i=typeOf(e[r]),a=(t&&Object.clone(t),0);switch(i){case"function":for(var s=e[r].length,u=r+"(",c=1;c<=s;c++)u+=c==s?"par"+c:"par"+c+", ";u+=")",r+="()",o.push({caption:r,value:u,score:3,meta:i,type:i,docText:r});break;default:var l=r,p=r;if(e[r]){var f="array"==i&&e[r][0].__type__?e[r][0].__type__:e[r].toString(),d=f.indexOf(":");-1!=d&&(i=f.substr(0,d),f=f.substr(d+1)),"object array"==(e.__type__?e.__type__.substr(0,e.__type__.indexOf(":")):o2.typeOf(e))&&("]"!==n.substr(-1)&&(l="[0]."+r,a=-1),p="."+p)}"array"!=i&&"object array"!=i||(r+="[]"),o.push({caption:r,value:l,score:3,meta:i,type:i,docText:f,offset:a})}}})),o},_worker.overwriteRequest=function(){if(!_worker.isOverwriteRequest){if(_worker.XMLHttpRequest){var e=XMLHttpRequest.prototype.send,t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,n){if(this.continueRequest=!1,n){var o=n;-1==o.indexOf(":")&&(o="http://"+o);var r=new URI(o),i=r.get("file"),a=i.substr(i.indexOf(".")+1).toLowerCase();if("json"==a||"js"==a||"html"==a)return this.continueRequest=!0,t.apply(this,arguments)}},XMLHttpRequest.prototype.send=function(){if(this.continueRequest)return e.apply(this,arguments)}}if(_worker.fetch){var n=_worker.fetch;_worker.fetch=function(e){var t=e;"string"==o2.typeOf(e)?t=e:Object.getPrototypeOf(e)==NativeRequest.prototype&&(t=e.url),-1==t.indexOf(":")&&(t="http://"+t);var o=new URI(t),r=o.get("file"),i=r.substr(r.indexOf(".")+1).toLowerCase();if("json"==i||"js"==i||"html"==i)return n.apply(_worker,arguments)}}_worker.isOverwriteRequest=!0}},_worker.exec=function(e,t,n,o,r,i,a){var s=n;_worker.getCompletionEnvironment(i).then((function(){if(_worker.overwriteRequest(),_worker.runtimeEnvironment[i]){n="return "+n+";",o&&(n="try{\n"+o+"\n}catch(e){}\ntry{\n"+n+"\n}catch(e){return null;}");var u=_worker.runtimeEnvironment[i].exec(n);if(u){var c="ace"==a?_worker.getAceCompletions(u,r,s):_worker.getMonacoCompletions(u,r,s);_worker.postMessage({o:c,id:e,uuid:t})}}}),(function(){}))},_worker.postMessage({type:"ready"})})),onmessage=function(e){if(e.data){var t=e.data.id,n=e.data.uuid,o=e.data.code,r=e.data.runtime,i=e.data.type,a=e.data.preCode,s=e.data.range;t&&o&&r&&n&&i&&_worker.exec(t,n,o,a,s,r,i)}};