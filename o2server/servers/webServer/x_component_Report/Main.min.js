MWF.xApplication.Report=MWF.xApplication.Report||{},MWF.require("MWF.widget.O2Identity",null,!1),MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xDesktop.requireApp("Report","Common",null,!1),MWF.xDesktop.requireApp("Report","Setting",null,!1),MWF.xApplication.Report.options={multitask:!1,executable:!0},MWF.xApplication.Report.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"Report",view:"all",icon:"icon.png",width:"1220",height:"700",isResize:!0,isMax:!0,sideBarEnable:!0,title:MWF.xApplication.Report.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.Report.LP},loadApplication:function(t){MWF.UD.getDataJson("reportConfig",function(e){this.reportConfig=e||{},this.options.isRefresh?this.loadLayout():this.maxSize(function(){this.loadLayout()}.bind(this)),t&&t()}.bind(this))},loadLayout:function(){this.userName=(layout.desktop.session.user||layout.user).distinguishedName,this.restActions=MWF.Actions.get("x_report_assemble_control"),this.strategyActions=MWF.Actions.get("x_strategydeploy_assemble_control"),this.common=new MWF.xApplication.Report.Common(this),this.path="../x_component_Report/$Main/"+this.options.style+"/",this.createNode(),this.loadApplicationContent()},loadController:function(t){this.isAdmin=this.common.isAdmin(),this.isAdmin?this.exportAllFlag=!0:this.exportAllFlag=this.common.hasExportAllUnitPermission(),this.unitWithExport=[],this.exportAllFlag?t&&t():this.common.getUnitWithExportPermission(function(e){this.unitWithExport=e,t&&t()}.bind(this))},isShowExport:function(){return!!this.isAdmin||(!!this.exportAllFlag||!!(this.unitWithExport&&this.unitWithExport.length>0))},createNode:function(){this.content.setStyle("overflow","hidden"),this.node=new Element("div.reportNode",{styles:{width:"100%",height:"100%",overflow:"hidden","background-color":"#eee"}}).inject(this.content)},loadApplicationContent:function(){this.loadController(function(){this.loadApplicationLayout()}.bind(this))},loadApplicationLayout:function(){this.status&&this.status.action?this.defaultAction=this.status.action:this.reportConfig.defaultView?this.defaultAction=this.reportConfig.defaultView:"todo"==this.options.view?this.defaultAction="toTodo":this.defaultAction="toList",(this.common.isAdmin()||this.isShowExport())&&"all"==this.options.view&&(this.topMenu=new Element("div",{styles:this.css.topMenu}).inject(this.node)),this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.node),"todo"==this.options.view?this.toTodo():(this.common.isAdmin()||this.isShowExport())&&"all"==this.options.view?this.loadTopMenus():this.toList(),this.options.sideBarEnable},loadTopMenus_right:function(){this.topMenuRight=new Element("div",{styles:this.css.topMenuRight}).inject(this.topMenu),this.createTopMenu_right(this.lp.setting,"icon_shezhi","config").setStyle("float","right")},createTopMenu_right:function(t,e,i){var o=new Element("div",{styles:this.css.topMenuNode_right,title:t}).inject(this.topMenuRight),n=new Element("div",{styles:this.css.topMenuIconNode}).inject(o);n.setStyle("background","url(../x_component_Report/$Main/default/icon/"+e+".png) no-repeat center center"),o.store("icon",e),o.store("iconNode",n);var s=this;return o.addEvents({mouseover:function(){this.node.retrieve("iconNode").setStyle("background","url(../x_component_Report/$Main/default/icon/"+this.node.retrieve("icon")+"_click.png) no-repeat center center")}.bind({node:o}),mouseout:function(){this.node.retrieve("iconNode").setStyle("background","url(../x_component_Report/$Main/default/icon/"+this.node.retrieve("icon")+".png) no-repeat center center")}.bind({node:o}),click:function(){this.node.retrieve("iconNode").setStyle("background","url(../x_component_Report/$Main/default/icon/"+this.node.retrieve("icon")+"_click.png) no-repeat center center"),s[i]&&s[i].apply(s)}.bind({node:o})}),o},loadTopMenus:function(){this.createTopMenu(this.lp.list,"icon_liebiao","toList"),this.isShowExport()&&(this.createTopMenu("导出","icon_export","toStatistics",!0),this.createTopMenu("部门五项重点工作统览","icon_tongji","toSummarization",!0)),this.common.isAdmin()&&(this.createTopMenu(this.lp.startRecord,"icon_liebiao","toStartRecord"),this.loadTopMenus_right())},createTopMenu:function(t,e,i,o){var n=new Element("div",{styles:this.css.topMenuNode}).inject(this.topMenu),s=new Element("div",{styles:this.css.topMenuIconNode}).inject(n);s.setStyle("background","url(../x_component_Report/$Main/default/icon/"+e+".png) no-repeat center center");new Element("div",{styles:this.css.topMenuTextNode,text:t}).inject(n);n.store("icon",e),n.store("iconNode",s),n.store("action",i);var r=this;return n.addEvents({mouseover:function(){this.node!=r.currentTopMenuNode&&(this.node.setStyles(r.css.topMenuNode_over),this.node.retrieve("iconNode").setStyle("background","url(../x_component_Report/$Main/default/icon/"+this.node.retrieve("icon")+"_click.png) no-repeat center center"))}.bind({node:n}),mouseout:function(){this.node!=r.currentTopMenuNode&&(this.node.setStyles(r.css.topMenuNode),this.node.retrieve("iconNode").setStyle("background","url(../x_component_Report/$Main/default/icon/"+this.node.retrieve("icon")+".png) no-repeat center center"))}.bind({node:n}),click:function(){o||(this.node!=r.currentTopMenuNode&&(this.node.setStyles(r.css.topMenuNode_down),this.node.retrieve("iconNode").setStyle("background","url(../x_component_Report/$Main/default/icon/"+this.node.retrieve("icon")+"_click.png) no-repeat center center")),r.currentTopMenuNode&&this.node!=r.currentTopMenuNode&&(r.currentTopMenuNode.setStyles(r.css.topMenuNode),r.currentTopMenuNode.retrieve("iconNode").setStyle("background","url(../x_component_Report/$Main/default/icon/"+r.currentTopMenuNode.retrieve("icon")+".png) no-repeat center center")),r.currentTopMenuNode=this.node),r[i]&&r[i].apply(r)}.bind({node:n})}),this.defaultAction==i&&n.click(),n},showMenu:function(){"show"!=this.menuMode&&(this.topMenu.set("tween",{duration:100,transition:"bounce:out"}),this.topMenu.tween("top","-50px","0px"),this.menuMode="show")},hideCurrentView:function(){this.currentView&&(this.currentView.hide(),this.currentView=null)},toMyReport:function(){this.contentNode.setStyles(this.css.contentNode),this.currentView&&(this.currentView.destroy(),this.currentView=null),this.myReportView=null,this.getMyReportView(function(){this.myReportView.show(),this.currentView=this.myReportView}.bind(this))},getMyReportView:function(t){this.myReportView?t&&t():MWF.xDesktop.requireApp("Report","ReportView",function(){var e;this.status&&this.status.options&&(e=this.status.options),this.myReportView=new MWF.xApplication.Report.ReportView(this.contentNode,this,e),e&&(this.status.options=null),t&&t()}.bind(this))},toTodo:function(){this.currentView&&(this.currentView.destroy(),this.currentView=null),this.todoView=null,this.getTodoView(function(){this.todoView.show(),this.currentView=this.todoView}.bind(this))},getTodoView:function(t){this.todoView?t&&t():MWF.xDesktop.requireApp("Report","ListView",function(){var e;this.status&&this.status.options&&(e=this.status.options),(e=e||{}).isTodo=!0,this.todoView=new MWF.xApplication.Report.ListView(this.contentNode,this,e),this.status&&this.status.options&&(this.status.options=null),t&&t()}.bind(this))},toList:function(){this.currentView&&(this.currentView.destroy(),this.currentView=null),this.listView=null,this.getListView(function(){this.listView.show(),this.currentView=this.listView}.bind(this))},getListView:function(t){this.listView?t&&t():MWF.xDesktop.requireApp("Report","ListView",function(){var e;this.status&&this.status.options&&(e=this.status.options),this.listView=new MWF.xApplication.Report.ListView(this.contentNode,this,e),e&&(this.status.options=null),t&&t()}.bind(this))},toMonth:function(){this.currentView&&(this.currentView.destroy(),this.currentView=null),this.monthView=null,this.getMonthView(function(){this.monthView.show(),this.currentView=this.monthView}.bind(this))},getMonthView:function(t){this.monthView?t&&t():MWF.xDesktop.requireApp("Report","MonthView",function(){var e;this.status&&this.status.options&&(e=this.status.options),this.monthView=new MWF.xApplication.Report.MonthView(this.contentNode,this,e),e&&(this.status.options=null),t&&t()}.bind(this))},toDay:function(t){this.currentView&&(this.currentView.destroy(),this.currentView=null),this.dayView=null,this.getDayView(function(){this.dayView.show(),this.currentView=this.dayView}.bind(this),t)},getDayView:function(t,e){this.dayView?(this.dayView.toDay(e),t&&t()):MWF.xDesktop.requireApp("Report","DayView",function(){var i;this.status&&this.status.options&&(i=this.status.options),this.dayView=new MWF.xApplication.Report.DayView(this.contentNode,this,i||{date:e}),this.status&&(this.status.options=null),t&&t()}.bind(this))},toKeyWork:function(t){this.currentView&&(this.currentView.destroy(),this.currentView=null),this.mindView=null,this.getKeyWorkView(function(){this.mindView.load(),this.currentView=this.mindView}.bind(this),t)},getKeyWorkView:function(t,e){this.mindView?(this.mindView.load(e),t&&t()):MWF.xDesktop.requireApp("Report","MindView",function(){var i;this.status&&this.status.options&&(i=this.status.options),this.mindView=new MWF.xApplication.Report.MindView(this.contentNode,this,this.restActions,i||{date:e}),this.status&&(this.status.options=null),t&&t()}.bind(this))},toStatistics:function(){new MWF.xApplication.Report.StatisticsForm(this,{},{},{app:this}).create()},toSummarization:function(){new MWF.xApplication.Report.SummarizationForm(this,{},{},{app:this}).create()},toStartRecord:function(){this.currentView&&(this.currentView.destroy(),this.currentView=null),this.startRecordView=null,this.getStartRecordView(function(){this.startRecordView.show(),this.currentView=this.startRecordView}.bind(this))},getStartRecordView:function(t){this.startRecordView?t&&t():MWF.xDesktop.requireApp("Report","StartRecordView",function(){var e;this.status&&this.status.options&&(e=this.status.options),this.startRecordView=new MWF.xApplication.Report.StartRecordView(this.contentNode,this,e),e&&(this.status.options=null),t&&t()}.bind(this))},config:function(){new MWF.xApplication.Report.SettingForm(this,null,{height:this.common.isAdmin()?"600":"300",width:this.common.isAdmin()?"1000":"700"},{app:this}).edit()},recordStatus:function(){return{action:this.currentTopMenuNode?this.currentTopMenuNode.retrieve("action"):"toList",options:this.currentView&&this.currentView.recordStatus?this.currentView.recordStatus():null}},reload:function(){this.refresh()},loadSideBar:function(){this.sideBar=new MWF.xApplication.Report.SideBar(this.node,this),this.sideBar.show()},addReport:function(){}});var getDateDiff=function(t){if(!t)return"";var e=Date.parse(t.replace(/-/gi,"/")),i=864e5,o=(new Date).getTime()-e,n=(new Date).decrement("day",1),s=(new Date).decrement("day",2),r=o/31104e6,h=o/2592e6,c=o/(7*i),u=o/i,p=o/36e5,a=o/6e4;return n.getFullYear()==e.getFullYear()&&n.getMonth()==e.getMonth()&&n.getDate()==e.getDate()?result="昨天 "+e.getHours()+":"+e.getMinutes():s.getFullYear()==e.getFullYear()&&s.getMonth()==e.getMonth()&&s.getDate()==e.getDate()?result="前天 "+e.getHours()+":"+e.getMinutes():result=r>1||h>=1?e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate():c>=1?parseInt(c)+"周前":u>=1?parseInt(u)+"天前":p>=1?parseInt(p)+"小时前":a>=1?parseInt(a)+"分钟前":"刚刚发表",result};