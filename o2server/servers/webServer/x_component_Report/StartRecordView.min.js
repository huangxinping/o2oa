MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.xDesktop.requireApp("Template","MSelector",null,!1),MWF.xApplication.Report.StartRecordView=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",action:""},initialize:function(e,t,i){this.setOptions(i),this.path="../x_component_Report/$StartRecordView/",this.cssPath="../x_component_Report/$StartRecordView/"+this.options.style+"/css.wcss",this._loadCss(),this.app=t,this.container=$(e),this.load()},load:function(){this.node=new Element("div",{styles:this.css.node}).inject(this.container),this.contentAreaNode=new Element("div.contentAreaNode",{styles:this.css.contentAreaNode}).inject(this.node),this.contentNode=new Element("div.contentNode",{styles:this.css.contentNode}).inject(this.contentAreaNode),this.filterNode=new Element("div.filterNode",{styles:this.css.filterNode}).inject(this.contentNode),this.viewNode=new Element("div.viewNode",{styles:this.css.viewNode}).inject(this.contentNode),this.resetNodeSizeFun=this.resetNodeSize.bind(this),this.app.addEvent("resize",this.resetNodeSizeFun),this.loadFilter(),this.loadView(),this.resetNodeSize()},resetNodeSize:function(){var e=this.container.getSize().y-120;this.app.inContainer||this.viewNode.setStyle("height",e+"px");var t=this.app.sideBar?this.app.sideBar.getSize():{x:0,y:0};this.contentAreaNode.setStyle("margin-right",t.x+"px")},loadFilter:function(e,t){this.yearSelectorArea=new Element("div",{styles:this.css.yearSelectorArea}).inject(this.filterNode),this.selector=new MWF.xApplication.Report.StartRecordView.YearSelect(this.yearSelectorArea,{onSelectItem:function(e,t){this.loadView()}.bind(this)},this.app),this.selector.load()},loadView:function(){this.currentView&&this.currentView.destroy(),this.currentView=new MWF.xApplication.Report.StartRecordView.View(this.viewNode,this.app,this,{year:this.selector.getValue()||(new Date).getFullYear(),templateUrl:this.path+this.options.style+"/listItem.json"}),this.currentView.load()},hide:function(){new Fx.Morph(this.node,{duration:"300",transition:Fx.Transitions.Expo.easeOut}).start({opacity:0}).chain(function(){this.node.setStyle("display","none")}.bind(this))},show:function(){this.node.setStyles(this.css.node);var e=new Fx.Morph(this.node,{duration:"800",transition:Fx.Transitions.Expo.easeOut});this.app.fireAppEvent("resize"),e.start({opacity:1,left:"0px"}).chain(function(){this.node.setStyles({position:"static",width:"auto"})}.bind(this))},reload:function(){this.app.reload()},recordStatus:function(){var e="";return this.currentNavi&&(e=this.currentNavi.retrieve("action")),{action:e}},destroy:function(){this.currentView&&this.currentView.destroy(),this.app.removeEvent("resize",this.resetNodeSizeFun),this.node.destroy()}}),MWF.xApplication.Report.StartRecordView.YearSelect=new Class({Extends:MSelector,options:{style:"default",width:"230px",height:"30px",textField:"text",valueField:"value",emptyOptionEnable:!1,value:(new Date).getFullYear().toString()},_selectItem:function(e,t){},_loadData:function(e){var t=[],i=new Date;i.decrement("year",5);for(var o=0;o<11;o++)i.increment("year",1),t.push({text:i.getFullYear(),value:i.getFullYear().toString()});e&&e(t)}}),MWF.xApplication.Report.StartRecordView.View=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,options:{scrollEnable:!0,scrollType:"window"},_createDocument:function(e,t){return new MWF.xApplication.Report.StartRecordView.Document(this.viewNode,e,this.explorer,this,null,t)},_getCurrentPageData:function(e,t){this.actions.listStartProfileByYear(this.options.year,(function(t){t.data||(t.data=[]),e&&e(t)}))},_removeDocument:function(e,t){this.actions.deleteStartProfile(e.id,function(e){this.reload(),this.app.notice(this.app.lp.deleteStartRecordOK,"success")}.bind(this))},_create:function(){},_openDocument:function(e,t){},_queryCreateViewNode:function(){},_postCreateViewNode:function(e){},_queryCreateViewHead:function(){},_postCreateViewHead:function(e){}}),MWF.xApplication.Report.StartRecordView.Document=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(e){},_postCreateDocumentNode:function(e,t){this.index%2==1&&e.setStyle("background-color","#f0f0f0")},open:function(e){},edit:function(){},supplement:function(e){new MWF.xApplication.Report.StartRecordView.StartedForm(this.view.explorer,this.data,{},{app:this.app}).create()},remove:function(e){var t=this.app.lp,i=this.data.reportYear+"年"+this.data.reportMonth+"月",o=t.deleteStartRecord.replace(/{title}/g,i).replace(/{count}/g,this.data.createDocumentCount),n=this;this.node.setStyles(this.css.listViewTableTr_remove),this.readyRemove=!0,this.view.lockNodeStyle=!0,this.app.confirm("warn",e,t.deleteStartRecordTitle,o,350,120,(function(){n.view._removeDocument(n.data,!1),n.view.lockNodeStyle=!1,this.close()}),(function(){n.node.setStyles(n.css.listViewTableTr),e.setStyles(n.css.actionDeleteNode),n.readyRemove=!1,n.view.lockNodeStyle=!1,this.close()}))},mouseoverDocument:function(){this.node.setStyle("background-color","#fff7eb")},mouseoutDocument:function(){this.index%2==1?this.node.setStyle("background-color","#f0f0f0"):this.node.setStyle("background-color","#fff")}}),MWF.xApplication.Report.StartRecordView.StartedForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"report",width:800,height:450,hasTop:!0,hasIcon:!1,maxAction:!0,draggable:!0,resizeable:!0,editedAble:!0},_createTableContent:function(){this.lp={ok:"确定",close:"取消"},this.formTopTextNode.set("text","补充工作汇报");this.isEdited||this.isNew;this.formTableArea.setStyle("margin-top","20px");var e={formTable:{"border-collapse":"collapse",margin:"0px auto","margin-bottom":"15px"},formTableTitleP14:{border:"1px solid #d8d5d5","background-color":"#effafe",color:"#444","font-size":"14px",height:"30px","line-height":"30px","font-weight":"bold","text-align":"center"},formTableValueP14:{border:"1px solid #d8d5d5",color:"#444","font-size":"14px","font-weight":"400","text-align":"left"}},t=new Element("table",{width:"96%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.formTable}).inject(this.formTableArea),i=new Element("tr").inject(t);new Element("td",{text:"部门",width:"230",styles:e.formTableTitleP14}).inject(i),new Element("td",{text:"状态",width:"40",styles:e.formTableTitleP14}).inject(i),MWF.Actions.get("x_report_assemble_control").checkStarted(this.data.id,function(i){for(var o in i.data){var n=new Element("tr").inject(t);new Element("td",{text:o.split("@")[0],styles:e.formTableValueP14}).inject(n),new Element("td",{text:i.data[o],styles:e.formTableValueP14}).inject(n)}}.bind(this))},_createBottomContent:function(){(this.isNew||this.isEdited)&&(this.okActionNode=new Element("button.inputOkButton",{styles:this.css.inputOkButton,text:"补充"}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(e){this.supplemental(e)}.bind(this))),this.cancelActionNode=new Element("button.inputCancelButton",{styles:this.isEdited||this.isNew||this.getEditPermission()?this.css.inputCancelButton:this.css.inputCancelButton_long,text:this.lp.close}).inject(this.formBottomNode),this.cancelActionNode.addEvent("click",function(e){this.close(e)}.bind(this))},supplemental:function(){MWF.Actions.get("x_report_assemble_control").supplemental(this.data.id,function(e){this.app.notice("补充成功！"),this.close()}.bind(this))}});