MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.xApplication.Report.ListView=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",date:null,isTodo:!1,action:""},initialize:function(t,e,i){this.setOptions(i),this.path="../x_component_Report/$ListView/",this.cssPath="../x_component_Report/$ListView/"+this.options.style+"/css.wcss",this._loadCss(),this.app=e,this.container=$(t),this.date=this.options.date||new Date,this.load()},load:function(){this.node=new Element("div",{styles:this.css.node}).inject(this.container),this.contentAreaNode=new Element("div.contentAreaNode",{styles:this.css.contentAreaNode}).inject(this.node),this.contentNode=new Element("div.contentNode",{styles:this.css.contentNode}).inject(this.contentAreaNode),this.filterNode=new Element("div.filterNode",{styles:this.css.filterNode}).inject(this.contentNode),this.viewNode=new Element("div.viewNode",{styles:this.css.viewNode}).inject(this.contentNode),this.resetNodeSizeFun=this.resetNodeSize.bind(this),this.app.addEvent("resize",this.resetNodeSizeFun),this.options.isTodo?this.toTodo():this.toApplyAll(),this.resetNodeSize()},resetNodeSize:function(){var t=this.container.getSize().y-120;this.app.inContainer||this.viewNode.setStyle("height",t+"px");var e=this.app.sideBar?this.app.sideBar.getSize():{x:0,y:0};this.contentAreaNode.setStyle("margin-right",e.x+"px")},loadLeftNavi:function(){new Element("div.menuNode",{styles:this.css.menuNode,text:this.app.lp.listNavi.myApply}).inject(this.leftNode);this.loadNaviItem(this.app.lp.listNavi.wait,"toApplyWait"),this.loadNaviItem(this.app.lp.listNavi.processing,"toApplyProcessing"),this.loadNaviItem(this.app.lp.listNavi.completed,"toApplyCompleted"),this.loadNaviItem(this.app.lp.listNavi.allStatus,"toApplyAll");new Element("div.menuNode",{styles:this.css.menuNode,text:this.app.lp.listNavi.myReport}).inject(this.leftNode);if(this.loadNaviItem(this.app.lp.listNavi.waitProcessing,"toAuditProcessing"),this.loadNaviItem(this.app.lp.listNavi.allStatus,"toAuditAll"),this.app.common.isAdmin()){new Element("div.menuNode",{styles:this.css.menuNode,text:this.app.lp.listNavi.manage}).inject(this.leftNode);this.loadNaviItem(this.app.lp.listNavi.all,"toAll")}},loadNaviItem:function(t,e){var i=new Element("div",{styles:this.css.menuItemNode,text:t}).inject(this.leftNode),s=this;i.addEvents({mouseover:function(){s.currentNavi!=this&&this.setStyles(s.css.menuItemNode_over)},mouseout:function(){s.currentNavi!=this&&this.setStyles(s.css.menuItemNode)},click:function(){s.currentNavi&&s.currentNavi.setStyles(s.css.menuItemNode),s.currentNavi=this,this.setStyles(s.css.menuItemNode_current),s[e]&&s[e]()}}),i.store("action",e),(this.options.action==e||"toApplyWait"==e)&&i.click()},loadFilter:function(t,e){var i={};t&&(i=Object.merge(t,{onSearch:function(t){e&&e(t)}})),this.filter&&this.filter.destroy(),this.filter=new MWF.xApplication.Report.ReportFileter(this.filterNode,this.app,i)},toApplyWait:function(){this.currentView&&this.currentView.destroy(),this.currentView=new MWF.xApplication.Report.ListView.ApplyWait(this.viewNode,this.app,this,{templateUrl:this.path+this.options.style+"/listItem.json"}),this.currentView.load()},toApplyProcessing:function(){this.currentView&&this.currentView.destroy(),this.currentView=new MWF.xApplication.Report.ListView.ApplyProcessing(this.viewNode,this.app,this,{templateUrl:this.path+this.options.style+"/listItem_apply_processing.json"}),this.currentView.load()},toApplyCompleted:function(){this.currentView&&this.currentView.destroy(),this.currentView=new MWF.xApplication.Report.ListView.ApplyCompleted(this.viewNode,this.app,this,{templateUrl:this.path+this.options.style+"/listItem.json"}),this.currentView.load()},toTodo:function(){this.currentView&&this.currentView.destroy(),this.currentView=new MWF.xApplication.Report.ListView.Todo(this.viewNode,this.app,this,{templateUrl:this.path+this.options.style+"/listItem_all.json"}),this.currentView.load()},toApplyAll:function(){this.currentView&&this.currentView.destroy(),this.currentView=new MWF.xApplication.Report.ListView.ApplyAll(this.viewNode,this.app,this,{templateUrl:this.path+this.options.style+"/listItem_all.json"}),this.currentView.load()},toAuditProcessing:function(){this.currentView&&this.currentView.destroy(),this.currentView=new MWF.xApplication.Report.ListView.AuditProcessing(this.viewNode,this.app,this,{templateUrl:this.path+this.options.style+"/listItem_all.json"}),this.currentView.load()},toAuditAll:function(){this.currentView&&this.currentView.destroy(),this.currentView=new MWF.xApplication.Report.ListView.AuditAll(this.viewNode,this.app,this,{templateUrl:this.path+this.options.style+"/listItem_all.json"}),this.currentView.load()},toAll:function(){this.currentView&&this.currentView.destroy(),this.currentView=new MWF.xApplication.Report.ListView.All(this.viewNode,this.app,this,{templateUrl:this.path+this.options.style+"/listItem_all.json"}),this.currentView.load()},hide:function(){new Fx.Morph(this.node,{duration:"300",transition:Fx.Transitions.Expo.easeOut}).start({opacity:0}).chain(function(){this.node.setStyle("display","none")}.bind(this))},show:function(){this.node.setStyles(this.css.node);var t=new Fx.Morph(this.node,{duration:"800",transition:Fx.Transitions.Expo.easeOut});this.app.fireAppEvent("resize"),t.start({opacity:1,left:"0px"}).chain(function(){this.node.setStyles({position:"static",width:"auto"})}.bind(this))},reload:function(){this.app.reload()},recordStatus:function(){var t="";return this.currentNavi&&(t=this.currentNavi.retrieve("action")),{action:t}},destroy:function(){this.currentView&&this.currentView.destroy(),this.app.removeEvent("resize",this.resetNodeSizeFun),this.node.destroy()}}),MWF.xApplication.Report.ListView.ApplyWait=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,options:{scrollEnable:!0,scrollType:"window"},_createDocument:function(t,e){return new MWF.xApplication.Report.ListView.Document(this.viewNode,t,this.explorer,this,null,e)},_getCurrentPageData:function(t,e){e||(e=30);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",s=this.filterData||this.forceFilterCondition;this.sortType&&this.sortField&&(s.orderField=this.sortField,s.orderType=this.sortType),this.actions.listReportNextWithFilter(i,e,s,(function(e){e.data||(e.data=[]),t&&t(e)}))},_removeDocument:function(t,e){this.actions.deleteSubject(t.id,function(t){this.reload(),this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t,e){this.app.common.openReport(t,this)},_queryCreateViewNode:function(){this.forceFilterCondition={targetList:[this.app.userName],reportStatus:"汇报者填写"}},_postCreateViewNode:function(t){this.filterLoaded||(this.explorer.loadFilter({items:["reportType","title","year","month","reportDate","reportObjType"],defaultResult:this.forceFilterCondition},function(t){this.filterData=t,this.reload()}.bind(this)),this.filterLoaded=!0)},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){},destroyScroll:function(){this.scrollContainerFun&&((this.app.scrollNode?this.app.scrollNode:this.container).removeEvent("scroll",this.scrollContainerFun),this.scrollContainerFun=null)},setScroll:function(){var t=this.app.scrollNode?this.app.scrollNode:this.container;t.setStyle("overflow","auto"),this.scrollContainerFun=function(){if(!this.options.pagingEnable){var e=t.getScrollSize(),i=t.getSize(),s=e.y-i.y;t.scrollTop+150>s&&(this.isItemsLoaded||this.loadElementList())}}.bind(this),t.addEvent("scroll",this.scrollContainerFun)}}),MWF.xApplication.Report.ListView.ApplyProcessing=new Class({Extends:MWF.xApplication.Report.ListView.ApplyWait,_getCurrentPageData:function(t,e){e||(e=30);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",s=this.filterData||this.forceFilterCondition;this.sortType&&this.sortField&&(s.orderField=this.sortField,s.orderType=this.sortType),this.actions.listReportNextWithFilter(i,e,s,(function(e){e.data||(e.data=[]),t&&t(e)}))},_queryCreateViewNode:function(){this.forceFilterCondition={targetList:[this.app.userName],reportStatus:"审核中"}},_postCreateViewNode:function(t){this.filterLoaded||(this.explorer.loadFilter({items:["reportType","title","year","month","reportDate","reportObjType","activityList","currentPersonList"],defaultResult:this.forceFilterCondition},function(t){this.filterData=t,this.reload()}.bind(this)),this.filterLoaded=!0)}}),MWF.xApplication.Report.ListView.ApplyCompleted=new Class({Extends:MWF.xApplication.Report.ListView.ApplyWait,_getCurrentPageData:function(t,e){e||(e=30);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",s=this.filterData||this.forceFilterCondition;this.sortType&&this.sortField&&(s.orderField=this.sortField,s.orderType=this.sortType),this.actions.listReportNextWithFilter(i,e,s,(function(e){e.data||(e.data=[]),t&&t(e)}))},_queryCreateViewNode:function(){this.forceFilterCondition={targetList:[this.app.userName],reportStatus:"已完成"}},_postCreateViewNode:function(t){this.filterLoaded||(this.explorer.loadFilter({items:["reportType","title","year","month","reportDate","reportObjType"],defaultResult:this.forceFilterCondition},function(t){this.filterData=t,this.reload()}.bind(this)),this.filterLoaded=!0)}}),MWF.xApplication.Report.ListView.ApplyAll=new Class({Extends:MWF.xApplication.Report.ListView.ApplyWait,_getCurrentPageData:function(t,e){e||(e=30);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",s=this.filterData||this.forceFilterCondition;s=Object.merge({title:"",reportType:"",year:"",month:"",week:"",workIds:[],reportDate:"",createDate:"",targetList:[],unitList:[],activityList:[],currentPersonList:[],orderField:"",reportObjType:"",reportStatus:"",orderType:"",permission:""},s),this.sortType&&this.sortField?(s.orderField=this.sortField,s.orderType=this.sortType):this.sortTypeDefault&&this.sortFieldDefault&&(s.orderField=this.sortFieldDefault,s.orderType=this.sortTypeDefault),s.reportStatus||(s.reportStatus=""),s.permission="",this.actions.listReportNextWithFilter(i,e,s,(function(e){e.data||(e.data=[]),t&&t(e)}))},_queryCreateViewNode:function(){this.forceFilterCondition={}},_postCreateViewNode:function(t){this.filterLoaded||(this.explorer.loadFilter({items:["reportType","title","year","month","reportDate","reportObjType","reportStatus","activityList"],defaultResult:this.forceFilterCondition},function(t){this.filterData=t,this.reload()}.bind(this)),this.filterLoaded=!0)}}),MWF.xApplication.Report.ListView.Todo=new Class({Extends:MWF.xApplication.Report.ListView.ApplyWait,_getCurrentPageData:function(t,e){e||(e=30);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",s=this.filterData||this.forceFilterCondition;s=Object.merge({title:"",reportType:"",year:"",month:"",week:"",workIds:[],reportDate:"",createDate:"",targetList:[],unitList:[],activityList:[],currentPersonList:[],orderField:"",reportObjType:"",reportStatus:"",orderType:"",permission:""},s),this.sortType&&this.sortField?(s.orderField=this.sortField,s.orderType=this.sortType):this.sortTypeDefault&&this.sortFieldDefault&&(s.orderField=this.sortFieldDefault,s.orderType=this.sortTypeDefault),s.reportStatus,s.permission="作者",this.actions.listReportNextWithFilter(i,e,s,(function(e){e.data||(e.data=[]),t&&t(e)}))},_queryCreateViewNode:function(){this.forceFilterCondition={}},_postCreateViewNode:function(t){this.filterLoaded||(this.explorer.loadFilter({items:["reportType","title","year","month","reportDate","reportObjType","reportStatus","activityList"],defaultResult:this.forceFilterCondition},function(t){this.filterData=t,this.reload()}.bind(this)),this.filterLoaded=!0)}}),MWF.xApplication.Report.ListView.AuditWait=new Class({Extends:MWF.xApplication.Report.ListView.ApplyWait,_getCurrentPageData:function(t,e){e||(e=30);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",s=this.filterData||this.forceFilterCondition;this.sortType&&this.sortField&&(s.orderField=this.sortField,s.orderType=this.sortType),this.actions.listReportNextWithFilter(i,e,s,(function(e){e.data||(e.data=[]),t&&t(e)}))},_queryCreateViewNode:function(){this.forceFilterCondition={currentPersonList:[this.app.userName],reportStatus:"审核中"}},_postCreateViewNode:function(t){this.filterLoaded||(this.explorer.loadFilter({items:["reportType","title","year","month","reportDate","targetList","activityList","reportObjType"],defaultResult:this.forceFilterCondition},function(t){this.filterData=t,this.reload()}.bind(this)),this.filterLoaded=!0)}}),MWF.xApplication.Report.ListView.AuditProcessing=new Class({Extends:MWF.xApplication.Report.ListView.ApplyWait,_getCurrentPageData:function(t,e){e||(e=30);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",s=this.filterData||this.forceFilterCondition;this.sortType&&this.sortField&&(s.orderField=this.sortField,s.orderType=this.sortType),s.reportStatus||(s.reportStatus=""),this.actions.listReportNextWithFilter(i,e,s,(function(e){e.data||(e.data=[]),t&&t(e)}))},_queryCreateViewNode:function(){this.forceFilterCondition={currentPersonList:[this.app.userName],reportStatus:"审核中"}},_postCreateViewNode:function(t){this.filterLoaded||(this.explorer.loadFilter({items:["reportType","title","year","month","reportDate","targetList","activityList","reportObjType"],defaultResult:this.forceFilterCondition},function(t){this.filterData=t,this.reload()}.bind(this)),this.filterLoaded=!0)}}),MWF.xApplication.Report.ListView.AuditAll=new Class({Extends:MWF.xApplication.Report.ListView.ApplyWait,_getCurrentPageData:function(t,e){e||(e=30);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",s=this.filterData||this.forceFilterCondition;this.sortType&&this.sortField&&(s.orderField=this.sortField,s.orderType=this.sortType),s.reportStatus,this.actions.listMyAuditNextWithFilter(i,e,s,(function(e){e.data||(e.data=[]),t&&t(e)}))},_queryCreateViewNode:function(){this.forceFilterCondition={}},_postCreateViewNode:function(t){this.filterLoaded||(this.explorer.loadFilter({items:["reportType","title","year","month","reportDate","targetList","activityList","reportStatus","reportObjType","currentPersonList"],defaultResult:this.forceFilterCondition},function(t){this.filterData=t,this.reload()}.bind(this)),this.filterLoaded=!0)}}),MWF.xApplication.Report.ListView.All=new Class({Extends:MWF.xApplication.Report.ListView.ApplyWait,_getCurrentPageData:function(t,e){e||(e=30);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",s=this.filterData||this.forceFilterCondition;s.reportStatus||(s.reportStatus=""),this.sortType&&this.sortField&&(s.orderField=this.sortField,s.orderType=this.sortType),this.actions.listReportNextWithFilter(i,e,s,(function(e){e.data||(e.data=[]),t&&t(e)}))},_queryCreateViewNode:function(){this.forceFilterCondition={}},_postCreateViewNode:function(t){this.filterLoaded||(this.explorer.loadFilter({items:["reportType","title","year","month","reportDate","targetList","activityList","currentPersonList","reportStatus","reportObjType"],defaultResult:this.forceFilterCondition},function(t){this.filterData=t,this.reload()}.bind(this)),this.filterLoaded=!0)}}),MWF.xApplication.Report.ListView.Document=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){this.index%2==1&&t.setStyle("background-color","#f0f0f0")},open:function(t){this.view._openDocument(this.data,this.index)},edit:function(){var t="ReportDocument"+this.data.id;this.app.desktop.apps[t]?this.app.desktop.apps[t].setCurrent():this.app.desktop.openApplication(null,"ReportDocument",{id:this.data.id,isEdited:!0,isNew:!1})},remove:function(){},mouseoverDocument:function(){this.node.setStyle("background-color","#fff7eb")},mouseoutDocument:function(){this.index%2==1?this.node.setStyle("background-color","#f0f0f0"):this.node.setStyle("background-color","#fff")}});