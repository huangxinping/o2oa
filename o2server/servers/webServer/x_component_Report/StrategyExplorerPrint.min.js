MWF.xApplication.Report.StrategyExplorer.Print=new Class({Implements:[Options,Events],options:{style:"default",isEdited:!1,status:""},initialize:function(t,e,i,n){this.setOptions(n),this.container=t,this.explorer=e,this.app=this.explorer.app,this.lp=this.app.lp,this.css=this.explorer.css,this.actions=this.app.restActions,this.data=i,this.path="../x_component_Report/$StrategyExplorer/"},load:function(){if(this.data.detail.opinions){var t=JSON.parse(this.data.detail.opinions);"array"==typeOf(t)&&this.loadOpinion()}this._load()},loadOpinion:function(){var t=new Element("table",{width:"96%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.formTable}).inject(this.explorer.ideaContainer),e=new Element("tr").inject(t);(i=new Element("td",{styles:this.css.formTableTitle,text:"领导意见"}).inject(e)).setStyle("width","14%");var i=new Element("td",{styles:this.css.formTableValue}).inject(e),n=this.data.detail.opinions;if(n){var s=JSON.parse(n);if("array"==typeOf(s)){var a=new Element("div").inject(i);s.each(function(t){var e=new Element("table",{width:"100%",border:"0",cellpadding:"0",cellspacing:"0"}).inject(a),i=new Element("tr").inject(e),n=new Element("td",{text:t.identity.split("@")[0]+":"}).inject(i);n.setStyle("width","50px"),n=new Element("td",{text:(t.content?this.app.common.replaceWithBr(t.content):"已阅")+"      ("+t.datetime+")"}).inject(i)}.bind(this))}}},_load:function(){this.month=parseInt(this.data.month);var t=this.table=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.formTable}).inject(this.explorer.totalContainer),e=new Element("tr").inject(t);new Element("td",{rowspan:2,width:"30",styles:this.css.formTableTitle,text:"序号"}).inject(e),new Element("td",{colspan:3,text:this.data.year+"年"+parseInt(this.data.month)+"月工作总结",styles:this.css.formTableTitle}).inject(e);var i=new Date(this.data.year,parseInt(this.data.month)-1,1).increment("month",1),n=i.getFullYear()+"年"+(i.getMonth()+1)+"月工作计划";new Element("td",{colspan:2,text:n,styles:this.css.formTableTitle}).inject(e),new Element("td",{rowspan:2,width:"200",text:"服务客户",styles:this.css.formTableTitle}).inject(e),new Element("td",{rowspan:2,width:"200",text:"关爱员工",styles:this.css.formTableTitle}).inject(e),new Element("td",{rowspan:2,width:"200",text:"意见建议",styles:this.css.formTableTitle}).inject(e);e=new Element("tr").inject(t);new Element("td",{text:"部门重点工作",width:"200",styles:this.css.formTableTitle}).inject(e),new Element("td",{text:"计划",width:"200",styles:this.css.formTableTitle}).inject(e),new Element("td",{text:"总结",width:"200",styles:this.css.formTableTitle}).inject(e),new Element("td",{text:"部门重点工作",width:"200",styles:this.css.formTableTitle}).inject(e),new Element("td",{text:"计划",width:"200",styles:this.css.formTableTitle}).inject(e),this.loadContent()},loadContent:function(){this.getTableData().each(function(t,e){var i=new Element("tr").inject(this.table);new Element("td",{text:t.sequence,align:"center",styles:this.css.formTableValue}).inject(i);var n=new Element("td",{valign:"top",html:this.app.common.replaceWithBr(t.thisMonth.title),styles:this.css.formTableValue}).inject(i);if(t.thisMonth.measuresList.length){var s=new Element("input",{type:"button",styles:this.css.showMeasureNode2,value:"查看举措"}).inject(n);new MWF.xApplication.Report.ShowMeasureTooltip(this.app.content,s,this.app,this.data,{style:"report",position:{x:"auto",y:"auto"},event:"click"}).measuresList=t.thisMonth.measuresList}if(new Element("td",{valign:"top",html:this.app.common.replaceWithBr(t.thisMonth.plan),styles:this.css.formTableValue}).inject(i),n=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(i),"deployment"==this.options.status);else if("write"==this.options.status){var a=new Element("div").inject(n);this.loadThisMontWorkProg(a,e,!1)}else("confirm"==this.options.status||"audit"==this.options.status||"summary"==this.options.status)&&n.set("html",this.app.common.replaceWithBr(t.thisMonth.prog));if(n=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(i),"deployment"==this.options.status);else if("write"==this.options.status){a=new Element("div").inject(n);this.loadNextMontWorkTitle(a,e,!1)}else("confirm"==this.options.status||"audit"==this.options.status||"summary"==this.options.status)&&n.set("html",this.app.common.replaceWithBr(t.nextMonth.title));if(("confirm"==this.options.status||"audit"==this.options.status)&&t.nextMonth.measuresList.length){s=new Element("input",{type:"button",styles:this.css.showMeasureNode2,value:"查看举措"}).inject(n);new MWF.xApplication.Report.ShowMeasureTooltip(this.app.content,s,this.app,this.data,{style:"report",nextMonth:!0,position:{x:"auto",y:"auto"},event:"click"}).measuresList=t.nextMonth.measuresList}if(n=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(i),"deployment"==this.options.status);else if("write"==this.options.status){a=new Element("div").inject(n);this.loadNextMontWorkPlan(a,e,!1)}else("confirm"==this.options.status||"audit"==this.options.status||"summary"==this.options.status)&&n.set("html",this.app.common.replaceWithBr(t.nextMonth.plan));this.loadExtTd(t,i,e,"fuwu"),this.loadExtTd(t,i,e,"guanai"),this.loadExtTd(t,i,e,"yijian")}.bind(this))},loadExtTd:function(t,e,i,n){var s;"deployment"==this.options.status?s=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(e):"write"==this.options.status?(s=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(e),this.loadExtWork_write(s,!1,n,i)):("confirm"==this.options.status||"audit"==this.options.status||"summary"==this.options.status)&&(s=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(e)).set("html",this.app.common.replaceWithBr(t.extWork[n]))},loadExtWork_write:function(t,e,i,n){if(!this.ExtWorkData){var s=this.ExtWorkData=this.data.WoReport_I_Ext_Contents||[];this.ExtWorkObject={},s.sort((function(t,e){var i=t.targetPerson.localeCompare(e.targetPerson);return 0==i?t.orderNumber-e.orderNumber:i})),s.each(function(t){this.ExtWorkObject[t.orderNumber]||(this.ExtWorkObject[t.orderNumber]=[]),this.ExtWorkObject[t.orderNumber].push(t)}.bind(this))}if(a=new Element("table",{width:"100%",border:"0",cellpadding:"3",cellspacing:"0"}).inject(t),this.ExtWorkObject[n+1]&&this.ExtWorkObject[n+1].each(function(t){if(t[i]){var e=new Element("tr").inject(a);new Element("td",{width:"40",text:t.targetPerson.split("@")[0]+":"}).inject(e),new Element("td",{}).inject(e).set("html",this.app.common.replaceWithBr(t[i]))}}.bind(this)),e&&a){var a=new Element("table",{width:"100%",border:"0",cellpadding:"3",cellspacing:"0",styles:this.css.formTable}).inject(t);this.data.WoReport_I_Ext_Contents_sumamry.each(function(t){if(t[i]){var e=new Element("tr").inject(a);new Element("td",{width:"40",text:"汇总:"}).inject(e),new Element("td",{}).inject(e).set("html",this.app.common.replaceWithBr(t[i]))}}.bind(this))}},loadThisMontWorkProg:function(t,e,i){var n,s=this.data.thisMonth_workList[e];if(s&&s.progList&&s.progList.length>0&&(n=new Element("table",{width:"100%",border:"0",cellpadding:"3",cellspacing:"0"}).inject(t),s.progList.each(function(t){if(t.progressContent){var e=new Element("tr").inject(n);new Element("td",{width:"40",text:t.targetPerson.split("@")[0]+":"}).inject(e),new Element("td",{}).inject(e).set("html",this.app.common.replaceWithBr(t.progressContent))}}.bind(this))),i&&n){var a=new Element("tr").inject(n);new Element("td",{width:"40",text:"汇总:"}).inject(a),new Element("td",{}).inject(a).set("html",this.app.common.replaceWithBr(s.workProgSummary))}},loadNextMontWorkTitle:function(t,e,i){var n,s=this.data.nextMonth_workList[e];if(s&&s.planNextList&&s.planNextList.length>0&&(n=new Element("table",{width:"100%",border:"0",cellpadding:"3",cellspacing:"0",styles:this.css.formTable}).inject(t),s.planNextList.each(function(t){if(t.title){var e=new Element("tr").inject(n);new Element("td",{width:"40",text:t.targetPerson.split("@")[0]+":"}).inject(e),new Element("td",{}).inject(e).set("html",this.app.common.replaceWithBr(t.title))}}.bind(this))),i&&n){var a=new Element("tr").inject(n);new Element("td",{width:"40",text:"汇总:"}).inject(a),new Element("td",{}).inject(a).set("html",this.app.common.replaceWithBr(s.workTitle))}},loadNextMontWorkPlan:function(t,e,i){var n,s=this.data.nextMonth_workList[e];if(s&&s.planNextList&&s.planNextList.length>0&&(n=new Element("table",{width:"100%",border:"0",cellpadding:"3",cellspacing:"0",styles:this.css.formTable}).inject(t),s.planNextList.each(function(t){if(t.planContent){var e=new Element("tr").inject(n);new Element("td",{width:"40",text:t.targetPerson.split("@")[0]+":"}).inject(e),new Element("td",{}).inject(e).set("html",this.app.common.replaceWithBr(t.planContent))}}.bind(this))),i&&n){var a=new Element("tr").inject(n);new Element("td",{width:"40",text:"汇总:"}).inject(a),new Element("td",{}).inject(a).set("html",this.app.common.replaceWithBr(s.workPlanSummary))}},getTableData:function(){this.tableData=[];for(var t=0;t<5;t++){var e=this.data.WoReport_I_Ext_Contents_sumamry?this.data.WoReport_I_Ext_Contents_sumamry[t]:null,i=this.data.thisMonth_workList?this.data.thisMonth_workList[t]:null,n=this.data.nextMonth_workList?this.data.nextMonth_workList[t]:null,s={sequence:t+1,thisMonth:{title:i?i.workTitle:"",plan:i?i.workPlanSummary:"",prog:i?i.workProgSummary:"",measuresList:i?i.measuresList:[]},nextMonth:{title:n?n.workTitle:"",plan:n?n.workPlanSummary:"",measuresList:n?n.measuresList:[]},extWork:{fuwu:e?e.fuwu:"",guanai:e?e.guanai:"",yijian:e?e.yijian:""}};this.tableData.push(s)}return this.tableData}});