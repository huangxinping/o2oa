MWF.xDesktop.requireApp("process.ViewDesigner","",null,!1),MWF.APPSTD=MWF.xApplication.process.StatDesigner,MWF.APPSTD.options={multitask:!0,executable:!1},MWF.xDesktop.requireApp("process.StatDesigner","Stat",null,!1),MWF.xApplication.process.StatDesigner.Main=new Class({Extends:MWF.xApplication.process.ViewDesigner.Main,Implements:[Options,Events],options:{style:"default",name:"process.StatDesigner",icon:"icon.png",title:MWF.APPSTD.LP.title,appTitle:MWF.APPSTD.LP.title,id:"",tooltip:{unCategory:MWF.APPSTD.LP.unCategory},actions:null,category:null,processData:null},onQueryLoad:function(){this.shortcut=!0,this.status&&(this.options.application=this.status.applicationId,this.application=this.status.application,this.options.id=this.status.id),this.options.id||(this.options.desktopReload=!1,this.options.title=this.options.title+"-"+MWF.APPSTD.LP.newStat),this.actions||(this.actions=MWF.Actions.get("x_processplatform_assemble_designer")),this.lp=MWF.xApplication.process.StatDesigner.LP,this.addEvent("queryClose",function(t){this.explorer&&this.explorer.reload()}.bind(this)),this.addEvent("postLoadWindowMax",function(t){this.loadWindowOk=!0,this.loadApplicationOk&&this.loadWindowOk&&this.view.setViewWidth()}.bind(this)),this.addEvent("postLoadApplication",function(t){this.loadApplicationOk=!0,this.loadApplicationOk&&this.loadWindowOk&&this.view.setViewWidth()}.bind(this))},loadViewList:function(){this.actions.listStat(this.application.id,function(t){t.data.each(function(t){this.createListViewItem(t)}.bind(this))}.bind(this),null,!1)},createListViewItem:function(t,i){var s=this,e=new Element("div",{styles:this.css.listViewItem}).inject(this.viewListAreaNode,i?"top":"bottom");new Element("div",{styles:this.css.listViewItemIcon}).inject(e),new Element("div",{styles:this.css.listViewItemText,text:t.name?t.name+" ("+t.alias+")":this.lp.newStat}).inject(e);e.store("view",t),e.addEvents({dblclick:function(t){s.loadViewByData(this,t)},mouseover:function(){s.currentListViewItem!=this&&this.setStyles(s.css.listViewItem_over)},mouseout:function(){s.currentListViewItem!=this&&this.setStyles(s.css.listViewItem)}})},loadViewByData:function(t,i){var s=t.retrieve("view");if(openNew){var e=this,n={onQueryLoad:function(){this.actions=e.actions,this.category=e,this.options.id=s.id,this.application=e.application,this.explorer=e.explorer}};this.desktop.openApplication(i,"process.StatDesigner",n)}},loadView:function(){this.getViewData(this.options.id,function(t){this.setTitle(this.options.appTitle+"-"+t.name),this.taskitem.setText(this.options.appTitle+"-"+t.name),this.options.appTitle=this.options.appTitle+"-"+t.name,this.view=new MWF.xApplication.process.StatDesigner.Stat(this,t),this.view.load()}.bind(this))},loadNewViewData:function(t){MWF.getJSON("../x_component_process_StatDesigner/$Stat/stat.json",{onSuccess:function(i){this.actions.getUUID(function(s){i.id=s,i.isNewView=!0,i.application=this.application.id,this.createListViewItem(i,!0),t&&t(i)}.bind(this))}.bind(this),onerror:function(t){this.notice(t,"error")}.bind(this),onRequestFailure:function(t){this.notice(t.responseText,"error")}.bind(this)})},loadViewData:function(t,i){this.actions.getStat(t,function(t){if(t){var s=t.data,e=JSON.decode(s.data);s.data=e,this.application?i&&i(s):this.actions.getApplication(s.application,function(t){this.application={name:t.data.name,id:t.data.id},i&&i(s)}.bind(this))}}.bind(this))},saveView:function(){this.view.save(function(){var t=this.view.data.name;this.setTitle(MWF.APPSTD.LP.title+"-"+t),this.options.desktopReload=!0,this.options.id=this.view.data.id}.bind(this))},saveDictionaryAs:function(){this.view.saveAs()},dictionaryExplode:function(){this.view.explode()},dictionaryImplode:function(){this.view.implode()}});