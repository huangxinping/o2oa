MWF.xApplication.Execution=MWF.xApplication.Execution||{},MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xDesktop.requireApp("Template","MPopupForm",null,!1),MWF.xDesktop.requireApp("Template","MDomItem",null,!1),MWF.require("MWF.widget.Identity",null,!1),MWF.xApplication.Execution.WorkList=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",workNavi1:"",workNavi2:""},initialize:function(t,e,i,o){this.setOptions(o),this.app=e,this.lp=e.lp.workList,this.path="../x_component_Execution/$WorkList/",this.loadCss(),this.actions=i,this.node=$(t),this.actionProcess=MWF.Actions.get("x_processplatform_assemble_surface")},loadCss:function(){this.cssPath="../x_component_Execution/$WorkList/"+this.options.style+"/css.wcss",this._loadCss()},load:function(){if(!this.appointSwitch){var t={configCode:"WORK_AUTHORIZE"};this.actions.getProfileByCode(t,function(t){"success"==t.type&&t.data&&t.data.configValue&&(this.appointSwitch=t.data.configValue)}.bind(this),null,!1)}this.tabLocation="",this.middleContent=this.app.middleContent,this.middleContent.setStyles({"margin-top":"0px",border:"0px solid #f00"}),this.createNaviContent(),this.createContentDiv(),this.resizeWindow(),this.app.addEvent("resize",function(){this.resizeWindow()}.bind(this))},resizeWindow:function(){var t=this.app.middleContent.getSize();this.naviDiv&&this.naviDiv.setStyles({height:t.y-60+"px"}),this.naviContentDiv&&this.naviContentDiv.setStyles({height:t.y-180+"px"}),this.contentDiv&&this.contentDiv.setStyles({height:t.y-60+"px"}),this.rightContentDiv&&this.rightContentDiv.setStyles({height:t.y-40-140+"px",width:t.x-this.naviDiv.getSize().x-6+"px"})},createNaviContent:function(){this.naviDiv=new Element("div.naviDiv",{styles:this.css.naviDiv}).inject(this.middleContent),this.naviTitleDiv=new Element("div.naviTitleDiv",{styles:this.css.naviTitleDiv,text:this.lp.navi.title}).inject(this.naviDiv),this.naviContentDiv=new Element("div.naviContentDiv",{styles:this.css.naviContentDiv}).inject(this.naviDiv),this.naviBottomDiv=new Element("div.naviBottomDiv",{styles:this.css.naviBottomDiv}).inject(this.naviDiv);var t=new Element("li.naviContentLi",{styles:this.css.naviContentLi}).inject(this.naviContentDiv).addEvents({click:function(){this.app.openWorkReport()}.bind(this)});new Element("img.naviContentImg",{styles:this.css.naviContentImg,src:this.path+"default/icon/Prototype-100.png"}).inject(t),new Element("span.naviContentSpan",{styles:this.css.naviContentSpan,text:this.lp.navi.items.workReport}).inject(t)},createContentDiv:function(){this.contentDiv=new Element("div.contentDiv",{styles:this.css.contentDiv}).inject(this.middleContent),this.createCategoryItemDiv(),this.clickWorkListNavi(this.options.workNavi1||"base",this.options.workNavi2||"")},createCategoryItemDiv:function(){this.rightCategoryDiv=new Element("div.rightCategoryDiv",{styles:this.css.rightCategoryDiv}).inject(this.contentDiv);var t=!1;this.actions.createCenterWorkAuthorization(function(e){e.data&&e.data.value&&(t=e.data.value)}.bind(this),null,!1),t&&(this.rightCategoryNewDiv=new Element("div.rightCategoryNewDiv",{styles:this.css.rightCategoryNewDiv,text:this.lp.createWork}).inject(this.rightCategoryDiv).addEvents({click:function(){MWF.xDesktop.requireApp("Execution","WorkDeploy",function(){this.explorer=new MWF.xApplication.Execution.WorkDeploy(this,this.actions,{},{isEdited:!0,isNew:!0,onReloadView:function(t){this.createRightContentDiv(this.workNavi1,this.workNavi2)}.bind(this)}),this.explorer.load()}.bind(this))}.bind(this)})),this.rightCategoryItemDiv=new Element("div.rightCategoryItemDiv",{styles:this.css.rightCategoryItemDiv}).inject(this.rightCategoryDiv),this.centerWorkLi=new Element("li.centerWorkLi",{styles:this.css.rightCategoryItemCurrentLi,text:this.lp.workItems.centerWork.title}).inject(this.rightCategoryItemDiv).addEvents({click:function(){this.clickWorkListNavi("center")}.bind(this)}),this.baseWorkLi=new Element("li.baseWorkLi",{styles:this.css.rightCategoryItemLi,text:this.lp.workItems.baseWork.title}).inject(this.rightCategoryItemDiv).addEvents({click:function(){this.clickWorkListNavi("base")}.bind(this)}),this.rightSearchDiv=new Element("div.rightSearchDiv",{styles:this.css.rightSearchDiv}).inject(this.contentDiv)},clickWorkListNavi:function(t,e){this.workNavi1=t||"base",this.rightSearchDiv&&this.rightSearchDiv.empty(),this.rightContentDiv&&this.rightContentDiv.destroy(),"base"==t?(this.centerWorkLi&&this.centerWorkLi.setStyles({"border-bottom":""}),this.baseWorkLi&&this.baseWorkLi.setStyles({"border-bottom":"2px solid #124c93"}),this.createBaseWorkSearchDiv(),this.createRightContentDiv("base",e||"")):(this.centerWorkLi&&this.centerWorkLi.setStyles({"border-bottom":"2px solid #124c93"}),this.baseWorkLi&&this.baseWorkLi.setStyles({"border-bottom":""}),this.createCenterWorkSearchDiv(),this.createRightContentDiv("center",e||""))},createCenterWorkSearchDiv:function(){this.rightDrafterTabLi=new Element("li.rightDrafterTabLi",{styles:this.css.rightDrafterTabLi,text:MWF.xApplication.Execution.LP.workTask.centerWorkDrafter}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickCenterWorkTaskNavi("drafter")}.bind(this)}),this.rightDeployTabLi=new Element("li.rightDeployTabLi",{styles:this.css.rightDeployTabLi,text:MWF.xApplication.Execution.LP.workTask.centerWorkDeploy}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickCenterWorkTaskNavi("deploy")}.bind(this)}),this.rightArchiveTabLi=new Element("li.rightArchiveTabLi",{styles:this.css.rightArchiveTabLi,text:MWF.xApplication.Execution.LP.workTask.centerWorkArchive}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickCenterWorkTaskNavi("archive")}.bind(this)}),rightSearchBarSpan=new Element("span.rightSearchBarSpan",{styles:this.css.rightSearchBarSpan}).inject(this.rightSearchDiv),this.rightSearchBarInput=new Element("input.rightSearchBarInput",{styles:this.css.rightSearchBarInput,type:"text"}).inject(rightSearchBarSpan).addEvents({keyup:function(t){13==t.code&&this.searchAction()}.bind(this)}),this.rightSearchBarSearch=new Element("div.rightSearchBarSearch",{styles:this.css.rightSearchBarSearch,text:MWF.xApplication.Execution.LP.workTask.search}).inject(rightSearchBarSpan).addEvents({click:function(){this.searchAction()}.bind(this)})},clickCenterWorkTaskNavi:function(t){this.rightSearchBarInput&&this.rightSearchBarInput.set("value",""),this.workNavi1="center",this.workNavi2=t||"deploy","drafter"==t?(this.rightContentDiv.empty(),this.rightDrafterTabLi&&this.rightDrafterTabLi.setStyles({"border-bottom":"2px solid #124c93"}),this.rightDeployTabLi&&this.rightDeployTabLi.setStyles({"border-bottom":""}),this.rightArchiveTabLi&&this.rightArchiveTabLi.setStyles({"border-bottom":""}),this.loadCenterWorkList("drafter")):"archive"==t?(this.rightContentDiv.empty(),this.rightArchiveTabLi&&this.rightArchiveTabLi.setStyles({"border-bottom":"2px solid #124c93"}),this.rightDeployTabLi&&this.rightDeployTabLi.setStyles({"border-bottom":""}),this.rightDrafterTabLi&&this.rightDrafterTabLi.setStyles({"border-bottom":""}),this.loadCenterWorkList("archive")):(this.rightContentDiv.empty(),this.rightDrafterTabLi&&this.rightDrafterTabLi.setStyles({"border-bottom":""}),this.rightArchiveTabLi&&this.rightArchiveTabLi.setStyles({"border-bottom":""}),this.rightDeployTabLi&&this.rightDeployTabLi.setStyles({"border-bottom":"2px solid #124c93"}),this.loadCenterWorkList("deploy"))},createBaseWorkSearchDiv:function(){this.baseAllTabLi=new Element("li.baseAllTabLi",{styles:this.css.baseTabLi,text:this.lp.baseWorkCategory.all}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myAll")}.bind(this)}),this.baseDrafterTabLi=new Element("li.baseDrafterTabLi",{styles:this.css.baseTabLi,text:this.lp.baseWorkCategory.myDrafter}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myDrafter")}.bind(this)}),this.baseDeployTabLi=new Element("li.baseDeployTabLi",{styles:this.css.baseTabLi,text:this.lp.baseWorkCategory.myDeploy}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myDeploy")}.bind(this)}),this.baseDoTabLi=new Element("li.baseDoTabLi",{styles:this.css.baseTabLi,text:this.lp.baseWorkCategory.myDo}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myDo")}.bind(this)}),this.baseAssistTabLi=new Element("li.baseAssistTabLi",{styles:this.css.baseTabLi,text:this.lp.baseWorkCategory.myAssist}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myAssist")}.bind(this)}),this.baseReadTabLi=new Element("li.baseReadTabLi",{styles:this.css.baseTabLi,text:this.lp.baseWorkCategory.myRead}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myRead")}.bind(this)}),this.appointSwitch&&"OPEN"==this.appointSwitch.toUpperCase()&&(this.baseAppointTabLi=new Element("li.baseAppointTabLi",{styles:this.css.baseTabLi,text:this.lp.baseWorkCategory.myAppoint}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myAppoint")}.bind(this)})),this.baseArchiveTabLi=new Element("li.baseArchiveTabLi",{styles:this.css.baseTabLi,text:this.lp.baseWorkCategory.myArchive}).inject(this.rightSearchDiv).addEvents({click:function(){this.clickBaseWorkTaskNavi("myArchive")}.bind(this)}),rightSearchBarSpan=new Element("span.rightSearchBarSpan",{styles:this.css.rightSearchBarSpan}).inject(this.rightSearchDiv),this.rightSearchBarInput=new Element("input.input",{styles:this.css.rightSearchBarInput,type:"text"}).inject(rightSearchBarSpan).addEvents({keyup:function(t){13==t.code&&this.searchAction()}.bind(this)}),this.rightSearchBarSearch=new Element("div.rightSearchBarSearch",{styles:this.css.rightSearchBarSearch,text:this.lp.searchButton.search}).inject(rightSearchBarSpan).addEvents({click:function(){this.searchAction()}.bind(this)})},clickBaseWorkTaskNavi:function(t){this.rightSearchBarInput&&this.rightSearchBarInput.set("value",""),this.workNavi1="base",this.workNavi2=t||"myDo","myDrafter"==t?(this.changeBaseWork(this.baseDrafterTabLi),this.loadBaseWorkList("myDrafter")):"myDeploy"==t?(this.changeBaseWork(this.baseDeployTabLi),this.loadBaseWorkList("myDeploy")):"myDo"==t?(this.changeBaseWork(this.baseDoTabLi),this.loadBaseWorkList("myDo")):"myAssist"==t?(this.changeBaseWork(this.baseAssistTabLi),this.loadBaseWorkList("myAssist")):"myRead"==t?(this.changeBaseWork(this.baseReadTabLi),this.loadBaseWorkList("myRead")):"myAppoint"==t?(this.changeBaseWork(this.baseAppointTabLi),this.loadBaseWorkList("myAppoint")):"myArchive"==t?(this.changeBaseWork(this.baseArchiveTabLi),this.loadBaseWorkList("myArchive")):"myAll"==t?(this.changeBaseWork(this.baseAllTabLi),this.loadBaseWorkList("myAll")):(this.changeBaseWork(this.baseDoTabLi),this.loadBaseWorkList("myDo"))},reloadRightContentDiv:function(){this.rightContentDiv&&this.rightContentDiv.destroy(),this.rightContentDiv=new Element("div.rightContentDiv",{styles:this.css.rightContentDiv}).inject(this.contentDiv),this.rightContentDiv.setStyles({width:this.app.middleContent.getSize().x-this.naviDiv.getSize().x-6+"px"})},createRightContentDiv:function(t,e){this.rightContentDiv&&this.rightContentDiv.destroy(),this.rightContentDiv=new Element("div.rightContentDiv",{styles:this.css.rightContentDiv}).inject(this.contentDiv),"base"==t?this.clickBaseWorkTaskNavi(e):this.clickCenterWorkTaskNavi(e)},createTableContent:function(t,e){},loadCenterWorkList:function(t,e){this.baseView&&delete this.baseView,this.reloadRightContentDiv(),this.rightContentDiv.setStyles({height:this.app.middleContent.getSize().y-40-140+"px"});var i=this.path+"centerWorkAll.json";this.centerView=new MWF.xApplication.Execution.WorkList.CenterWorkView(this.rightContentDiv,this.app,{explorer:this,lp:this.app.lp.centerWorkView,css:this.css,actions:this.actions},{templateUrl:i,category:t,filterData:e}),this.centerView.load(),this.app.setScrollBar(this.rightContentDiv,this.centerView)},loadBaseWorkList:function(t,e){this.workNavi2=t||"deploy",this.centerView&&delete this.centerView,this.reloadRightContentDiv(),this.rightContentDiv.setStyles({height:this.app.middleContent.getSize().y-40-140+"px"});var i=this.path+"baseWorkAll.json";this.scrollBar&&this.scrollBar.scrollVAreaNode&&this.scrollBar.scrollVAreaNode.destroy(),this.baseView=new MWF.xApplication.Execution.WorkList.BaseWorkView(this.rightContentDiv,this.app,{lp:this.app.lp.baseWorkView,css:this.css,actions:this.actions},{templateUrl:i,category:t,filterData:e}),this.baseView.load(),this.app.setScrollBar(this.rightContentDiv,this.baseView)},createProcessDocument:function(t,e){this.app.createShade(),this.actionProcess.startWork(function(t){this.afterStartProcess(t.data),this.actions.bindCheck(e.data.baseWorkId,t.data[0].work,function(t){this.app.destroyShade(),this.clickBaseWorkTaskNavi(this.workNavi2||"")}.bind(this))}.bind(this),null,t,e)},afterStartProcess:function(t){var e={workId:t[0].work};this.app.desktop.openApplication(null,"process.Work",e)},changeBaseWork:function(t){this.rightSearchDiv.getElements("li").setStyle("border-bottom",""),t.setStyle("border-bottom","2px solid #124c93")},searchAction:function(){var t={};t.workTitle=this.rightSearchBarInput.get("value"),"base"==this.workNavi1?this.loadBaseWorkList(this.workNavi2,t):"center"==this.workNavi1&&this.loadCenterWorkList(this.workNavi2,t)},showErrorMessage:function(t,e,i){var o=i;if(t&&(errorMessage=t.responseText),""!=errorMessage){var s=JSON.parse(errorMessage);s.message?this.app.notice(s.message,"error"):this.app.notice(o,"error")}else this.app.notice(o,"error")}}),MWF.xApplication.Execution.WorkList.WorkForm=new Class({Extends:MPopupForm,createTopNode:function(){this.formTopNode||(this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode),this.formTopImg=new Element("img.formTopImg",{styles:this.css.formTopImg,src:"../x_component_Execution/$Main/default/icon/Document-104.png"}).inject(this.formTopNode),this.formTopSpan=new Element("span.formTopSpan",{styles:this.css.formTopSpan,text:this.options.title}).inject(this.formTopNode),this.options.closeAction&&(this.formTopCloseActionNode=new Element("div.formTopCloseActionNode",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode),this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))))},_createBottomContent:function(){var t="<span style='color:#f59353'>"+MWF.xApplication.Execution.LP.workTask.popUp.createNewTask.title+"</span>："+MWF.xApplication.Execution.LP.workTask.popUp.createNewTask.explain;t+="<br><span style='color:#f59353'>"+MWF.xApplication.Execution.LP.workTask.popUp.createAddTask.title+"</span>："+MWF.xApplication.Execution.LP.workTask.popUp.createAddTask.explain,this.createExplainDiv=new Element("div.createExplainDiv",{styles:this.css.createExplainDiv,html:t}).inject(this.formBottomNode)}}),MWF.xApplication.Execution.WorkList.CenterWorkView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkList.CenterWorkDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.options.category;e||(e=15);var o=this.items.length?this.items[this.items.length-1].data.id:"(0)";"(0)"==o&&this.app.createShade();var s=this.options.filterData||{};s.maxCharacterNumber="-1","deploy"==i?(this.tabLocation="centerDeploy",this.actions.getCenterWorkDeployListNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))):"drafter"==i?(this.tabLocation="centerDrafter",this.actions.getCenterWorkDrafterListNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))):"archive"==i?(this.tabLocation="centerArchive",this.actions.getCenterWorkArchiveListNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))):(this.tabLocation="centerDeploy",this.actions.getCenterWorkDeployListNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this),null,!1))},_removeDocument:function(t,e){this.actions.deleteCenterWork(t.id,function(){"centerDrafter"==this.tabLocation?this.app.workList.loadCenterWorkList("drafter"):"centerDeploy"==this.tabLocation&&this.app.workList.loadCenterWorkList("deploy"),this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t){MWF.xDesktop.requireApp("Execution","WorkDeploy",function(){this.workDeploy=new MWF.xApplication.Execution.WorkDeploy(this,this.actions,{id:t.id},{isEdited:!1,centerWorkId:t.id,onReloadView:function(t){t&&t.action&&"reload"==t.action&&this.explorer.explorer.createRightContentDiv(this.explorer.explorer.workNavi1,this.explorer.explorer.workNavi2)}.bind(this)}),this.workDeploy.load()}.bind(this))},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWF.xApplication.Execution.WorkList.CenterWorkDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,viewActionReturn:function(t){var e=!1;return t.operation&&1==t.operation.length&&(e=!0),e},editActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("EDIT")>-1&&(e=!0),e},deleteActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("DELETE")>-1&&(e=!0),e},action_view:function(){MWF.xDesktop.requireApp("Execution","WorkDeploy",function(){this.workDeploy=new MWF.xApplication.Execution.WorkDeploy(this.view,this.view.app.restActions,{id:this.data.id},{isEdited:!1,centerWorkId:this.data.id,onReloadView:function(t){t&&t.action&&"reload"==t.action&&this.explorer.explorer.clickCenterWorkTaskNavi("drafter")}.bind(this)}),this.workDeploy.load()}.bind(this))},action_edit:function(){MWF.xDesktop.requireApp("Execution","WorkDeploy",function(){this.workDeploy=new MWF.xApplication.Execution.WorkDeploy(this.view,this.view.app.restActions,{id:this.data.id},{isEdited:!0,centerWorkId:this.data.id}),this.workDeploy.load()}.bind(this))},action_delete:function(t){var e=this;e.view.app.confirm("warn",t,e.view.app.lp.workList.submitWarn.warnTitle,e.view.app.lp.workList.submitWarn.warnContent.delete,300,120,(function(){e.actions.deleteCenterWork(e.data.id,function(t){t.type&&"success"==t.type&&(this.app.notice(e.view.app.lp.workList.prompt.deleteCenterWork,"success"),e.app.workList.loadCenterWorkList(this.app.workList.workNavi2))}.bind(e),function(t,i,o){e.explorer.explorer.showErrorMessage(t,i,o)}.bind(e)),this.close()}),(function(){this.close()}))},_postCreateDocumentNode:function(t,e){if(t.getElements("span[icon='showIcon']"))for(var i=t.getElements("span[icon='showIcon']"),o=e.workProcessIdentity,s=this.app.workList.path+"default/icon/",n="margin-left:5px",a=0;a<o.length;a++)"AUTHORIZE"==o[a]||"TACKBACK"==o[a]||"AUTHORIZECANCEL"==o[a]?i.set("html",i.get("html")+"<img src='"+s+"authorize.png' style='"+n+"' >"):"RESPONSIBILITY"==o[a]?i.set("html",i.get("html")+"<img src='"+s+"responsibility.png' style='"+n+"' >"):"COOPERATE"==o[a]?i.set("html",i.get("html")+"<img src='"+s+"cooperate.png' style='"+n+"' >"):"READ"==o[a]?i.set("html",i.get("html")+"<img src='"+s+"read.png' style='"+n+"' >"):"DEPLOY"==o[a]?i.set("html",i.get("html")+"<img src='"+s+"deploy.png' style='"+n+"' >"):"VIEW"==o[a]&&i.set("html",i.get("html")+"<img src='"+s+"view.png' style='"+n+"' >")}}),MWF.xApplication.Execution.WorkList.BaseWorkView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkList.BaseWorkDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.category=this.options.category;e||(e=20);var o=this.items.length?this.items[this.items.length-1].data.id:"(0)";"(0)"==o&&this.app.createShade();var s=this.options.filterData||{};s.maxCharacterNumber="-1","myDrafter"==i?(this.tabLocation="baseDrafter",this.actions.getBaseWorkListMyDrafterNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))):"myDeploy"==i?(this.tabLocation="baseDeploy",this.actions.getBaseWorkListMyDeployNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))):"myDo"==i?(this.tabLocation="baseDo",this.actions.getBaseWorkListMyDoNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))):"myAssist"==i?(this.tabLocation="baseAssist",this.actions.getBaseWorkListMyAssistNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))):"myRead"==i?(this.tabLocation="baseRead",this.actions.getBaseWorkListMyReadNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))):"myAppoint"==i?(this.tabLocation="baseAppoint",this.actions.getBaseWorkListMyAppointNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))):"myArchive"==i?(this.tabLocation="baseArchive",this.actions.getBaseWorkListMyArchiveNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))):"myAll"==i&&(this.tabLocation="baseAll",this.actions.getBaseWorkListAllNext(o,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))),this.app.workList.tabLocation=this.tabLocation},_removeDocument:function(t){this.actions.deleteBaseWork(t.id,function(t){t.type&&"success"==t.type&&("baseDrafter"==this.tabLocation?this.app.workList.loadBaseWorkList("myDrafter"):"baseDeploy"==this.tabLocation&&this.app.workList.loadBaseWorkList("myDeploy"),this.app.notice(this.app.lp.deleteDocumentOK,"success"))}.bind(this),function(t,e,i){var o=i;t&&(errorMessage=t.responseText);var s=JSON.parse(errorMessage);s.message?this.app.notice(s.message,"error"):this.app.notice(o,"error")}.bind(this))},_create:function(){},_openDocument:function(t){t.workProcessStatus==this.lp.workProcessStatus.drafter?MWF.xDesktop.requireApp("Execution","WorkForm",function(){new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,t,{isNew:!1,isEdited:!1,tabLocation:this.category}).load()}.bind(this)):MWF.xDesktop.requireApp("Execution","WorkDetail",function(){new MWF.xApplication.Execution.WorkDetail(this,this.app.restActions,t,{isNew:!1,isEdited:!1,tabLocation:this.category}).load()}.bind(this))},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWF.xApplication.Execution.WorkList.BaseWorkDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,viewActionReturn:function(t){var e=!1;return t.operation&&1==t.operation.length&&(e=!0),e},editActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("EDIT")>-1&&(e=!0),e},splitActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("SPLIT")>-1&&(e=!0),e},authorizeActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("AUTHORIZE")>-1&&(e=!0),e},tackBackActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("TACKBACK")>-1&&(e=!0),e},reportActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("REPORT")>-1&&(e=!0),e},deleteActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("DELETE")>-1&&(e=!0),e},archiveActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("ARCHIVE")>-1&&(e=!0),e},checkActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("APPRAISE")>-1&&(e=!0),e},progressActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("PROGRESS")>-1&&(e=!0),e},action_view:function(){this.data.workProcessStatus==this.lp.workProcessStatus.drafter?MWF.xDesktop.requireApp("Execution","WorkForm",function(){new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,this.data,{isNew:!1,isEdited:!1,tabLocation:this.category}).load()}.bind(this)):MWF.xDesktop.requireApp("Execution","WorkDetail",function(){new MWF.xApplication.Execution.WorkDetail(this,this.app.restActions,this.data,{isNew:!1,isEdited:!1,tabLocation:this.category}).load()}.bind(this))},action_edit:function(){MWF.xDesktop.requireApp("Execution","WorkForm",function(){new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,this.data,{isNew:!1,isEdited:!0,tabLocation:this.view.category,actionStatus:"save"}).load()}.bind(this))},action_split:function(){MWF.xDesktop.requireApp("Execution","WorkForm",function(){new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,{centerWorkTitle:this.data.centerTitle},{isNew:!0,isEdited:!1,parentWorkId:this.data.id,actionStatus:"deploy"}).load()}.bind(this))},action_authorize:function(){var t={workId:this.data.id};new MWF.xApplication.Execution.WorkList.Appoint(this.view.app,this.view.app.restActions,t,this.view.css,{ieEdited:!0,onReloadView:function(){this.view.app.workList.clickBaseWorkTaskNavi("myAppoint")}.bind(this)}).load()},action_tackBack:function(t){var e=this;e.view.app.confirm("warn",t,e.view.app.lp.workList.submitWarn.warnTitle,e.view.app.lp.workList.submitWarn.warnContent.tackBack,300,120,(function(){var t={workId:e.data.id};e.actions.unAppointBaseWork(t,function(){this.app.notice(e.view.app.lp.workList.prompt.tackbackBaseWork,"success")}.bind(e),function(t,e,i){var o=i;t&&(errorMessage=t.responseText);var s=JSON.parse(errorMessage);s.message?this.app.notice(s.message,"error"):this.app.notice(o,"error")}.bind(e),!1),e.view.app.workList.clickBaseWorkTaskNavi("myAppoint"),this.close()}),(function(){this.close()}))},action_report:function(){MWF.xDesktop.requireApp("Execution","WorkReport",function(){var t={workId:this.data.id};new MWF.xApplication.Execution.WorkReport(this,this.app.restActions,t,{isNew:!1,isEdited:!1,tabLocation:this.view.category,from:"drafter"}).load()}.bind(this))},action_delete:function(t){var e=this;e.view.app.confirm("warn",t,e.view.app.lp.workList.submitWarn.warnTitle,e.view.app.lp.workList.submitWarn.warnContent.delete,300,120,(function(){e.actions.deleteBaseWork(e.data.id,function(t){t.type&&"success"==t.type&&(this.app.notice(e.view.app.lp.workList.prompt.deleteBaseWork,"success"),e.app.workList.clickBaseWorkTaskNavi(e.app.workList.workNavi2))}.bind(e),function(t,i,o){e.app.WorkList.showErrorMessage(t,i,o)}.bind(e)),this.close()}),(function(){this.close()}))},action_archive:function(t){var e=this;e.view.app.confirm("warn",t,e.view.app.lp.workList.submitWarn.warnTitle,e.view.app.lp.workList.submitWarn.warnContent.archive,300,120,(function(){e.actions.archiveBaseWork(e.data.id,function(t){t.type&&"success"==t.type&&(this.app.notice(e.view.app.lp.workList.prompt.archiveBaseWork,"success"),e.app.workList.clickBaseWorkTaskNavi(e.app.workList.workNavi2))}.bind(e),function(t,i,o){e.app.WorkList.showErrorMessage(t,i,o)}.bind(e)),this.close()}),(function(){this.close()}))},action_check:function(t){var e=this;this.actions.getProfileByCode({configCode:"APPRAISE_WORKFLOW_ID"},function(i){if("success"==i.type&&i.data&&i.data.configValue){var o=i.data.configValue,s={configCode:"REPORT_SUPERVISOR"};this.actions.getProfileByCode(s,function(i){if("success"==i.type&&i.data&&i.data.configValue){this.companyAdmin=i.data.configValue;var s="";e.data.responsibilityUnitName&&(s=e.data.responsibilityUnitName.split("@")[0]);var n={title:"关于"+s+"《"+e.data.title+"》的考核",data:{createPerson:this.companyAdmin,baseWorkTitle:e.data.title,baseWorkId:e.data.id}};e.view.app.confirm("warn",t,e.view.app.lp.workList.submitWarn.warnTitle,e.view.app.lp.workList.submitWarn.warnContent.startProcess,300,120,(function(){e.view.app.workList.createProcessDocument(o,n),this.close()}),(function(){this.close()}))}}.bind(this))}}.bind(this))},action_progress:function(t){var e={title:this.data.title,workId:this.data.id,isCompleted:this.data.isCompleted,overallProgress:this.data.overallProgress};new MWF.xApplication.Execution.WorkList.Progress(this.view.app,this.view.app.restActions,e,this.view.css,{ieEdited:!0,onReloadView:function(t){this.view.app.workList.clickBaseWorkTaskNavi(this.app.workList.workNavi2||"")}.bind(this)}).load()},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){if(t.getElements("div[name='appointDiv']")&&e.okrWorkAuthorizeRecord&&t.getElements("div[name='appointDiv']").setStyle("display",""),t.getElements("div[item='workDetail']")&&t.getElements("div[item='workDetail']").set("title",e.workDetail),t.getElements("div[item='progressAction']")&&t.getElements("div[item='progressAction']").set("title",e.progressAction),t.getElements("span[icon='showIcon']")){var o=t.getElements("span[icon='showIcon']"),s=e.workProcessIdentity,n=this.app.workList.path+"default/icon/",a="margin-left:5px";for(i=0;i<s.length;i++)"AUTHORIZE"==s[i]||"TACKBACK"==s[i]||"AUTHORIZECANCEL"==s[i]?o.set("html",o.get("html")+"<img src='"+n+"authorize.png' style='"+a+"' >"):"RESPONSIBILITY"==s[i]?o.set("html",o.get("html")+"<img src='"+n+"responsibility.png' style='"+a+"' >"):"COOPERATE"==s[i]?o.set("html",o.get("html")+"<img src='"+n+"cooperate.png' style='"+a+"' >"):"READ"==s[i]?o.set("html",o.get("html")+"<img src='"+n+"read.png' style='"+a+"' >"):"DEPLOY"==s[i]?o.set("html",o.get("html")+"<img src='"+n+"deploy.png' style='"+a+"' >"):"VIEW"==s[i]?o.set("html",o.get("html")+"<img src='"+n+"view.png' style='"+a+"' >"):("COMPLETED"==s[i]||"ARCHIVE"==s[i])&&o.set("html",o.get("html")+"<img src='"+n+"completed.png' style='"+a+"' >")}}}),MWF.xApplication.Execution.WorkList.Appoint=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"500",height:"300",hasTop:!0,hasIcon:!1,hasBottom:!0,title:"",draggable:!1,closeAction:!0,closeText:"",needLogout:!1,isNew:!0},initialize:function(t,e,i,o,s){this.setOptions(s),this.app=t,this.actions=this.app.restActions,this.css=o,this.data=i||{},this.actions=e},load:function(){this.create()},createTopNode:function(){this.formTopNode||(this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode),this.formTopIconNode=new Element("div.formTopIconNode",{styles:this.css.formTopIconNode}).inject(this.formTopNode),this.formTopTextNode=new Element("div.formTopTextNode",{styles:this.css.formTopTextNode,text:this.app.lp.workTask.appoint.appointTitle}).inject(this.formTopNode),this.options.closeAction&&(this.formTopCloseActionNode=new Element("div.formTopCloseActionNode",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode),this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))),this.formTopContentNode=new Element("div.formTopContentNode",{styles:this.css.formTopContentNode}).inject(this.formTopNode))},_createTableContent:function(){var t=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0"}).inject(this.formTableArea);t.setStyles({"margin-top":"40px"});var e=new Element("tr").inject(t),i=new Element("td",{text:this.app.lp.workTask.appoint.appointFor,valign:"middle",width:"20%"}).inject(e);i=new Element("td",{width:"80%"}).inject(e),this.appointPerson=new MDomItem(i,{name:"appointPerson",type:"org",orgType:"identity",notEmpty:!0,style:{width:"90%",height:"25px",border:"1px solid #666"}},!0,this.app),this.appointPerson.load(),e=new Element("tr").inject(t),i=new Element("td",{text:this.app.lp.workTask.appoint.appointOpinion,valign:"middle"}).inject(e),i=new Element("td").inject(e),this.appointOpinion=new Element("textarea").inject(i),this.appointOpinion.setStyles({width:"90%",height:"50px"})},_createBottomContent:function(){this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.app.lp.workTask.appoint.appointCancel}).inject(this.formBottomNode),this.cancelActionNode.addEvent("click",function(){this.close()}.bind(this)),this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.app.lp.workTask.appoint.appointOK}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(t){this.ok(t)}.bind(this))},ok:function(){if(""==this.appointPerson.getValue(","))return this.app.notice(this.app.lp.workTask.appoint.personEmpty,"error"),!1;if(""==this.appointOpinion.get("value"))return this.app.notice(this.app.lp.workTask.appoint.opinionEmpty,"error"),!1;var t={workId:this.data.workId,undertakerIdentity:this.appointPerson.getValue(","),authorizeOpinion:this.appointOpinion.get("value")};this.actions.appointBaseWork(t,function(t){this.close(),this.fireEvent("reloadView")}.bind(this),function(t,e,i){var o=i;t&&(errorMessage=t.responseText);var s=JSON.parse(errorMessage);s.message?this.app.notice(s.message,"error"):this.app.notice(o,"error")}.bind(this),!1)},selectPerson:function(t,e,i){MWF.xDesktop.requireApp("Selector","package",null,!1),this.fireEvent("querySelect",this);var o=t.get("value").split(this.valSeparator),s={type:e,title:this.app.lp.workTask.appoint.appointTitle,count:i,values:o||[],onComplete:function(e){var i=[];e.each(function(t){i.push(t.data.distinguishedName)}.bind(this)),t.set("value",i.join(","))}.bind(this)};new MWF.O2Selector(this.app.content,s)}}),MWF.xApplication.Execution.WorkList.Progress=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"400",height:"200",hasTop:!0,hasIcon:!1,hasBottom:!0,title:"",draggable:!0,closeAction:!0,closeText:"",needLogout:!1,isNew:!0},initialize:function(t,e,i,o,s){this.setOptions(s),this.app=t,this.actions=this.app.restActions,this.css=o,this.data=i||{},this.actions=e},load:function(){this.create()},createTopNode:function(){this.formTopNode||(this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode),this.formTopIconNode=new Element("div.formTopIconNode",{styles:this.css.formTopIconNode}).inject(this.formTopNode),this.formTopTextNode=new Element("div.formTopTextNode",{styles:this.css.formTopTextNode,text:this.app.lp.workList.progress.progressTitle}).inject(this.formTopNode),this.options.closeAction&&(this.formTopCloseActionNode=new Element("div.formTopCloseActionNode",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode),this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))),this.formTopContentNode=new Element("div.formTopContentNode",{styles:this.css.formTopContentNode}).inject(this.formTopNode))},_createTableContent:function(){this.formTableArea.setStyles({"margin-top":"40px"});var t=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0"}).inject(this.formTableArea);t.setStyles({"margin-top":"10px"}),tr=new Element("tr").inject(t),tr=new Element("tr").inject(t),new Element("td",{text:this.app.lp.workList.progress.completedPercent,align:"center",width:"40%"}).inject(tr);var e=new Element("td").inject(tr);this.completePercentSelect=new Element("select.completePercentSelect").inject(e);new Element("option.completePercentSelectOption",{text:"0%",value:"0"}).inject(this.completePercentSelect);new Element("option.completePercentSelectOption",{text:"10%",value:"10"}).inject(this.completePercentSelect),new Element("option.completePercentSelectOption",{text:"20%",value:"20"}).inject(this.completePercentSelect),new Element("option.completePercentSelectOption",{text:"30%",value:"30"}).inject(this.completePercentSelect),new Element("option.completePercentSelectOption",{text:"40%",value:"40"}).inject(this.completePercentSelect),new Element("option.completePercentSelectOption",{text:"50%",value:"50"}).inject(this.completePercentSelect),new Element("option.completePercentSelectOption",{text:"60%",value:"60"}).inject(this.completePercentSelect),new Element("option.completePercentSelectOption",{text:"70%",value:"70"}).inject(this.completePercentSelect),new Element("option.completePercentSelectOption",{text:"80%",value:"80"}).inject(this.completePercentSelect),new Element("option.completePercentSelectOption",{text:"90%",value:"90"}).inject(this.completePercentSelect),new Element("option.completePercentSelectOption",{text:"100%",value:"100"}).inject(this.completePercentSelect),this.completePercentSelect.set("value",parseInt(this.data.overallProgress))},_createBottomContent:function(){this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.app.lp.workTask.appoint.appointCancel}).inject(this.formBottomNode),this.cancelActionNode.addEvent("click",function(t){this.close()}.bind(this)),this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.app.lp.workTask.appoint.appointOK}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(t){this.ok(t)}.bind(this))},ok:function(){var t=this.completePercentSelect.get("value");this.actions.progressBaseWork(this.data.workId,parseInt(t),function(t){this.close(),this.fireEvent("reloadView")}.bind(this),function(t,e,i){this.app.showErrorMessage(t,e,i)}.bind(this))}});