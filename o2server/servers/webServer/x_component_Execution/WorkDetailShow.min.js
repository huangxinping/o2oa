MWF.xApplication.Execution=MWF.xApplication.Execution||{},MWF.xDesktop.requireApp("Execution","WorkForm",null,!1),MWF.xDesktop.requireApp("Execution","Chat",null,!1),MWF.xDesktop.requireApp("Execution","ReportAttachment",null,!1),MWF.xApplication.Execution.WorkDetailShow=new Class({Extends:MWF.xApplication.Execution.WorkForm,Implements:[Options,Events],options:{style:"default",width:"100%",height:"100%",hasTop:!0,hasIcon:!1,hasBottom:!1,title:"",draggable:!0,closeAction:!0,isNew:!1,isEdited:!0,hasScroll:!1},initialize:function(t,e,i,s){this.setOptions(s),this.explorer=t,this.app=t.app||t,this.lp=this.app.lp,this.actions=this.app.restActions,this.path="../x_component_Execution/$WorkDetailShow/",this.cssPath=this.path+this.options.style+"/css.wcss",this._loadCss(),this.options.title=this.lp.title,this.data=i||{},this.workDetailLp=this.app.lp.WorkDetail,this.actions.getBaseWorkInfo(this.data.id,function(t){t.data&&(this.baseWorkData=t.data)}.bind(this),function(t,e,i){this.showErrorMessage(t,e,i)}.bind(this),!1)},reload:function(){this._createTableContent(),this.setFormNodeSize()},createTopNode:function(){this.formTopNode||(this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode),this.formTopIconNode=new Element("div",{styles:this.css.formTopIconNode}).inject(this.formTopNode),this.formTopTextNode=new Element("div.formTopTextNode",{styles:this.css.formTopTextNode,text:this.data.title||""}).inject(this.formTopNode),this.options.closeAction&&(this.formTopCloseActionNode=new Element("div",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode),this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))),this._createTopContent())},_createTopContent:function(){},_createTableContent:function(){this.table&&this.table.destroy(),this.table=new Element("table.table",{height:"100%",border:"0",cellpadding:"0",cellspacing:"0",class:"formTable"}).inject(this.formTableArea),this.tr=new Element("tr",{valign:"top"}).inject(this.table),this.leftArea=new Element("td.leftArea",{styles:this.css.leftArea}).inject(this.tr),this.detailArea=new Element("td.detailArea",{styles:this.css.detailArea}).inject(this.tr),this.chatArea=new Element("td.chatArea",{styles:this.css.chatArea}).inject(this.tr),this.loadLeftContent(),this.loadForm(),this.loadChatNode(),this.setContentSize(),this.setContentSizeFun=this.setContentSize.bind(this),this.app.addEvent("resize",this.setContentSizeFun)},loadLeftContent:function(){this.reportArea=new Element("div.reportArea",{styles:this.css.reportArea}).inject(this.leftArea),this.loadReportTop(),this.loadReportContent(),this.questionArea=new Element("div.questionArea",{styles:this.css.questionArea}).inject(this.leftArea),this.loadQuestionTop(),this.loadQuestionContent()},loadReportTop:function(){this.reportTopNode=new Element("div.reportTopNode",{styles:this.css.reportTopNode}).inject(this.reportArea),this.reportTopIconNode=new Element("div.reportTopIconNode",{styles:this.css.reportTopIconNode}).inject(this.reportTopNode),this.reportTopTextNode=new Element("div.reportTopTextNode",{styles:this.css.reportTopTextNode,text:this.lp.workReportTitle}).inject(this.reportTopNode),this.actions.getBaseWorkActions(this.baseWorkData.id,function(t){"success"==t.type&&t.data&&t.data.operation&&t.data.operation.indexOf("REPORT")>-1&&(this.startReportDiv=new Element("div.startReport",{styles:this.css.startReport,text:this.lp.WorkDetail.startReport}).inject(this.reportTopNode),this.startReportDiv.addEvents({click:function(){MWF.xDesktop.requireApp("Execution","WorkReport",function(){var t={workId:this.baseWorkData.id};new MWF.xApplication.Execution.WorkReport(this,this.actions,t,{isNew:!1,isEdited:!1,tabLocation:"workDetail",from:"drafter",onPostClose:function(){this.reload()}.bind(this)}).load()}.bind(this))}.bind(this)}))}.bind(this))},loadReportContent:function(){_self=this,this.reportContentNode=new Element("div.reportContentNode",{styles:this.css.reportContentNode}).inject(this.reportArea),this.getReportData(function(t){t.data&&t.data.each(function(t){var e="";if(t.activityName==this.lp.WorkReport.activityName.drafter?e="#ff0000":t.processLogs&&t.processLogs.each(function(t){t.activityName==this.lp.WorkReport.activityName.leader&&(e="#00FF00")}.bind(this)),""==t.progressDescription&&""==t.workPlan&&(e="#ff0000"),t.createTime)var i=t.createTime.split(" ")[0].split("-"),s=i[0]+this.lp.year+i[1]+this.lp.month+i[2]+this.lp.day;else s="";var o=new Element("div",{styles:this.css.reportItemNode}).inject(this.reportContentNode);new Element("div",{styles:this.css.reportItemIconNode}).inject(o);new Element("div",{styles:this.css.reportItemTextNode,html:"<font color='"+e+"'>"+s+"-"+t.shortTitle+"</font>"}).inject(o);o.addEvents({mouseover:function(){_self.curReportItemNode!=this.node&&this.node.setStyles(_self.css.reportItemNode_over)}.bind({node:o}),mouseout:function(){_self.curReportItemNode!=this.node&&this.node.setStyles(_self.css.reportItemNode)}.bind({node:o}),click:function(){this.node!=_self.curReportItemNode&&(this.node.setStyles(_self.css.reportItemNode_over),_self.curReportItemNode&&_self.curReportItemNode.setStyles(_self.css.reportItemNode),_self.curReportItemNode=this.node,_self.createPrevReportInfor(this.data.id))}.bind({data:t,node:o})})}.bind(this))}.bind(this)),this.setScrollBar(this.reportContentNode)},getReportData:function(t){this.actions.getWorkReportList(this.data.id,(function(e){t&&t(e)}))},createPrevReportInfor:function(t){var e=this.app.lp.WorkReport;this.prevReportInforDiv&&this.prevReportInforDiv.destroy(),this.prevReportInforDiv=new Element("div.prevReportInforDiv",{styles:this.css.prevReportInforDiv}).inject(this.formTableContainer),this.prevReportInforDiv.setStyles({height:this.allSize.y-this.formTopNode.getHeight()+"px"}),this.prevReportInforTopDiv=new Element("div.prevReportInforTopDiv",{styles:this.css.prevReportInforTopDiv}).inject(this.prevReportInforDiv),this.prevReportInforTopCloseDiv=new Element("div.prevReportInforTopCloseDiv",{styles:this.css.prevReportInforTopCloseDiv}).inject(this.prevReportInforTopDiv).addEvents({click:function(){this.prevReportInforDiv.destroy(),this.curReportItemNode&&this.curReportItemNode.setStyles(this.css.reportItemNode),this.curReportItemNode=null}.bind(this)}),this.prevReportInforListDiv=new Element("div.prevReportInforListDiv",{styles:this.css.prevReportInforListDiv}).inject(this.prevReportInforDiv),this.prevReportInforListDiv.setStyles({height:this.reportContentInforHeight+"px"}),this.createShade(this.prevReportInforDiv),this.actions.getWorkReport(t,function(i){if(this.destroyShade(),"success"==i.type){var s=new Element("div.prevContentDiv",{styles:this.css.prevContentDiv}).inject(this.prevReportInforListDiv),o=new Element("div.prevContentTitleDiv",{styles:this.css.prevContentTitleDiv,text:e.contentTitle1+":"}).inject(s),n=new Element("div.prevContentValueDiv",{styles:this.css.prevContentValueDiv,text:i.data.progressDescription}).inject(s);s=new Element("div.prevContentDiv",{styles:this.css.prevContentDiv}).inject(this.prevReportInforListDiv),o=new Element("div.prevContentTitleDiv",{styles:this.css.prevContentTitleDiv,text:e.contentTitle2+":"}).inject(s),n=new Element("div.prevContentValueDiv",{styles:this.css.prevContentValueDiv,text:i.data.workPlan}).inject(s),s=new Element("div.prevContentDiv",{styles:this.css.prevContentDiv}).inject(this.prevReportInforListDiv),o=new Element("div.prevContentTitleDiv",{styles:this.css.prevContentTitleDiv,text:this.workDetailLp.isCompleted+":"}).inject(s);var r=i.data.isWorkCompleted?" 是 ":" 否 ";r=(r=this.workDetailLp.isCompleted+":"+r)+" "+this.workDetailLp.completePercent+" "+parseInt(i.data.progressPercent)+"%",o.set("text",r),i.data.needAdminAudit&&(s=new Element("div.prevContentDiv",{styles:this.css.prevContentDiv}).inject(this.prevReportInforListDiv),o=new Element("div.prevContentTitleDiv",{styles:this.css.prevContentTitleDiv,text:e.adminContentTitle+":"}).inject(s),n=new Element("div.prevContentValueDiv",{styles:this.css.prevContentValueDiv,text:i.data.adminSuperviseInfo?i.data.adminSuperviseInfo:""}).inject(s)),s=new Element("div.prevContentDiv",{styles:this.css.prevContentDiv}).inject(this.prevReportInforListDiv),o=new Element("div.prevContentTitleDiv",{styles:this.css.prevContentTitleDiv,text:e.leaderContentTitle+":"}).inject(s),n=new Element("div.prevContentValueDiv",{styles:this.css.prevContentValueDiv}).inject(s);var a=new Element("div.reportLeaderOpinionsDiv",{styles:this.css.reportLeaderOpinionsDiv}).inject(n),l=i.data.processLogs;this.preLeaderTitle=[],this.preLeaderValue=[],l&&l.each(function(t){t.activityName==this.lp.WorkReport.activityName.leader&&t.processStatus==this.lp.WorkReport.status.drafter&&t.processorIdentity==this.app.identity?this.leaderOpinionDrafter=t.opinion:t.activityName==this.lp.WorkReport.activityName.leader&&t.processStatus==this.lp.WorkReport.status.effect&&(this.preLeaderTitle.push(t.processorIdentity.split("@")[0]+"("+t.processTimeStr+")"),this.preLeaderValue.push(t.opinion))}.bind(this));for(var p=0;p<this.preLeaderTitle.length;p++){var h=new Element("div.reportLeaderContentDiv",{styles:this.css.reportLeaderContentDiv}).inject(a);h.setStyle("border-bottom","1px dashed #3c76c1");new Element("div.reportLeaderTitleDiv",{styles:this.css.reportLeaderTitleDiv,text:this.preLeaderTitle[p]+":"}).inject(h),new Element("div.reportLeaderValueDiv",{styles:this.css.reportLeaderValueDiv,text:this.preLeaderValue[p]}).inject(h)}s=new Element("div.prevContentDiv",{styles:this.css.prevContentDiv}).inject(this.prevReportInforListDiv),o=new Element("div.prevContentTitleDiv",{styles:this.css.prevContentTitleDiv,text:this.workDetailLp.attachment+":"}).inject(s),n=new Element("div.prevContentValueDiv",{styles:this.css.prevContentValueDiv}).inject(s),this.loadReportAttachment(n,t)}}.bind(this),null,!0),this.setScrollBar(this.prevReportInforListDiv)},loadReportAttachment:function(t,e){this.attachment=new MWF.xApplication.Execution.ReportAttachment(t,this.app,this.actions,this.app.lp,{documentId:e,isNew:this.options.isNew,isEdited:!1,size:"min"}),this.attachment.load()},loadQuestionTop:function(){this.questionTopNode=new Element("div.questionTopNode",{styles:this.css.questionTopNode}).inject(this.questionArea),this.questionTopIconNode=new Element("div",{styles:this.css.questionTopIconNode}).inject(this.questionTopNode),this.questionTopTextNode=new Element("div",{styles:this.css.questionTopTextNode,text:this.lp.workQuestionTitle}).inject(this.questionTopNode)},loadQuestionContent:function(){this.questionContentNode=new Element("div",{styles:this.css.questionContentNode}).inject(this.questionArea),this.setScrollBar(this.questionContentNode),this.getQuestionData(function(t){t.data.each(function(t){var e=new Element("div",{styles:this.css.questionItemNode}).inject(this.questionContentNode);new Element("div",{styles:this.css.questionItemIconNode}).inject(e);new Element("div",{styles:this.css.questionItemTextNode,text:t.subject}).inject(e)}.bind(this))}.bind(this))},getQuestionData:function(t){t&&t({data:[]})},loadChatNode:function(){this.chatTopNode=new Element("div.chatTopNode",{styles:this.css.chatTopNode}).inject(this.chatArea),this.chatTopIconNode=new Element("div",{styles:this.css.chatTopIconNode}).inject(this.chatTopNode),this.chatTopTextNode=new Element("div",{styles:this.css.chatTopTextNode,text:this.lp.workChatTitle}).inject(this.chatTopNode),this.loadChatContent()},loadChatContent:function(){this.chatContentNode=new Element("div",{styles:this.css.chatContentNode}).inject(this.chatArea),this.chatContentListNode=new Element("div.chatContentListNode",{styles:this.css.chatContentListNode}).inject(this.chatContentNode),this.chatEditorNode=new Element("div",{styles:this.css.chatEditorNode}).inject(this.chatContentNode),this.chat=new MWF.xApplication.Execution.Chat(this.chatContentListNode,this.chatEditorNode,this.app,this.actions,this.lp,{workId:this.data.id}),this.chat.load()},getChatData:function(t){t&&t({})},loadForm:function(){if(this.detailTopNode=new Element("div.detailTopNode",{styles:this.css.detailTopNode}).inject(this.detailArea),this.detailTopIconNode=new Element("div.detailTopIconNode",{styles:this.css.detailTopIconNode}).inject(this.detailTopNode),this.detailTopTextNode=new Element("div.detailTopTextNode",{styles:this.css.detailTopTextNode,text:this.lp.workDetailTitle}).inject(this.detailTopNode),this.data.status&&this.data.status==this.workDetailLp.archiveStatus){var t=this.data.archiveDate&&""!=this.data.archiveDate?":"+this.data.archiveDate:"";this.archiveTextDiv=new Element("div.archiveTextDiv",{styles:this.css.archiveTextDiv,text:"("+this.workDetailLp.archiveStatus+t+")"}).inject(this.detailTopNode)}this.detailContentNode=new Element("div.detailContentNode",{styles:this.css.detailContentNode}).inject(this.detailArea);this.detailContentNode.set("html","<table width='100%' border='0' cellpadding='5' cellspacing='0' styles='formTable'><tr>   <td styles='formTableTitle' lable='centerWorkTitle'></td>   <td styles='formTableValue' item='centerWorkTitle' colspan='3'></td></tr><tr>   <td styles='formTableTitle' lable='timeLimit'></td>   <td styles='formTableValue' item='timeLimit'></td>   <td styles='formTableTitle' lable='reportCycle'></td>   <td styles='formTableValue'><span item='reportCycle'></span><span item='reportDay'></span></td></tr><tr>   <td styles='formTableTitle' lable='dutyDepartment'></td>   <td styles='formTableValue' item='dutyDepartment'></td>   <td styles='formTableTitle' lable='dutyPerson'></td>   <td styles='formTableValue' item='dutyPerson'></td></tr><tr>   <td styles='formTableTitle' lable='secondDepartment'></td>   <td styles='formTableValue' item='secondDepartment'></td>   <td styles='formTableTitle' lable='secondPerson'></td>   <td styles='formTableValue' item='secondPerson'></td></tr><tr>   <td styles='formTableTitle' lable='readReader'></td>   <td styles='formTableValue' item='readReader' colspan='3'></td></tr><tr>   <td styles='formTableValue' colspan='4'>       <div styles='formTableTitleDiv' lable='workSplitAndDescription'></div>       <div styles='formTableValueDiv' item='workSplitAndDescription'></div>   </td></tr><tr>   <td styles='formTableValue' colspan='4'>       <div styles='formTableTitleDiv' lable='specificActionInitiatives'></div>       <div styles='formTableValueDiv' item='specificActionInitiatives'></div>   </td></tr><tr>   <td styles='formTableValue' colspan='4'>       <div styles='formTableTitleDiv' lable='milestoneMark'></div>       <div styles='formTableValueDiv' item='milestoneMark'></div>   </td></tr><tr>   <td styles='formTableValue' colspan='4'>       <div styles='formTableValueDiv' item='attachments'></div>   </td></tr></table>"),this.form=new MForm(this.detailContentNode,this.data,{style:"execution",isEdited:this.isEdited||this.isNew,itemTemplate:this.getWorkDetailsItemTemplate(this.lp.workForm),onPostLoad:function(){}.bind(this)},this.app,this.css),this.form.load(),this.attachmentArea=this.detailArea.getElement("[item='attachments']"),this.loadAttachment(this.attachmentArea),this.checkArea=new Element("div.checkArea",{styles:this.css.checkArea}).inject(this.detailContentNode),this.checkTitle=new Element("div.checkTitle",{styles:this.css.checkTitle,text:this.workDetailLp.checkTitle}).inject(this.checkArea),this.checkContent=new Element("div.checkContent",{styles:this.css.checkContent}).inject(this.checkArea);var e=this.workDetailLp.checkEmpty;this.baseWorkData.currentAppraiseStatus&&""!=this.baseWorkData.currentAppraiseStatus&&(e=this.baseWorkData.currentAppraiseStatus==this.workDetailLp.checkCompleted?this.baseWorkData.currentAppraiseStatus:this.workDetailLp.checkFlow),e==this.workDetailLp.checkEmpty?this.checkContent.set("text",e):(this.checkContent.set("text","("+e+")"+this.baseWorkData.currentAppraiseTitle),this.checkContent.setStyles({"text-decoration":"underline",cursor:"pointer"}),this.checkContent.addEvents({click:function(){this.baseWorkData.currentAppraiseStatus==this.workDetailLp.checkCompleted?this.baseWorkData.currentAppraiseJobId&&this.actions.findProcessCompleteId(this.baseWorkData.currentAppraiseJobId,function(t){var e=t.data.workCompletedList;if(e.length>0){var i={workCompletedId:e[0].id,onQueryClose:function(){}.bind(this)};layout.desktop.openApplication(this.event,"process.Work",i)}}.bind(this)):layout.desktop.openApplication(this.event,"process.Work",{workId:this.baseWorkData.currentAppraiseWorkId})}.bind(this)})),this.tmpLp=this.workDetailLp.processInfo,this.processInfo=new Element("div.processInfo",{styles:this.css.processInfoDiv}).inject(this.detailContentNode),this.processInfoTitle=new Element("div.processInfoTitle",{styles:this.css.processInfoTitleDiv,text:this.tmpLp.title}).inject(this.processInfo),this.processInfoContent=new Element("div.processInfoContent",{styles:this.css.processInfoContent}).inject(this.processInfo);var i="<tr>";i+="<td styles='processTH'>"+this.tmpLp.operate+"</td>",i+="<td styles='processTH'>"+this.tmpLp.time+"</td>",i+="<td styles='processTH'>"+this.tmpLp.source.split("@")[0]+"</td>",i+="<td styles='processTH'>"+this.tmpLp.target.split("@")[0]+"</td>",i+="<td styles='processTH'>"+this.tmpLp.opinion+"</td>",i+="</tr>",this.baseWorkData.workDeployAuthorizeRecords&&this.baseWorkData.workDeployAuthorizeRecords.each(function(t){i+="<tr>",i+="<td styles='processTD'>"+t.operationTypeCN+"</td>",i+="<td styles='processTD'>"+t.operationTime+"</td>",i+="<td styles='processTD'>"+t.source.split("@")[0]+"</td>",i+="<td styles='processTD'>"+t.target.split("@")[0]+"</td>",i+="<td styles='processTD'>"+t.opinion+"</td>",i+="</tr>"}.bind(this)),tBottom="</table>",this.processInfoContent.set("html","<table styles='processTable'>"+i+tBottom),this.formatStyles(this.processInfoContent),this.setScrollBar(this.detailContentNode)},formatStyles:function(t){t.getElements("[styles]").each(function(t){var e=t.get("styles");e&&this.css[e]&&t.setStyles(this.css[e])}.bind(this))},getWorkDetailsItemTemplate:function(t){return _self=this,{centerWorkTitle:{text:t.centerWorkTitle+":",value:this.data.centerWorkInfo.title},workType:{text:t.workType+":",type:"select",selectValue:t.workTypeValue.split(",")},workLevel:{text:t.workLevel+":",type:"select",notEmpty:!0,selectValue:t.workLevelValue.split(",")},timeLimit:{text:t.timeLimit+":",tType:"date",name:"completeDateLimitStr",notEmpty:!0},reportCycle:{text:t.reportCycle+":",type:"select",selectText:t.reportCycleText.split(","),event:{change:function(e,i){e.get("value")==t.reportCycleText.split(",")[0]?this.form.getItem("reportDay").resetItemOptions(t.weekDayValue.split(","),t.weekDayText.split(",")):e.get("value")==t.reportCycleText.split(",")[1]&&this.form.getItem("reportDay").resetItemOptions(t.monthDayValue.split(","),t.monthDayText.split(","))}.bind(this)}},reportDay:{type:"select",name:"reportDayInCycle",selectValue:this.data.reportCycle&&this.data.reportCycle!=t.reportCycleText.split(",")[0]?t.monthDayValue.split(","):t.weekDayValue.split(","),selectText:this.data.reportCycle&&this.data.reportCycle!=t.reportCycleText.split(",")[0]?t.monthDayText.split(","):t.weekDayText.split(",")},dutyDepartment:{text:t.dutyDepartment+":",name:"responsibilityUnitName",type:"org",orgType:"unit"},dutyPerson:{text:t.dutyPerson+":",name:"responsibilityIdentity",type:"org",orgType:"identity"},secondDepartment:{text:t.secondDepartment+":",name:"cooperateUnitNameList",value:this.data.cooperateUnitNameList?this.data.cooperateUnitNameList.join(","):"",type:"org",orgType:"unit"},secondPerson:{text:t.secondPerson+":",type:"org",orgType:"identity",name:"cooperateIdentityList",value:this.data.cooperateIdentityList?this.data.cooperateIdentityList.join(","):"",count:0},readReader:{text:t.readReader+":",type:"org",orgType:"identity",name:"readLeaderIdentityList",value:this.data.readLeaderIdentityList?this.data.readLeaderIdentityList.join(","):"",count:0},subject:{text:t.subject+":",name:"title",notEmpty:!0},workSplitAndDescription:{text:t.workSplitAndDescription+":",type:"textarea",name:"workDetail",notEmpty:!0},specificActionInitiatives:{text:t.specificActionInitiatives+":",type:"textarea",name:"progressAction"},cityCompanyDuty:{text:t.cityCompanyDuty+":",type:"textarea",name:"dutyDescription"},milestoneMark:{text:t.milestoneMark+":",type:"textarea",name:"landmarkDescription"},importantMatters:{text:t.importantMatters+":",type:"textarea",name:"majorIssuesDescription"}}},loadAttachment:function(t){this.attachment=new MWF.xApplication.Execution.Attachment(t,this.app,this.actions,this.app.lp,{documentId:this.data.id,isNew:this.options.isNew,isEdited:this.options.isEdited,size:"min",isSizeChange:!0}),this.attachment.load()},_ok:function(t,e){},setFormNodeSize:function(t,e,i,s){t||(t=this.options.width?this.options.width:"50%"),e||(e=this.options.height?this.options.height:"50%"),i||(i=this.options.top?this.options.top:0),s||(s=this.options.left?this.options.left:0);var o=this.app.content.getSize(),n=this.options.width,r=this.options.height;n.toString().indexOf("px")>-1?(o.x=parseInt(n.replace("px","")),t=o.x):(o.x=o.x*parseFloat(n)/100,t=o.x),r.toString().indexOf("px")>-1?(o.y=parseInt(r.replace("px","")),e=o.y):(o.y=o.y*parseInt(r)/100,e=o.y),this.allSize=o;var a=o.x-this.formTopCloseActionNode.getSize().x-this.formTopIconNode.getSize().x-40;this.formTopTextNode.setStyles({width:a+"px"});var l=o.x,p=o.y;"string"==typeof t&&1<t.length&&"%"==t.substr(t.length-1,1)&&(t=parseInt(l*parseInt(t,10)/100,10)),"string"==typeof e&&1<e.length&&"%"==e.substr(e.length-1,1)&&(e=parseInt(p*parseInt(e,10)/100,10)),300>t&&(t=300),220>e&&(e=220),i=i||parseInt((p-e)/2,10),s=s||parseInt((l-t)/2,10),this.formAreaNode.setStyles({width:t+"px",height:e+"px",top:i+"px",left:s+"px"}),this.formNode.setStyles({width:t+"px",height:e+"px"});var h=this.formIconNode?this.formIconNode.getSize():{x:0,y:0},d=this.formTopNode?this.formTopNode.getSize():{x:0,y:0},c=this.formBottomNode?this.formBottomNode.getSize():{x:0,y:0},m=e-h.y-d.y-c.y;this.formContentNode.setStyles({height:m+"px"}),this.formTableContainer.setStyles({height:m+"px"}),this.detailContentNode.setStyles({height:m-this.detailTopNode.getSize().y+"px"}),this.chatContentListNode&&this.chatContentListNode.setStyles({height:m-this.chatTopNode.getSize().y-this.chatEditorNode.getSize().y+"px"});var v=(m-2*this.reportTopNode.getSize().y)/2;this.reportContentNode.setStyles({height:v+"px"}),this.reportContentInforHeight=m-this.reportTopNode.getSize().y,this.prevReportInforListDiv&&this.prevReportInforListDiv.setStyles({height:this.reportContentInforHeight+"px"}),this.questionContentNode.setStyles({height:v+"px"})},setContentSize:function(){var t=this.app.content.getSize(),e=this.options.width,i=this.options.height;e.toString().indexOf("px")>-1?(t.x=parseInt(e.replace("px","")),n=t.x):(t.x=t.x*parseFloat(e)/100,n=t.x),i.toString().indexOf("px")>-1?(t.y=parseInt(i.replace("px","")),height=t.y):(t.y=t.y*parseInt(i)/100,height=t.y),this.allSize=t;var s=this.leftArea.getStyle("width"),o=this.chatArea.getStyle("width"),n=t.x-parseInt(s)-parseInt(o);this.detailArea.setStyles({width:n+"px"})},setScrollBar:function(t,e,i,s,o){return i||(i="default"),s||(s={V:{x:0,y:0},H:{x:0,y:0}}),MWF.require("MWF.widget.ScrollBar",function(){this.scrollbar&&this.scrollbar.scrollVAreaNode&&(this.scrollbar.scrollVAreaNode.destroy(),delete this.scrollbar),this.scrollbar=new MWF.widget.ScrollBar(t,{style:i,offset:s,where:"before",indent:!1,distance:100,friction:4,onScroll:function(i){var s=t.getScrollSize(),o=t.getSize();i+200>s.y-o.y&&e&&e.loadElementList&&(e.isItemsLoaded||e.loadElementList())}.bind(this)}),o&&o()}.bind(this)),!1},createShade:function(t,e){var i=this.content,s=t||i,o=e||"loading...";this.shadeDiv&&this.shadeDiv.destroy(),this.shadeTxtDiv&&this.shadeTxtDiv.destroy(),this.shadeDiv=new Element("div.shadeDiv").inject(s),this.inforDiv=new Element("div.inforDiv",{styles:{height:"16px",display:"inline-block",position:"absolute","background-color":"#000000","border-radius":"3px",padding:"5px 10px"}}).inject(this.shadeDiv),this.loadImg=new Element("img.loadImg",{styles:{width:"16px",height:"16px",float:"left"},src:"../x_component_Execution/$Main/default/icon/loading.gif"}).inject(this.inforDiv),this.shadeTxtSpan=new Element("span.shadeTxtSpan").inject(this.inforDiv),this.shadeTxtSpan.set("text",o),this.shadeDiv.setStyles({width:"100%",height:"100%",position:"absolute",opacity:"0.6","background-color":"#cccccc","z-index":"999"}),this.shadeTxtSpan.setStyles({color:"#ffffff","font-size":"12px",display:"inline-block","line-height":"16px","padding-left":"5px"});var n=s.getSize().x,r=s.getSize().y;this.shadeDiv.setStyles({left:s.getLeft()+"px",top:s.getTop()+"px",width:n+"px",height:r+"px"}),"absolute"==s.getStyle("position")&&this.shadeDiv.setStyles({left:"0px",top:"0px"}),this.inforDiv.setStyles({left:n/2+"px",top:r/2+"px"})},destroyShade:function(){this.shadeDiv&&this.shadeDiv.destroy()},showErrorMessage:function(t,e,i){var s=i;if(t&&(errorMessage=t.responseText),""!=errorMessage){var o=JSON.parse(errorMessage);o.message?this.app.notice(o.message,"error"):this.app.notice(s,"error")}else this.app.notice(s,"error")}});