MWF.xApplication.Execution=MWF.xApplication.Execution||{},MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.require("MWF.widget.Identity",null,!1),MWF.xApplication.Execution.WorkStat=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,s){this.app=e,this.lp=e.lp.workStat,this.path="../x_component_Execution/$WorkStat/",this.actions=i,this.options.style=this.getViewStyle(),this.setOptions(s),this.loadCss(),this.node=$(t)},loadCss:function(){this.cssPath="../x_component_Execution/$WorkStat/"+this.options.style+"/css.wcss",this._loadCss()},load:function(){this.middleContent=this.app.middleContent,this.createNaviContent(),this.resizeWindow(),this.app.addEvent("resize",function(){this.resizeWindow()}.bind(this))},resizeWindow:function(){var t=this.app.middleContent.getSize();if(this.naviDiv.setStyles({height:t.y-40+"px"}),this.naviContentDiv.setStyles({height:t.y-180+"px"}),this.contentDiv.setStyles({height:t.y-60+"px"}),this.deptStatContent&&this.deptStatContent.setStyles({height:t.y-130+"px"}),this.statViewListDiv){var e=this.contentDiv.getSize().y-this.dateToolbar.getSize().y-this.dateStatListDiv.getSize().y;this.statViewListDiv.setStyles({height:e-40+"px"})}},createNaviContent:function(){this.naviDiv=new Element("div.naviDiv",{styles:this.css.naviDiv}).inject(this.middleContent),this.naviTitleDiv=new Element("div.naviTitleDiv",{styles:this.css.naviTitleDiv,text:this.lp.minderExplorerTitle}).inject(this.naviDiv),this.naviContentDiv=new Element("div.naviContentDiv",{styles:this.css.naviContentDiv}).inject(this.naviDiv),this.naviBottomDiv=new Element("div.naviBottomDiv",{styles:this.css.naviBottomDiv}).inject(this.naviDiv),this.createContentDiv();var t=this.path+"navi.json";MWF.getJSON(t,function(t){t.each(function(t,e){var i=new Element("li.naviContentLi",{styles:this.css.naviContentLi}).inject(this.naviContentDiv);i.addEvents({mouseover:function(t){this.bindObj.currentNaviItem!=this.node&&this.node.setStyles(this.styles)}.bind({styles:this.css.naviContentLi_over,node:i,bindObj:this}),mouseout:function(t){this.bindObj.currentNaviItem!=this.node&&this.node.setStyles(this.styles)}.bind({styles:this.css.naviContentLi,node:i,bindObj:this}),click:function(t){this.bindObj.currentNaviItem&&this.bindObj.currentNaviItem.setStyles(this.bindObj.css.naviContentLi),this.node.setStyles(this.styles),this.bindObj.currentNaviItem=this.node,this.action&&this.bindObj[this.action]&&this.bindObj[this.action]()}.bind({styles:this.css.naviContentLi_current,node:i,bindObj:this,action:t.action})});new Element("img.naviContentImg",{styles:this.css.naviContentImg,src:this.path+"default/icon/"+t.icon}).inject(i),new Element("span.naviContentSpan",{styles:this.css.naviContentSpan,text:t.title}).inject(i);0==e&&i.click()}.bind(this))}.bind(this))},createContentDiv:function(){this.contentDiv=new Element("div.contentDiv",{styles:this.css.contentDiv}).inject(this.middleContent)},openCenterWork:function(){this.contentDiv.empty(),this.loadCategoryBar(),this.loadToolbar()},loadCategoryBar:function(){var t=this;this.categoryBar=new Element("div.categoryBar",{styles:this.css.categoryBar}).inject(this.contentDiv),this.allCategoryNode=new Element("li.allCategoryNode",{styles:this.css.categoryNode,text:this.lp.category.all}).inject(this.categoryBar),this.allCategoryNode.addEvents({mouseover:function(){this.currentCategoryNode!=this.allCategoryNode&&this.allCategoryNode.setStyles(this.css.categoryNode_over)}.bind(this),mouseout:function(){this.currentCategoryNode!=this.allCategoryNode&&this.allCategoryNode.setStyles(this.css.categoryNode)}.bind(this),click:function(){this.currentCategoryNode&&this.currentCategoryNode.setStyles(this.css.categoryNode),this.currentCategoryNode=this.allCategoryNode,this.allCategoryNode.setStyles(this.css.categoryNode_current),this.loadView()}.bind(this)}),this.actions.getCategoryCountAll(function(e){e.data.each(function(e){var i=new Element("li.categoryNode",{styles:this.css.categoryNode,text:e.workTypeName+"("+e.centerCount+")"}).inject(this.categoryBar);i.store("workTypeName",e.workTypeName),i.addEvents({mouseover:function(){t.currentCategoryNode!=this.node&&this.node.setStyles(t.css.categoryNode_over)}.bind({node:i}),mouseout:function(){t.currentCategoryNode!=this.node&&this.node.setStyles(t.css.categoryNode)}.bind({node:i}),click:function(){t.currentCategoryNode&&t.currentCategoryNode.setStyles(t.css.categoryNode),t.currentCategoryNode=this.node,this.node.setStyles(t.css.categoryNode_current),t.loadView()}.bind({name:e.workTypeName,node:i})})}.bind(this))}.bind(this),null,!1),this.allCategoryNode.click()},loadToolbar:function(){this.toolbar=new Element("div.toolbar",{styles:this.css.toolbar}).inject(this.categoryBar),this.fileterNode=new Element("div.fileterNode",{styles:this.css.fileterNode}).inject(this.toolbar),this.loadFilter()},loadFilter:function(){var t=this;this.fileterNode.set("html","<table bordr='0' cellpadding='5' cellspacing='0' styles='filterTable'><tr>    <td styles='filterTableValue' item='workTitle'></td>    <td styles='filterTableValue' item='searchAction'></td>    <td styles='filterTableValue' item='returnAction' style='display:none;'></td></tr></table>"),MWF.xDesktop.requireApp("Template","MForm",function(){this.filter=new MForm(this.fileterNode,{},{style:"execution",isEdited:!0,itemTemplate:{workTitle:{style:this.css.filterTitle,defaultValue:this.lp.searchText,event:{focus:function(e){e.get("value")==t.lp.searchText&&e.setValue("")},blur:function(e){""==e.get("value").trim()&&e.setValue(t.lp.searchText)},keydown:function(e,i){13==i.code&&(t.fileterNode.getElements("[item='returnAction']").setStyle("display",""),t.loadView())}.bind(this)}},searchAction:{type:"button",value:this.lp.search,style:this.css.filterButton,event:{click:function(){t.fileterNode.getElements("[item='returnAction']").setStyle("display",""),t.loadView()}}},returnAction:{type:"button",value:this.lp.return,style:this.css.filterButton,event:{click:function(){t.filter.getItem("workTitle").setValue(t.lp.searchText),t.fileterNode.getElements("[item='returnAction']").setStyle("display","none"),t.loadView()}}}}},this.app,this.css),this.filter.load()}.bind(this),!0)},loadView:function(){var t={};if(this.currentCategoryNode){var e=this.currentCategoryNode.retrieve("workTypeName");e&&""!=e&&(t.workTypes=[e])}if(this.filter){var i=this.filter.getResult(!0,",",!0,!0,!0);for(var s in i.workTitle=i.workTitle.replace(this.lp.searchText,""),i)""!=i[s]&&(t[s]=i[s])}var a=!1;this.viewContainer&&(a=!0,this.viewContainer.destroy()),this.viewContainer=Element("div",{styles:this.css.viewContainer}).inject(this.contentDiv),this.setViewSize(),a||(this.setViewSizeFun=this.setViewSize.bind(this),this.app.addEvent("resize",this.setViewSizeFun)),this.view&&this.view.destroy(),this.getViewStyle(),this.view=new MWF.xApplication.Execution.WorkStat.WorkView(this.viewContainer,this.app,this,{templateUrl:this.path+"listItem_stat.json",scrollEnable:!0},{lp:this.lp.centerWorkView}),t&&(this.view.filterData=t),this.view.load()},getViewStyle:function(){return this.viewStyle?this.viewStyle:(this.actions.getProfileByCode({configCode:"MIND_LISTSTYLE"},function(t){t.data?this.viewStyle="ICON"==t.data.configValue?"graph":"default":this.viewStyle="default"}.bind(this),function(){this.viewStyle="default"}.bind(this),!1),"default")},setViewSize:function(){var t=this.app.middleContent.getSize(),e=this.categoryBar?this.categoryBar.getSize():{x:0,y:0};this.viewContainer.setStyles({height:t.y-e.y-56+"px"})},statDepartment:function(){this.contentDiv.empty(),this.deptToolbar=new Element("div.deptToolbar",{styles:this.css.deptToolbar}).inject(this.contentDiv),this.deptFileterNode=new Element("div.deptFileterNode",{styles:this.css.fileterNode}).inject(this.deptToolbar),this.loadDeptFilter()},loadDeptFilter:function(){var t=this;t.nowDate=new Date,t.day=new Date(t.nowDate.getFullYear(),t.nowDate.getMonth()+1,0);this.deptFileterNode.set("html","<table bordr='0' cellpadding='5' cellspacing='0' styles='filterTable'><tr>    <td styles='filterTableValue' item='beginDate'></td>    <td styles='filterTableValue' item='endDate'></td>    <td styles='filterTableValue' item='workType'></td>    <td styles='filterTableValue' item='centerWork'></td>    <td styles='filterTableValue' item='reportCycle'></td>    <td styles='filterTableValue' item='archiveType'></td>    <td styles='filterTableValue' item='searchAction'></td>    <td styles='filterTableValue' item='returnAction' style='display:none;'></td>    <td styles='filterTableValue' item='exportAction'></td></tr></table>");var e="";this.actions.listCategoryAll(function(t){"success"==t.type&&t.data.each(function(t,i){e=e+","+t.workTypeName}.bind(this))}.bind(this),null,!1),MWF.xDesktop.requireApp("Template","MForm",function(){this.deptFilter=new MForm(this.deptFileterNode,{},{style:"execution",isEdited:!0,onPostLoad:function(){t.loadDeptStat()}.bind(this),itemTemplate:{beginDate:{style:this.css.filterTitle,tType:"date",name:"beginDate",attr:{readonly:!0},notEmpty:!0,defaultValue:t.nowDate.getFullYear()+"-"+(t.nowDate.getMonth()+1)+"-01",event:{focus:function(e){e.get("value")==t.lp.deptStat.beginDate&&e.setValue("")},blur:function(e){""==e.get("value").trim()&&e.setValue(t.lp.deptStat.beginDate)}}},endDate:{style:this.css.filterTitle,tType:"date",name:"endDate",attr:{readonly:!0},notEmpty:!0,defaultValue:t.nowDate.getFullYear()+"-"+(t.nowDate.getMonth()+1)+"-"+t.day.getDate(),event:{focus:function(e){e.get("value")==t.lp.deptStat.endDate&&e.setValue("")},blur:function(e){""==e.get("value").trim()&&e.setValue(t.lp.deptStat.endDate)}}},workType:{text:this.lp.workType+":",type:"select",readonly:!0,selectValue:e.split(",")},centerWork:{type:"text",defaultValue:this.lp.centerWorkDefault,event:{focus:function(t){this.select()}}},reportCycle:{text:this.lp.reportCycle+":",type:"radio",notEmpty:!0,selectText:this.lp.reportCycleText.split(","),defaultValue:this.lp.reportCycleText.split(",")[0],event:{}},archiveType:{text:this.lp.archiveType+":",type:"radio",notEmpty:!0,selectText:this.lp.archiveType.split(","),defaultValue:this.lp.archiveType.split(",")[0],event:{}},searchAction:{type:"button",value:this.lp.search,style:this.css.filterButton,event:{click:function(){t.loadDeptStat()}}},returnAction:{type:"button",value:this.lp.return,style:this.css.filterButton,event:{click:function(){t.deptFilter.getItem("beginDate").setValue(t.lp.deptStat.beginDate),t.deptFilter.getItem("endDate").setValue(t.lp.deptStat.endDate),t.deptFileterNode.getElements("[item='returnAction']").setStyle("display","none")}}},exportAction:{type:"button",value:this.lp.export,style:this.css.filterButton,event:{click:function(){t.exportDeptExcel()}}}}},this.app,this.css),this.deptFilter.load()}.bind(this),!0)},loadDeptStat:function(){this.deptStatContent&&(this.deptStatContent.set("text","loading..."),this.deptStatContent.setStyles({"padding-left":"20px"})),this.bDate=this.deptFilter.getItem("beginDate").get("value"),this.eDate=this.deptFilter.getItem("endDate").get("value"),this.workType=this.deptFilter.getItem("workType").get("value"),this.centerWork=this.deptFilter.getItem("centerWork").get("value"),this.cycleType=this.deptFilter.getItem("reportCycle").get("value"),this.archiveType=this.deptFilter.getItem("archiveType").get("value"),""==this.bDate||this.bDate==this.lp.deptStat.beginDate||""==this.eDate||(this.eDate,this.lp.deptStat.endDate);var t={cycleType:this.cycleType,status:this.archiveType,startDate:this.bDate,endDate:this.eDate,workTypeName:this.workType,centerTitle:this.centerWork==this.lp.centerWorkDefault?"":this.centerWork};this.app.createShade(),this.actions.getStatType(t,function(t){if("success"==t.type){this.deptStatData=t.data,this.displayDeptStat();var e=this.contentDiv.getSize().y-this.deptToolbar.getSize().y;this.deptStatContent.setStyles({height:e-20+"px"})}this.app.destroyShade()}.bind(this),function(t,e,i){this.showErrorMessage(t,e,i),this.app.destroyShade()}.bind(this))},displayDeptStat:function(){if(this.deptStatContent&&this.deptStatContent.destroy(),this.deptStatContent=new Element("div.deptStatContent",{styles:this.css.deptStatContent}).inject(this.contentDiv),this.deptStatData){this.deptStatInfo=new Element("div.deptStatInfo",{styles:this.css.deptStatInfo}).inject(this.deptStatContent);var t="<span >已汇报:</span> <img src='"+this.path+"default/icon/Checkmark-24.png' style='vertical-align:middle;margin-right:20px; width:20px;' />";if(t+="<span>不需要汇报: </span><img src='"+this.path+"default/icon/Circle24.png' style='vertical-align:middle;margin-right:20px;width:20px;' />",t+="<span>未汇报:</span> <img src='"+this.path+"default/icon/Delete-24.png' style='vertical-align:middle;margin-right:20px;width:20px;' />",this.deptStatInfo.set("html",t),this.deptStatText=new Element("div.deptStatText",{styles:this.css.deptStatText}).inject(this.deptStatInfo),this.deptStatText.set("html","统计类别: "+this.cycleType+"  统计周期: "+this.bDate+" --- "+this.eDate),this.deptStatData.header&&(cols=this.deptStatData.header.length),this.deptStatTable=new Element("table.deptStatTable",{styles:this.css.deptStatTable}).inject(this.deptStatContent),this.deptStatHeadTr=new Element("tr.deptStatHeadTr",{styles:this.css.deptStatHeadTr}).inject(this.deptStatTable),this.deptStatData.header.each(function(t,e){if(this.tmpTd=new Element("td.deptStatTh",{styles:this.css.deptStatTh,text:t.title}).inject(this.deptStatHeadTr),0==e)this.tmpTd.setStyles({width:"100px"});else if(1==e||2==e)this.tmpTd.setStyles({width:"300px",height:"auto","max-height":"50px","overflow-y":"hidden"});else{var i=t.startDate,s=t.endDate;tmpstr=i.split("-")[1]+"."+i.split("-")[2]+"-"+s.split("-")[1]+"."+s.split("-")[2],this.tmpTd.set("text",tmpstr)}}.bind(this)),this.deptStatTable.setStyles({width:50*cols+680+"px"}),this.deptStatData.content){var e=0;this.deptStatData.content.length;this.deptStatData.content.each(function(t,i){if(t.array){t.array.length;var s=t.rowCount;t.array.each(function(i,a){i.array.length;var n=i.rowCount;if(i.array){var l=this;i.array.each(function(o,r){l.tmpTr=new Element("tr.deptStatTr",{styles:l.css.deptStatTr}).inject(l.deptStatTable),e++,0==r&&(0==a?(l.tmpTd=new Element("td.deptStatTd",{styles:l.css.deptStatTd,rowspan:s,text:t.title.split("@")[0]}).inject(l.tmpTr),l.tmpTd.setStyles({"text-align":"center"}),l.tmpTd=new Element("td.deptStatTd",{styles:l.css.deptStatTd,rowspan:n,text:i.title}).inject(l.tmpTr)):l.tmpTd=new Element("td.deptStatTd",{styles:l.css.deptStatTd,rowspan:n,text:i.title}).inject(l.tmpTr)),l.tmpTd=new Element("td.deptStatTd",{styles:l.css.deptStatTd,text:o.title,col:1,row:e}).inject(l.tmpTr),l.tmpTd.setStyles({cursor:"pointer","text-decoration":"underline"}),l.tmpTd.addEvents({click:function(){MWF.xDesktop.requireApp("Execution","WorkDetail",function(){new MWF.xApplication.Execution.WorkDetail(l,l.app.restActions,{id:o.id},{isNew:!1,isEdited:!1,tabLocation:l.category}).load()}.bind(l))}.bind(l),mouseenter:function(t){l.overStyles(t)}.bind(l),mouseleave:function(t){l.outStyles(t)}.bind(l)}),o.fields&&o.fields.each(function(t,i){l.tmpTd=new Element("td.deptStatTd",{styles:l.css.deptStatTdStatus,row:e,col:i+2}).inject(l.tmpTr),l.tmpTd.addEvents({mouseenter:function(t){l.overStyles(t)}.bind(l),mouseleave:function(t){l.outStyles(t)}.bind(l)});var s="";-1==t.reportStatus?s="Circle24.png":0==t.reportStatus?s="Delete-24.png":1==t.reportStatus&&(s="Checkmark-24.png"),l.deptStatStatusSpan=new Element("span.deptStatStatusSpan",{styles:this.css.deptStatStatusSpan}).inject(l.tmpTd),l.deptStatStatusSpan.setStyles({background:"url('"+l.path+"default/icon/"+s+"')"})}.bind(l))}.bind(l))}}.bind(this))}}.bind(this))}}},overStyles:function(t){$(t.target).get("row"),$(t.target).get("col")},outStyles:function(t){$(t.target).get("row"),$(t.target).get("col")},exportDeptExcel:function(){if(this.bDate=this.deptFilter.getItem("beginDate").get("value"),this.eDate=this.deptFilter.getItem("endDate").get("value"),this.archiveType=this.deptFilter.getItem("archiveType").get("value"),this.workType=this.deptFilter.getItem("workType").get("value"),this.centerWork=this.deptFilter.getItem("centerWork").get("value"),this.cycleType=this.deptFilter.getItem("reportCycle").get("value"),""==this.bDate||this.bDate==this.lp.deptStat.beginDate||""==this.eDate||this.eDate==this.lp.deptStat.endDate)return this.app.notice("选择日期","error"),!1;var t={cycleType:this.cycleType,startDate:this.bDate,endDate:this.eDate,status:this.archiveType,workTypeName:this.workType,centerTitle:this.centerWork==this.lp.centerWorkDefault?"":this.centerWork};this.actions.exportByDeptWork(t,function(t){if(t.data&&t.data.id){var e=this.actions.action.address+"/jaxrs/export/statisticreportcontent/"+t.data.id+"/stream";window.open(o2.filterUrl(e))}}.bind(this),function(t,e,i){this.showErrorMsg(t,e,i)}.bind(this),!1)},statDate:function(){this.contentDiv.empty(),this.dateToolbar=new Element("div.dateToolbar",{styles:this.css.dateToolbar}).inject(this.contentDiv),this.dateFileterNode=new Element("div.dateFileterNode",{styles:this.css.fileterNode}).inject(this.dateToolbar),this.loadDateFilter()},loadDateFilter:function(){var t=this;t.nowDate=new Date,t.day=new Date(t.nowDate.getFullYear(),t.nowDate.getMonth()+1,0);this.dateFileterNode.set("html","<table bordr='0' cellpadding='5' cellspacing='0' styles='filterTable'><tr>    <td styles='filterTableValue' item='beginDate'></td>    <td styles='filterTableValue' item='endDate'></td>    <td styles='filterTableValue' item='workType'></td>    <td styles='filterTableValue' item='centerWork'></td>    <td styles='filterTableValue' item='reportCycle'></td>    <td styles='filterTableValue' item='archiveType'></td>    <td styles='filterTableValue' item='searchAction'></td>    <td styles='filterTableValue' item='returnAction' style='display:none;'></td>    <td styles='filterTableValue' item='exportAction'></td></tr></table>");var e="";this.actions.listCategoryAll(function(t){"success"==t.type&&t.data.each(function(t,i){e=e+","+t.workTypeName}.bind(this))}.bind(this),null,!1),MWF.xDesktop.requireApp("Template","MForm",function(){this.dateFilter=new MForm(this.dateFileterNode,{},{style:"execution",isEdited:!0,onPostLoad:function(){t.loadDateStat()}.bind(this),itemTemplate:{beginDate:{style:this.css.filterTitle,tType:"date",name:"beginDate",attr:{readonly:!0},notEmpty:!0,defaultValue:t.nowDate.getFullYear()+"-"+(t.nowDate.getMonth()+1)+"-01",event:{focus:function(e){e.get("value")==t.lp.dateStat.beginDate&&e.setValue("")},blur:function(e){""==e.get("value").trim()&&e.setValue(t.lp.dateStat.beginDate)}}},endDate:{style:this.css.filterTitle,tType:"date",name:"endDate",attr:{readonly:!0},notEmpty:!0,defaultValue:t.nowDate.getFullYear()+"-"+(t.nowDate.getMonth()+1)+"-"+t.day.getDate(),event:{focus:function(e){e.get("value")==t.lp.dateStat.endDate&&e.setValue("")},blur:function(e){""==e.get("value").trim()&&e.setValue(t.lp.dateStat.endDate)}}},workType:{text:this.lp.workType+":",type:"select",attr:{readonly:!0},selectValue:e.split(",")},centerWork:{type:"text",defaultValue:this.lp.centerWorkDefault,event:{focus:function(t){this.select()}}},reportCycle:{text:this.lp.reportCycle+":",type:"radio",notEmpty:!0,selectText:this.lp.reportCycleText.split(","),defaultValue:this.lp.reportCycleText.split(",")[0],event:{}},archiveType:{text:this.lp.archiveType+":",type:"radio",notEmpty:!0,selectText:this.lp.archiveType.split(","),defaultValue:this.lp.archiveType.split(",")[0],event:{}},searchAction:{type:"button",value:this.lp.search,style:this.css.filterButton,event:{click:function(){t.loadDateStat()}}},returnAction:{type:"button",value:this.lp.return,style:this.css.filterButton,event:{click:function(){t.dateFilter.getItem("beginDate").setValue(t.lp.dateStat.beginDate),t.dateFilter.getItem("endDate").setValue(t.lp.dateStat.endDate),t.dateFileterNode.getElements("[item='returnAction']").setStyle("display","none")}}},exportAction:{type:"button",value:this.lp.export,style:this.css.filterButton,event:{click:function(){t.exportDateExcel()}}}}},this.app,this.css),this.dateFilter.load()}.bind(this),!0)},loadDateStat:function(){this.bDate=this.dateFilter.getItem("beginDate").get("value"),this.eDate=this.dateFilter.getItem("endDate").get("value"),this.workType=this.dateFilter.getItem("workType").get("value"),this.centerWork=this.dateFilter.getItem("centerWork").get("value"),this.cycleType=this.dateFilter.getItem("reportCycle").get("value"),this.archiveType=this.dateFilter.getItem("archiveType").get("value"),""==this.bDate||this.bDate==this.lp.dateStat.beginDate||""==this.eDate||(this.eDate,this.lp.dateStat.endDate),this.dateStatListDiv&&this.dateStatListDiv.destroy(),this.statViewListDiv&&this.statViewListDiv.destroy();var t={reportCycle:this.cycleType,status:this.archiveType,workTypeName:this.workType,startDate:this.bDate,centerTitle:this.centerWork==this.lp.centerWorkDefault?"":this.centerWork,endDate:this.eDate};this.app.createShade(),this.actions.getStatDateList(t,function(t){this.app.destroyShade(),"success"==t.type&&(this.dateStatListData=t.data,this.displayDateStatList())}.bind(this),function(t,e,i){this.showErrorMessage(t,e,i),this.app.destroyShade()}.bind(this))},displayDateStatList:function(){this.dateStatListDiv&&this.dateStatListDiv.destroy(),this.statViewListDiv&&this.statViewListDiv.destroy(),this.dateStatListDiv=new Element("div.dateStatListDiv",{styles:this.css.dateStatListDiv}).inject(this.contentDiv);new Element("div.dateStatListTitleDiv",{styles:this.css.dateStatListTitleDiv,text:this.lp.dateStatListTitle}).inject(this.dateStatListDiv);this.dateStatContentDiv=new Element("div.dateStatContentDiv",{styles:this.css.dateStatContentDiv}).inject(this.dateStatListDiv),this.loadDateStatList()},loadDateStatList:function(){this.dateStatListData&&(this.dateStatListData.each(function(t,e){var i=new Element("li.dateStatContentLi",{styles:this.css.dateStatContentLi,text:t.datetime,title:t.reportCycle}).inject(this.dateStatContentDiv);i.addEvents({click:function(){this.dateStatContentDiv.getElements("li").setStyles({"background-color":"",color:""}),i.setStyles({"background-color":"#3c76c1",color:"#ffffff"}),this.currentDateData=t,this.displayDateStat(t)}.bind(this)})}.bind(this)),0==this.dateStatListData.length&&(this.tmpSpan=new Element("span",{styles:{"margin-left":"10px"},text:this.lp.nullReportStat}).inject(this.dateStatContentDiv)),this.dateStatContentDiv.getElements("li").length>0&&this.dateStatContentDiv.getElements("li")[0].click())},displayDateStat:function(t,e){if(this.statViewListDiv&&(this.statViewListDiv.empty(),this.statViewListDiv.set("text","loading..."),this.statViewListDiv.setStyles({"padding-left":"15px"})),t){var i={statisticTimeFlag:t.datetime,workTypeName:this.workType,status:this.archiveType,centerTitle:this.centerWork==this.lp.centerWorkDefault?"":this.centerWork,reportCycle:t.reportCycle};e&&(i.centerId=e),this.app.createShade(),this.actions.getStatDate(i,function(t){"success"==t.type&&(this.dateStatData=t.data,this.displayDateStatTable()),this.app.destroyShade()}.bind(this),function(t,e,i){this.showErrorMessage(t,e,i),this.app.destroyShade()}.bind(this))}},displayDateStatTable:function(){if(this.statViewListDiv&&this.statViewListDiv.empty(),this.dateStatData){this.statViewListDiv&&this.statViewListDiv.destroy(),this.statViewListDiv=new Element("div.statViewListDiv",{styles:this.css.statViewListDiv}).inject(this.contentDiv);var t=this.contentDiv.getSize().y-this.dateToolbar.getSize().y-this.dateStatListDiv.getSize().y;for(var e in this.statViewListDiv.setStyles({height:t-50+"px"}),this.statTable=new Element("table.statTable",{styles:this.css.statTable}).inject(this.statViewListDiv),this.statHeadTr=new Element("tr.statHeadTr",{styles:this.css.statHeadTr}).inject(this.statTable),this.lp.statTable)new Element("td.statHeadTd",{styles:this.css.statHeadTd,text:this.lp.statTable[e]}).inject(this.statHeadTr);this.dateStatData.each(function(t,e){var i=new Element("tr.centerTr").inject(this.statTable);new Element("td.dateStatCenterTd",{styles:this.css.dateStatCenterTd,colspan:9,text:t.title}).inject(i);t.contents&&t.contents.length>0&&t.contents.each(function(t,e){var i=new Element("tr.baseTr").inject(this.statTable);for(var s in this.lp.statTable){var a="";"opinions"==s?t[s]&&t[s].each((function(t){a=a+t.processorName.split("@")[0]+"：\n"+t.opinion+"\n"})):"responsibilityUnitName"==s?a=(a=t[s]).split("@")[0]:t[s]&&(a=t[s]);var n=new Element("td.dateStatBaseTd",{styles:this.css.dateStatBaseTd,html:a.length>50?a.substring(0,50)+"...":a,title:a}).inject(i);"serialNumber"==s&&n.setStyles({width:"35px","padding-left":"15px","min-width":""}),"responsibilityUnitName"==s&&n.setStyles({width:"87px"})}}.bind(this))}.bind(this))}},exportDateExcel:function(){if(this.currentDateData){var t={};t.statisticTimeFlag=this.currentDateData.datetime,t.reportCycle=this.currentDateData.reportCycle,t.status=this.currentDateData.status,t.centerTitle=this.centerWork==this.lp.centerWorkDefault?"":this.centerWork,t.workTypeName=this.workType,this.actions.exportByCenterWork(t,function(t){if(t.data&&t.data.id){var e=this.actions.action.address+"/jaxrs/export/statisticreportcontent/"+t.data.id+"/stream";window.open(o2.filterUrl(e))}}.bind(this),function(t,e,i){this.showErrorMsg(t,e,i)}.bind(this),!1)}},showErrorMessage:function(t,e,i){var s=i;if(t&&(errorMessage=t.responseText),""!=errorMessage){var a=JSON.parse(errorMessage);a.message?this.app.notice(a.message,"error"):this.app.notice(s,"error")}else this.app.notice(s,"error")},setScrollBar:function(t,e,i,s){return e||(e="attachment"),i||(i={V:{x:0,y:0},H:{x:0,y:0}}),MWF.require("MWF.widget.ScrollBar",(function(){new MWF.widget.ScrollBar(t,{style:e,offset:i,indent:!1}),s&&s()})),!1}}),MWF.xApplication.Execution.WorkStat.WorkView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkStat.WorkDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,e){e||(e=20);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";"(0)"==i&&this.app.createShade();var s=this.filterData||{};this.actions.getCenterWorkListNext(i,e,s,function(e){t&&t(e),this.app.destroyShade()}.bind(this))},_removeDocument:function(t,e){},_create:function(){},_openDocument:function(t){MWF.xDesktop.requireApp("Execution","StatForm",function(){new MWF.xApplication.Execution.StatForm(this,this.app.restActions,t,{centerWorkId:t.id}).load()}.bind(this))},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWF.xApplication.Execution.WorkStat.WorkDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverDocument:function(){this.node.getElements("[styles='documentItemTitleNode']").setStyles(this.css.documentItemTitleNode_over),this.node.getElements("[styles='documentItemIconNode']").setStyles(this.css.documentItemIconNode_over),this.node.getElements("[styles='documentItemStatNode']").setStyles(this.css.documentItemStatNode_over)},mouseoutDocument:function(){this.node.getElements("[styles='documentItemTitleNode']").setStyles(this.css.documentItemTitleNode),this.node.getElements("[styles='documentItemIconNode']").setStyles(this.css.documentItemIconNode),this.node.getElements("[styles='documentItemStatNode']").setStyles(this.css.documentItemStatNode)},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){},removeCenterWork:function(t){return!1}});