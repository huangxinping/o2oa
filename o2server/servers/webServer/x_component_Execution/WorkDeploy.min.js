MWF.xApplication.Execution=MWF.xApplication.Execution||{},MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xDesktop.requireApp("Template","MPopupForm",null,!1),MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.xDesktop.requireApp("Execution","WorkForm",null,!1),MWF.xApplication.Execution.WorkDeploy=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"90%",height:"90%",hasTop:!0,hasIcon:!1,hasBottom:!0,title:"",draggable:!1,closeAction:!0,isNew:!1,isEdited:!0},initialize:function(t,e,o,i){this.setOptions(i),this.explorer=t,this.app=t.app,this.lp=this.app.lp.WorkDeploy,this.actions=this.app.restActions,this.path="../x_component_Execution/$WorkDeploy/",this.cssPath=this.path+this.options.style+"/css.wcss",this._loadCss(),this.options.title=this.lp.title,this.data=o||{},this.actions=e},load:function(){this.getCenterWorkInfo(),this.options.isNew?this.create():this.options.isEdited?this.edit():this.open()},getCenterWorkInfo:function(t){var e="(0)";1==arguments.length?e=t:this.data.id&&(e=this.data.id),this.actions.getCenterWorkInfo(e,function(t){(t.type="success")&&(this.centerWorkData=t.data,this.centerWorkId=this.centerWorkData.id)}.bind(this),function(t,e,o){this.showErrorMessage(t,e,o)}.bind(this),!1)},createTopNode:function(){this.formTopNode||(this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode),this.formTopIconNode=new Element("div",{styles:this.css.formTopIconNode}).inject(this.formTopNode),this.formTopTextNode=new Element("div",{styles:this.css.formTopTextNode,text:this.options.title}).inject(this.formTopNode),this.options.closeAction&&(this.formTopCloseActionNode=new Element("div.formTopCloseActionNode",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode),this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))),this.formTopContentNode=new Element("div",{styles:this.css.formTopContentNode}).inject(this.formTopNode),this._createTopContent())},_createTopContent:function(){this.formTopContentNode&&this.formTopContentNode.empty();this.formTopContentNode.set("html","<span styles='formTopContentTitle' lable='drafter'></span>    <span styles='formTopContentValue' item='drafter'></span><span styles='formTopContentTitle' lable='draftDepartment'></span>    <span styles='formTopContentValue' item='draftDepartment'></span><span styles='formTopContentTitle' lable='draftDate'></span>    <span styles='formTopContentValue' item='draftDate'></span>"),new MForm(this.formTopContentNode,this.centerWorkData,{isEdited:!1,itemTemplate:{drafter:{text:this.lp.drafter+":",value:this.centerWorkData.creatorName.split("@")[0],type:"innertext"},draftDepartment:{text:this.lp.draftDepartment+":",value:this.centerWorkData.creatorUnitName.split("@")[0],type:"innertext"},draftDate:{text:this.lp.draftDate+":",name:"createTime",type:"innertext"}}},this.app,this.css).load()},reloadTableContent:function(t){0==arguments.length&&(this.centerWorkData?t=this.centerWorkData.id:this.data.id?t=this.data.id:this.options.centerWorkId&&(t=this.options.centerWorkId)),this.getCenterWorkInfo(t),this._createTopContent(),this._createTableContent(this.centerWorkData),this._createBottomContent()},_createTableContent:function(){this.formTableArea&&this.formTableArea.empty(),this.createCenterWorkInfor(this.centerWorkData),this.createImportContent(),this.createMyWorkList(),this.creataMyDeployWorkList()},createCenterWorkInfor:function(t){this.centerWorkContentArea=new Element("div.centerWorkContentArea",{styles:this.css.workContentArea}).inject(this.formTableArea);new Element("div.workContentTitleNode",{styles:this.css.workContentTitleNode,text:this.lp.centerWorkInfor}).inject(this.centerWorkContentArea);this.centerWorkContentNode=new Element("div.centerWorkContentNode",{styles:this.css.workContentNode}).inject(this.centerWorkContentArea),this.loadCenterWorkInfor(t)},loadCenterWorkInfor:function(t){this.centerWorkContentNode.empty();this.centerWorkContentNode.set("html","<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='centerWorkInforTable'><tr><td styles='centerWorkInforTitle' lable='centerWorkTitle'></td>    <td styles='centerWorkInforValue' item='centerWorkTitle'></td></tr><tr><td colspan='2'>   <div styles='centerWorkInforTitleDiv' lable='reportAuditLeader'></div>    <div styles='centerWorkInforValueDiv' item='reportAuditLeader'></div>   <div styles='centerWorkInforTitleDiv' lable='defaultWorkType'></div>    <div styles='centerWorkInforValueDiv' item='defaultWorkType'></div>   <div styles='centerWorkInforTitleDiv' lable='workCompletedLimit'></div>    <div styles='centerWorkInforValueDiv' item='workCompletedLimit'></div></td></tr><tr><td styles='centerWorkInforTitle' lable='centerWorkMemo'></td>    <td styles='centerWorkInforValue' item='centerWorkMemo'></td></tr></table>");var e=[],o="";t.workTypes&&t.workTypes.each((function(t,o){t.workTypeName&&e.push(t.workTypeName)})),o=e.join(","),e.length>0&&(o=","+o),(this.centerForm=new MForm(this.centerWorkContentNode,t,{isEdited:this.isEdited||this.isNew,itemTemplate:{centerWorkTitle:{text:this.lp.centerWorkTitle+":",name:"title",type:"text",notEmpty:!0},defaultWorkType:{text:this.lp.defaultWorkType+":",name:"defaultWorkType",type:"select",selectValue:o,selectText:o,notEmpty:!0,style:{width:"100px",height:"30px","border-radius":"1px"}},defaultWorkLevel:{text:this.lp.defaultWorkLevel+":",name:"defaultWorkLevel",type:"select",selectValue:this.lp.defaultWorkTypeValue,notEmpty:!0,style:{width:"200px",height:"30px",color:"#999999","border-radius":"1px","box-shadow":"0px 0px 1px #CCC"}},reportAuditLeader:{text:this.lp.reportAuditLeader+":",name:"reportAuditLeaderIdentityList",type:"org",orgType:"identity",attr:{readonly:!0},notEmpty:!1,count:0,value:this.reportAuditLeaderList?this.reportAuditLeaderList.join(","):"",style:{width:"400px"}},workCompletedLimit:{text:this.lp.workCompletedLimit+":",name:"defaultCompleteDateLimitStr",type:"text",tType:"date",attr:{readonly:!0},notEmpty:!0},centerWorkMemo:{text:this.lp.centerWorkMemo+":",name:"description",type:"textarea"}}},this.app)).load()},createImportContent:function(){this.centerWorkData&&this.centerWorkData.operation&&this.centerWorkData.operation.indexOf("IMPORTWORK")>-1&&(this.importDiv=new Element("div.importDiv",{styles:this.css.importDiv}).inject(this.formTableArea),this.importTemplateDiv=new Element("div.importTemplateDiv",{styles:this.css.importTemplateDiv,text:this.lp.importTemplate}).inject(this.importDiv),this.importTemplateDiv.addEvents({click:function(){window.open(o2.filterUrl("../x_component_Execution/baseWork.xls"))}.bind(this)}),this.importTitleDiv=new Element("div.importTitleDiv",{styles:this.css.importTitleDiv,text:this.lp.importTemplateTitle}).inject(this.importDiv))},createMyWorkList:function(){this.myWorkContentArea&&this.myWorkContentArea.destroy();var t=this.myWorkContentArea=new Element("div.workContentArea",{styles:this.css.workContentArea}).inject(this.formTableArea);new Element("div",{styles:this.css.workContentTitleNode,text:this.lp.myWorkInfor}).inject(t);workContentNode=new Element("div",{styles:this.css.workContentNode}).inject(t),(this.myWorkView=new MWF.xApplication.Execution.WorkDeploy.MyWorkView(workContentNode,this.app,this,{templateUrl:this.path+"myWork.json"})).load()},creataMyDeployWorkList:function(){var t=this.myDeployWorkArea=new Element("div.myDeployWorkArea",{styles:this.css.workContentArea}).inject(this.formTableArea);new Element("div.myDeployWorkTitleNode",{styles:this.css.workContentTitleNode,text:this.lp.deployWorkInfor}).inject(t);(this.myDeployWorkView=new MWF.xApplication.Execution.WorkDeploy.MyDeployWorkView(t,this.app,this,{templateUrl:this.path+"myDeployWork.json"})).load()},_createBottomContent:function(){this.formBottomNode&&this.formBottomNode.empty(),this.centerWorkData&&this.centerWorkData.operation&&this.centerWorkData.operation.each(function(t,e){"CLOSE"==t?(this.closeBotton=new Element("div.closeBotton",{styles:this.css.formActionNode,text:this.lp.botton.close}).inject(this.formBottomNode),this.closeBotton.addEvent("click",function(t){this.closeWork(t)}.bind(this))):"CREATEWORK"==t?(this.newBotton=new Element("div.newBotton",{styles:this.css.formActionNode,text:this.lp.botton.new}).inject(this.formBottomNode),this.newBotton.addEvent("click",function(t){this.createWork(t)}.bind(this))):"IMPORTWORK"==t?(this.importBotton=new Element("div.importBotton",{styles:this.css.formActionNode,text:this.lp.botton.import}).inject(this.formBottomNode),this.importBotton.addEvent("click",function(t){this.importWork(t)}.bind(this))):"DELETE"==t?(this.deleteBotton=new Element("div.deleteBotton",{styles:this.css.formActionNode,text:this.lp.botton.delete}).inject(this.formBottomNode),this.deleteBotton.addEvent("click",function(t){this.deleteWork(t)}.bind(this))):"DEPLOY"==t?(this.deployBotton=new Element("div.deployBotton",{styles:this.css.formActionNode,text:this.lp.botton.deploy}).inject(this.formBottomNode),this.deployBotton.addEvent("click",function(t){this.deployWork(t)}.bind(this))):"ARCHIVE"==t&&(this.archiveBotton=new Element("div.archiveBotton",{styles:this.css.formActionNode,text:this.lp.botton.archive}).inject(this.formBottomNode),this.archiveBotton.addEvent("click",function(t){this.archiveWork(t)}.bind(this))),"CONFIRM"==t&&(this.confirmBotton=new Element("div.confirmBotton",{styles:this.css.formActionNode,text:this.lp.botton.confirm}).inject(this.formBottomNode),this.confirmBotton.addEvent("click",function(t){this.confirmWork(t)}.bind(this)))}.bind(this))},closeWork:function(t){this.close(),this.fireEvent("reloadView",{action:"reload"})},createWork:function(){var t=this.centerForm.getResult(!0,",",!0,!1,!0);t&&(this.options.isNew||this.options.isEdited?this.saveCenterWork(t,function(t){t.type&&"error"==t.type?this.app.notice(t.message,"error"):(t.data&&t.data.id&&this.reloadTableContent(t.data.id),this.centerWorkData&&this.openWorkForm(this.centerWorkData))}.bind(this)):this.centerWorkData&&this.openWorkForm(this.centerWorkData))},importWork:function(){var t,e=this.centerForm.getResult(!0,",",!0,!1,!0);if(!e)return!1;this.options.isNew||this.options.isEdited?this.saveCenterWork(e,function(e){e.type&&"error"==e.type?this.app.notice(e.message,"error"):this.centerWorkData&&(t=this.centerWorkData.id,this.createUpload(t),this.reloadTableContent(t))}.bind(this)):(this.centerWorkData&&(t=this.centerWorkData.id),this.createUpload(t))},createUpload:function(t){if(t){this.uploadFileAreaNode&&this.uploadFileAreaNode.destroy(),this.uploadFileAreaNode=new Element("div");this.uploadFileAreaNode.set("html",'<input name="file" type="file" />'),this.fileUploadNode=this.uploadFileAreaNode.getFirst(),this.fileUploadNode.addEvent("change",function(){var o=e.files;if(o.length)for(var i=0;i<o.length;i++){var n=o.item(i),s=n.name.split(".");if(this.uploadFileName=n.name,"xls"!=s[s.length-1].toLowerCase()&&"xlsx"!=s[s.length-1].toLowerCase())return void this.app.notice("请导入excel文件！","error");var r=new FormData;r.append("file",n),this.app.createShade(null,"正在导入，请稍后....."),this.actions.importBaseWork(t,r,n,function(e){this.reloadTableContent(t),this.app.destroyShade()}.bind(this),function(t,e,o){this.showErrorMessage(t,e,o),this.app.destroyShade()}.bind(this))}}.bind(this));var e=this.uploadFileAreaNode.getFirst();e.click()}},deleteWork:function(t){var e=this;e.app.confirm("warn",t,e.lp.submitWarn.warnTitle,e.lp.submitWarn.warnContent,300,120,(function(){e.app.createShade(),e.actions.deleteCenterWork(e.centerWorkData.id,function(t){t.type&&"success"==t.type&&(e.app.notice(this.lp.prompt.deleteCenterWork,"success"),e.closeWork({action:"reload"})),e.app.destroyShade()}.bind(e),function(t,o,i){e.showErrorMessage(t,o,i),e.app.destroyShade()}.bind(e)),this.close()}),(function(){this.close()}))},deployWork:function(t){var e=this;e.app.confirm("warn",t,e.lp.submitWarn.warnTitle,e.lp.submitWarn.warnDeployContent,300,120,(function(){e.app.createShade(),e.actions.deployCenterWork(e.centerWorkData.id,function(t){t.type&&"success"==t.type&&(e.app.notice(this.lp.prompt.deployCenterWork,"success"),e.close(),e.fireEvent("reloadView",{action:"reload"}),e.app.destroyShade())}.bind(e),function(t,o,i){e.showErrorMessage(t,o,i),e.app.destroyShade()}.bind(e)),this.close()}),(function(){this.close()}))},confirmWork:function(t){var e=this;e.app.confirm("warn",t,e.lp.submitWarn.warnTitle,e.lp.submitWarn.warnConfirmContent,300,120,(function(){e.actions.deployCenterWork(e.centerWorkData.id,function(t){e.app.createShade(),t.type&&"success"==t.type&&(e.app.notice(this.lp.prompt.comfirmCenterWork,"success"),e.close(),e.fireEvent("reloadView",{action:"reload"}),e.app.destroyShade())}.bind(e),function(t,o,i){e.showErrorMessage(t,o,i),e.app.destroyShade()}.bind(e)),this.close()}),(function(){this.close()}))},archiveWork:function(t){var e=this;e.app.confirm("warn",t,e.lp.submitWarn.warnTitle,e.lp.submitWarn.warnArchiveContent,300,120,(function(){e.app.createShade(),e.actions.archiveMainTask(e.centerWorkData.id,function(t){t.type&&"success"==t.type&&(e.app.notice(this.lp.prompt.archiveCenterWork,"success"),e.close(),e.fireEvent("reloadView",{action:"reload"}),e.app.destroyShade())}.bind(e),function(t,o,i){e.showErrorMessage(t,o,i),e.app.destroyShade()}.bind(e)),this.close()}),(function(){this.close()}))},saveCenterWork:function(t,e){""==t.reportAuditLeaderIdentityList?t.reportAuditLeaderIdentityList=[]:t.reportAuditLeaderIdentityList=t.reportAuditLeaderIdentityList.split(","),this.app.restActions.saveCenterWork(t,function(t){e&&e(t)}.bind(this),function(t,e,o){this.showErrorMessage(t,e,o)}.bind(this),!1)},openWorkForm:function(t){MWF.xDesktop.requireApp("Execution","WorkForm",function(){this.workform=new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,{centerWorkId:t.id||this.options.centerWorkId,centerWorkTitle:t.title},{isNew:!0,isEdited:!1,actionStatus:"save",onPostSave:function(){this.reloadTableContent()}.bind(this)}),this.workform.load()}.bind(this))},showErrorMessage:function(t,e,o){var i=o;if(t&&(errorMessage=t.responseText),""!=errorMessage){var n=JSON.parse(errorMessage);n.message?this.app.notice(n.message,"error"):this.app.notice(i,"error")}else this.app.notice(i,"error")}}),MWF.xApplication.Execution.WorkDeploy.MyDeployWorkView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkDeploy.MyDeployWorkDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,e){this.explorer.centerWorkId&&this.actions.getMyDeployWork(this.explorer.centerWorkId,function(e){0==e.data.length&&this.explorer.myDeployWorkArea.destroy(),t&&t(e)}.bind(this),function(t,e,o){this.explorer.showErrorMessage(t,e,o)}.bind(this),!1)},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWF.xApplication.Execution.WorkDeploy.MyDeployWorkDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){var o=t.getElements("td")[0];t.empty();new Element("td",{colspan:this.view.template.items.length,style:o.get("style"),html:o.get("html")}).inject(t);e.subWorks&&e.subWorks.each(function(t,e){var o=new Element("tr.subTrNode",{styles:this.css.subTrNode}).inject(this.view.viewNode);o.addEvents({click:function(){this.action_view(t.id)}.bind(this),mouseover:function(){o.setStyles(this.css.documentNode_over)}.bind(this),mouseout:function(){o.setStyles(this.css.subTrNode)}.bind(this)}),this.view.template.items.each(function(t,e){var i=t.content.html;o.set("html",o.get("html")+i)}.bind(this)),this.setLables(o,t),this.setValues(o,t),this.setStyles(o,t),this.setActions(o,t)}.bind(this))},setLables:function(t,e){t.getElements("[lable]").each(function(t){var e=t.get("lable");e&&this.lp[e]&&t.set("text",this.lp[e])}.bind(this))},setValues:function(t,e){t.getElements("[item]").each(function(t){var o=t.get("item");if(e[o]){if(("responsibilityUnitName"==o||"deployerUnitName"==o||"responsibilityEmployeeName"==o||"deployerName"==o)&&""!=e[o])if(e[o].indexOf(",")>0){var n=e[o].split(","),s="";for(i=0;i<n.length;i++)s=""==s?n[i].split("@")[0]:s+","+n[i].split("@")[0];e[o]=s}else e[o]=e[o].split("@")[0];if("cooperateUnitNameList"==o||"cooperateEmployeeNameList"==o){s="";for(i=0;i<e[o].length;i++)s=""==s?e[o][i].split("@")[0]:s+","+e[o][i].split("@")[0];e[o]=s}t.set("text",e[o].length>70?e[o].substr(0,70)+"...":e[o])}}.bind(this)),t.getElements("[title]").each(function(t){var o=t.get("title");e[o]&&t.set("title",e[o])}.bind(this))},setStyles:function(t,e){t.getElements("td[actionTd='yes']")&&(t.getElements("[styles]").each(function(t){var e=t.get("styles");e&&this.css[e]&&t.setStyles(this.css[e])}.bind(this)),t.getElements("[subStyles]").each(function(t){var e=t.get("subStyles");e&&this.css[e]&&t.setStyles(this.css[e])}.bind(this)))},setActions:function(t,e){var o=t.getElement("td[actionTd='yes']");o&&e.operation&&e.operation.each(function(t,i){var n=new Element("span.actionSpan",{styles:this.css.documentActionNode}).inject(o);1==e.operation.length&&"VIEW"==t&&(n.set("text",this.lp.action_view),n.addEvent("click",function(t){return this.action_view(e.id),!1}.bind(this))),"EDIT"==t?(n.set("text",this.lp.action_edit),n.addEvent("click",function(t){return this.action_edit(e.id),!1}.bind(this))):"DELETE"==t?(n.set("text",this.lp.action_delete),n.addEvent("click",function(t){return this.action_delete(e.id,t),!1}.bind(this))):"ARCHIVE"==t&&(n.set("text",this.lp.action_archive),n.addEvent("click",function(t){return this.action_archive(e.id,t),!1}.bind(this)))}.bind(this))},action_view:function(t){this.workform=new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,{id:t},{isNew:!1,isEdited:!1,actionStatus:"save",onPostSave:function(){this.explorer.contentChanged=!0}.bind(this)}),this.workform.load()},action_edit:function(t){this.workform=new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,{id:t},{isNew:!1,isEdited:!0,actionStatus:"save",onPostSave:function(){this.explorer.reloadTableContent()}.bind(this)}),this.workform.load()},action_delete:function(t,e){var o=this;o.view.app.confirm("warn",e,o.view.app.lp.WorkDeploy.submitWarn.warnTitle,o.view.app.lp.WorkDeploy.submitWarn.warnContent,300,120,(function(){o.app.createShade(),o.actions.deleteBaseWork(t,function(t){t.type&&"success"==t.type&&(this.app.notice(o.view.explorer.lp.prompt.deleteBaseWork,"success"),o.view.explorer.reloadTableContent(),o.app.destroyShade())}.bind(o),function(t,e,i){o.view.explorer.showErrorMessage(t,e,i),o.app.destroyShade()}.bind(o)),this.close()}),(function(){this.close()}))},action_archive:function(t,e){var o=this;o.view.app.confirm("warn",e,o.view.app.lp.WorkDeploy.submitWarn.warnTitle,o.view.app.lp.WorkDeploy.submitWarn.warnArchiveContent,300,120,(function(){o.app.createShade(),o.actions.archiveBaseWork(t,function(t){t.type&&"success"==t.type&&(this.app.notice(o.view.explorer.lp.prompt.archiveBaseWork,"success"),o.view.explorer.reloadTableContent(),o.app.destroyShade())}.bind(o),function(t,e,i){o.view.explorer.showErrorMessage(t,e,i),o.app.destroyShade()}.bind(o)),this.close()}),(function(){this.close()}))}}),MWF.xApplication.Execution.WorkDeploy.MyWorkView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkDeploy.MyWorkDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,e){this.explorer.centerWorkId&&this.actions.getMyRelativeWork(this.explorer.centerWorkId,function(e){0==e.data.length&&this.explorer.myWorkContentArea.destroy(),t&&t(e)}.bind(this),null,!1)},_openDocument:function(t){this.workForm=new MWF.xApplication.Execution.WorkForm(this,this.actions,t,{isNew:!1,isEdited:!1}),this.workForm.load()},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){}}),MWF.xApplication.Execution.WorkDeploy.MyWorkDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,viewActionReturn:function(t){var e=!1;return t.operation&&1==t.operation.length&&(e=!0),e},splitActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("SPLIT")>-1&&(e=!0),e},authorizeActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("AUTHORIZE")>-1&&(e=!0),e},tackBackActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("TACKBACK")>-1&&(e=!0),e},archiveActionReturn:function(t){var e=!1;return t.operation&&t.operation.indexOf("ARCHIVE")>-1&&(e=!0),e},action_view:function(){MWF.xDesktop.requireApp("Execution","WorkForm",function(){new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,this.data,{isNew:!1,isEdited:!1}).load()}.bind(this))},action_split:function(){MWF.xDesktop.requireApp("Execution","WorkForm",function(){var t={title:this.data.title,centerId:this.data.centerId,centerWorkTitle:this.data.centerTitle,parentWorkId:this.data.id,workType:this.data.workType,workLevel:this.data.workLevel,completeDateLimitStr:this.data.completeDateLimitStr,completeDateLimit:this.data.completeDateLimit,reportCycle:this.data.reportCycle,reportDayInCycle:this.data.reportDayInCycle};this.data.id&&this.actions.getBaseWorkDetails(this.data.id,function(e){t.workSplitAndDescription=e.data.workDetail}.bind(this),null,!1),new MWF.xApplication.Execution.WorkForm(this,this.app.restActions,{centerWorkTitle:this.data.centerTitle},{isNew:!0,isEdited:!1,parentWorkId:this.data.id,actionStatus:"save",onPostSave:function(){this.explorer.reloadTableContent()}.bind(this)}).load()}.bind(this))},action_authorize:function(){var t={workId:this.data.id};new MWF.xApplication.Execution.WorkDeploy.Appoint(this.view.app,this.view.app.restActions,t,this.view.css,{ieEdited:!0,onReloadView:function(t){this.explorer.reloadTableContent()}.bind(this)}).load()},action_tackBack:function(t){var e=this;e.app.confirm("warn",t,e.lp.submitWarn.warnTitle,e.lp.submitWarn.warnTackBackContent,300,120,(function(){e.actions.unAppointBaseWork({workId:e.data.id},function(t){t.type&&"success"==t.type&&(e.app.notice(e.explorer.lp.prompt.tackbackBaseWork,"success"),e.explorer.reloadTableContent())}.bind(e),function(t,o,i){e.explorer.showErrorMessage(t,o,i)}.bind(e)),this.close()}),(function(){this.close()}))},action_archive:function(t){var e=this;e.view.app.confirm("warn",t,e.view.app.lp.WorkDeploy.submitWarn.warnTitle,e.view.app.lp.WorkDeploy.submitWarn.warnArchiveContent,300,120,(function(){e.app.createShade(),e.actions.archiveBaseWork(e.data.id,function(t){t.type&&"success"==t.type&&(this.app.notice(e.view.explorer.lp.prompt.archiveBaseWork,"success"),e.view.explorer.reloadTableContent(),e.app.destroyShade())}.bind(e),function(t,o,i){e.view.explorer.showErrorMessage(t,o,i),e.app.destroyShade()}.bind(e)),this.close()}),(function(){this.close()}))},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){t.getElements("div[item='workDetail']").length>0&&e.hasSubWorks&&t.getElements("div[item='workDetail']").setStyle("color","#ec6a1a"),t.getElements("div[name='appointDiv']")&&e.workProcessIdentity&&e.workProcessIdentity.indexOf("AUTHORIZE")>-1&&t.getElements("div[name='appointDiv']").setStyle("display",""),t.getElements("div[styles='documentSubject']")&&t.getElements("div[styles='documentSubject']").set("title",e.workDetail)}}),MWF.xApplication.Execution.WorkDeploy.Appoint=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"500",height:"300",hasTop:!0,hasIcon:!1,hasBottom:!0,title:"",draggable:!1,closeAction:!0,closeText:"",needLogout:!1,isNew:!0},initialize:function(t,e,o,i,n){this.setOptions(n),this.app=t,this.actions=this.app.restActions,this.css=i,this.data=o||{},this.actions=e},load:function(){this.create()},createTopNode:function(){this.formTopNode||(this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode),this.formTopIconNode=new Element("div.formTopIconNode",{styles:this.css.formTopIconNode}).inject(this.formTopNode),this.formTopTextNode=new Element("div.formTopTextNode",{styles:this.css.formTopTextNode,text:this.app.lp.workTask.appoint.appointTitle}).inject(this.formTopNode),this.options.closeAction&&(this.formTopCloseActionNode=new Element("div.formTopCloseActionNode",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode),this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))),this.formTopContentNode=new Element("div.formTopContentNode",{styles:this.css.formTopContentNode}).inject(this.formTopNode))},_createTableContent:function(){var t=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0"}).inject(this.formTableArea);t.setStyles({"margin-top":"40px"});var e=new Element("tr").inject(t),o=new Element("td",{text:this.app.lp.workTask.appoint.appointFor,valign:"middle",width:"20%"}).inject(e);o=new Element("td",{width:"80%"}).inject(e),this.appointPerson=new MDomItem(o,{name:"appointPerson",type:"org",orgType:"identity",notEmpty:!0,style:{width:"90%",height:"25px",border:"1px solid #666"}},!0,this.app),this.appointPerson.load(),e=new Element("tr").inject(t),o=new Element("td",{text:this.app.lp.workTask.appoint.appointOpinion,valign:"middle"}).inject(e),o=new Element("td").inject(e),this.appointOpinion=new Element("textarea").inject(o),this.appointOpinion.setStyles({width:"90%",height:"50px"})},_createBottomContent:function(){this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.app.lp.workTask.appoint.appointCancel}).inject(this.formBottomNode),this.cancelActionNode.addEvent("click",function(t){this.close()}.bind(this)),this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.app.lp.workTask.appoint.appointOK}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(t){this.ok(t)}.bind(this))},ok:function(){if(""==this.appointPerson.getValue())return this.app.notice(this.app.lp.workTask.appoint.personEmpty,"error"),!1;if(""==this.appointOpinion.get("value"))return this.app.notice(this.app.lp.workTask.appoint.opinionEmpty,"error"),!1;var t={workId:this.data.workId,undertakerIdentity:this.appointPerson.getValue(","),authorizeOpinion:this.appointOpinion.get("value")};this.actions.appointBaseWork(t,function(t){this.app.notice(this.app.lp.WorkDeploy.prompt.authorizeBaseWork,"success"),this.close(),this.fireEvent("reloadView")}.bind(this),function(t,e,o){var i=o;t&&(errorMessage=t.responseText);var n=JSON.parse(errorMessage);n.message?this.app.notice(n.message,"error"):this.app.notice(i,"error")}.bind(this),!1)},selectPerson:function(t,e,o){MWF.xDesktop.requireApp("Selector","package",null,!1),this.fireEvent("querySelect",this);var i=t.get("value").split(this.valSeparator),n={type:e,title:this.app.lp.workTask.appoint.appointTitle,count:o,values:i||[],onComplete:function(e){var o=[];e.each(function(t){o.push(t.data.distinguishedName)}.bind(this)),t.set("value",o.join(","))}.bind(this)};new MWF.O2Selector(this.app.content,n)}});