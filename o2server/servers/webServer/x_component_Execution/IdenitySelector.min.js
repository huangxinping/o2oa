MWF.xApplication.Execution=MWF.xApplication.Execution||{},MWF.xDesktop.requireApp("Template","Explorer",null,!1),MWF.xDesktop.requireApp("Template","MPopupForm",null,!1),MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.require("MWF.xDesktop.UserData",null,!1),MWF.xApplication.Execution.IdenitySelector=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"default",width:"500",height:"300",hasTop:!0,hasIcon:!1,hasBottom:!0,title:"",draggable:!1,closeAction:!1,closeText:"",needLogout:!1,isNew:!0},initialize:function(t,e,i,o,s){this.setOptions(s),this.app=t,this.actions=this.app.restActions,this.css=o,this.options.title=this.app.lp.idenitySelectTitle,this.identities=i,this.actions=e,this.loadCss()},load:function(){this.create()},loadCss:function(){this.cssPath="../x_component_Execution/$Main/"+this.options.style+"/css.wcss",this._loadCss()},createTopNode:function(){this.formTopNode||(this.formTopNode=new Element("div.formTopNode",{styles:this.css.formTopNode}).inject(this.formNode),this.formTopIconNode=new Element("div",{styles:this.css.formTopIconNode}).inject(this.formTopNode),this.formTopTextNode=new Element("div",{styles:this.css.formTopTextNode,text:this.options.title}).inject(this.formTopNode),this.options.closeAction&&(this.formTopCloseActionNode=new Element("div",{styles:this.css.formTopCloseActionNode}).inject(this.formTopNode),this.formTopCloseActionNode.addEvent("click",function(){this.close()}.bind(this))),this.formTopContentNode=new Element("div",{styles:this.css.formTopContentNode}).inject(this.formTopNode),this._createTopContent())},_createTableContent:function(){var t=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0"}).inject(this.formTableArea),e=new Element("tr").inject(t),i=new Element("td",{valign:"middle"}).inject(e);this.identities.each(function(t,e){var o=t.name||t.leaderIdentity.split("@")[0],s=t.unitName||t.leaderUnitName.split("@")[0],n=new Element("div",{styles:this.css.identitySelNode,text:o+"("+s+")"}).inject(i);n.set("identity",e),n.store("id",t),n.store("distinguishedName",t.distinguishedName||t.leaderIdentity),n.addEvents({mouseover:function(t){this.selectedNode!=t.target&&t.target.setStyles(this.css.identitySelNode_over)}.bind(this),mouseout:function(t){this.selectedNode!=t.target&&t.target.setStyles(this.css.identitySelNode_out)}.bind(this),click:function(t){this.selected(t.target)}.bind(this),dblclick:function(t){this.selectedNode=t.target,this.ok()}.bind(this)})}.bind(this))},selected:function(t){this.selectedNode&&this.selectedNode.setStyles(this.css.identitySelNode),this.selectedNode=t,t.setStyles(this.css.identitySelNode_selected)},_createBottomContent:function(){this.cancelActionNode=new Element("div.formCancelActionNode",{styles:this.css.formCancelActionNode,text:this.options.closeText}).inject(this.formBottomNode),this.cancelActionNode.addEvent("click",function(t){this.cancel(t)}.bind(this)),this.okActionNode=new Element("div.formOkActionNode",{styles:this.css.formOkActionNode,text:this.app.lp.comfirm}).inject(this.formBottomNode),this.okActionNode.addEvent("click",function(t){this.ok(t)}.bind(this))},cancel:function(){this.fireEvent("postSelectorClose")},ok:function(){if(this.selectedNode){var t={};t.loginIdentity=this.selectedNode.retrieve("distinguishedName"),this.options.needLogout?this.actions.logout({},function(e){e.type&&"success"==e.type&&this.actions.login(t,function(e){MWF.UD.putData("okr_identity_login",{identity:t.loginIdentity}),e.data&&e.data.okrManager&&(this.app.okrManager=e.data.okrManager),this.fireEvent("postSelectorOk",t.loginIdentity),this.close()}.bind(this),function(t,e,i){}.bind(this),!1)}.bind(this),null,!1):this.actions.login(t,function(e){MWF.UD.putData("okr_identity_login",{identity:t.loginIdentity}),e.data&&e.data.okrManager&&(this.app.okrManager=e.data.okrManager),this.fireEvent("postSelectorOk",t.loginIdentity),this.close()}.bind(this),null,!1)}else this.app.notice(this.app.lp.idenitySelecNotice,"error")}});