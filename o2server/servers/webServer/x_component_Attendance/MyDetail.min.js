MWF.xDesktop.requireApp("Attendance","Explorer",null,!1),MWF.xDesktop.requireApp("Selector","package",null,!1),MWF.xDesktop.requireApp("Template","MForm",null,!1),MWF.xApplication.Attendance.MyDetail=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,s){this.setOptions(s),this.app=e,this.path="../x_component_Attendance/$MyDetail/",this.cssPath="../x_component_Attendance/$MyDetail/"+this.options.style+"/css.wcss",this._loadCss(),this.actions=i,this.node=$(t)},load:function(){this.loadTab()},loadTab:function(){this.tabNode=new Element("div",{styles:this.css.tabNode}).inject(this.node),this.detailArea=new Element("div",{styles:this.css.tabPageContainer}).inject(this.tabNode),this.detailStaticArea=new Element("div",{styles:this.css.tabPageContainer}).inject(this.tabNode),MWF.require("MWF.widget.Tab",function(){this.tabs=new MWF.widget.Tab(this.tabNode,{style:"attendance"}),this.tabs.load(),this.detailPage=this.tabs.addTab(this.detailArea,"我的出勤明细",!1),this.detailPage.contentNodeArea.set("class","detailPage"),this.detailPage.addEvent("show",function(){this.detailExplorer||(this.detailExplorer=new MWF.xApplication.Attendance.MyDetail.Explorer(this.detailArea,this),this.detailExplorer.load())}.bind(this)),this.detailStaticPage=this.tabs.addTab(this.detailStaticArea,"我的出勤率统计",!1),this.detailStaticPage.contentNodeArea.set("class","detailStaticPage"),this.detailStaticPage.addEvent("show",function(){this.detailStaticExplorer||(this.detailStaticExplorer=new MWF.xApplication.Attendance.MyDetail.DetailStaticExplorer(this.detailStaticArea,this),this.detailStaticExplorer.load())}.bind(this)),this.tabs.pages[0].showTab()}.bind(this))}}),MWF.xApplication.Attendance.MyDetail.Explorer=new Class({Extends:MWF.xApplication.Attendance.Explorer,Implements:[Options,Events],initialize:function(t,e,i){this.setOptions(i),this.parent=e,this.app=e.app,this.css=e.css,this.path=e.path,this.actions=e.actions,this.node=$(t),this.preMonthDate=new Date,this.initData(),this.peopleActions||(this.peopleActions=new MWF.xAction.org.express.RestActions)},initData:function(){this.toolItemNodes=[]},reload:function(){this.node.empty(),this.load()},load:function(){this.loadConfig(),this.loadFilter(),this.loadContentNode(),this.setNodeScroll();var t=(this.preMonthDate.getMonth()+1).toString();1==t.length&&(t="0"+t);var e={cycleYear:this.preMonthDate.getFullYear().toString(),cycleMonth:t};this.loadView(e)},loadConfig:function(){var t;this.config={},this.configSetting=new Object(null),this.actions.listSetting(function(e){e.data?(e.data.map(function(t){this.configSetting[t.configCode]=t}.bind(this)),t=this.configSetting.APPEALABLE.configValue):t=null}.bind(this),null,!1),this.config.APPEALABLE=!t||"false"!=t},loadFilter:function(){this.fileterNode=new Element("div.fileterNode",{styles:this.css.fileterNode}).inject(this.node);this.fileterNode.set("html","<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='filterTable'><tr>    <td styles='filterTableTitle' lable='cycleYear'></td>    <td styles='filterTableValue' item='cycleYear'></td>    <td styles='filterTableTitle' lable='cycleMonth'></td>    <td styles='filterTableValue' item='cycleMonth'></td>    <td styles='filterTableTitle' lable='date'></td>    <td styles='filterTableValue' item='date'></td>    <td styles='filterTableTitle' lable='isAbsent'></td>    <td styles='filterTableValue' item='isAbsent'></td>    <td styles='filterTableTitle' lable='isLate'></td>    <td styles='filterTableValue' item='isLate'></td>    <td styles='filterTableTitle' lable='isLackOfTime'></td>    <td styles='filterTableValue' item='isLackOfTime'></td>    <td styles='filterTableValue' item='action'></td></tr></table>"),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.fileterNode,{},{isEdited:!0,itemTemplate:{cycleYear:{text:"年度",type:"select",selectValue:function(){for(var t=[],e=(new Date).getFullYear(),i=0;i<6;i++)t.push(e--);return t},event:{change:function(t,e){var i=this.getDateSelectValue();t.form.getItem("date").resetItemOptions(i,i)}.bind(this)}},cycleMonth:{text:"月份",type:"select",defaultValue:function(){var t=((new Date).getMonth()+1).toString();return 1==t.length?"0"+t:t},selectValue:["","01","02","03","04","05","06","07","08","09","10","11","12"],event:{change:function(t,e){var i=this.getDateSelectValue();t.form.getItem("date").resetItemOptions(i,i)}.bind(this)}},date:{text:"日期",type:"select",selectValue:function(){var t=this.preMonthDate.getFullYear(),e=this.preMonthDate.getMonth(),i=new Date(t,e,1),s=[];for(s.push("");i.getMonth()===e;){var a=i.getDate().toString();1==a.length&&(a="0"+a),s.push(a),i.setDate(i.getDate()+1)}return s}.bind(this)},isAbsent:{text:"缺勤",type:"select",selectValue:["","true","false"],selectText:["","缺勤","未缺勤"]},isLate:{text:"迟到",type:"select",selectValue:["","true","false"],selectText:["","迟到","未迟到"]},isLackOfTime:{text:"工时不足",type:"select",selectValue:["","true","false"],selectText:["","是","否"]},action:{value:"查询",type:"button",className:"filterButton",event:{click:function(){var t=this.form.getResult(!1,null,!1,!0,!1);"string"==typeOf(t.isAbsent)&&(t.isAbsent=this.getBoolean(t.isAbsent)),"string"==typeOf(t.isLate)&&(t.isLate=this.getBoolean(t.isLate)),"string"==typeOf(t.isLackOfTime)&&(t.isLackOfTime=this.getBoolean(t.isLackOfTime)),t.date&&""!=t.date&&(t.q_date=year+"-"+month+"-"+t.date),this.loadView(t)}.bind(this)}}}},this.app,this.css),this.form.load()}.bind(this),!0)},getBoolean:function(t){return"true"===t||"false"!==t&&t},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node),this.app.addEvent("resize",function(){this.setContentSize()}.bind(this))},loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.MyDetail.View(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.load(),this.setContentSize()},setContentSize:function(){var t=this.parent.tabs?this.parent.tabs.tabNodeContainer.getSize():{x:0,y:0},e=this.fileterNode?this.fileterNode.getSize():{x:0,y:0},i=this.parent.node.getSize(),s=this.elementContentNode.getStyle("padding-top").toFloat(),a=this.elementContentNode.getStyle("padding-bottom").toFloat(),n=i.y-t.y-s-a-e.y-20;this.elementContentNode.setStyle("height",n+"px"),this.pageCount=(n/40).toInt()+5,this.view&&this.view.items.length<this.pageCount&&this.view.loadElementList(this.pageCount-this.view.items.length)}}),MWF.xApplication.Attendance.MyDetail.SelfHoliday=new Class({Extends:MWF.xApplication.Attendance.MyDetail.Explorer,loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.MyDetail.SelfHolidayView(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.load(),this.setContentSize()}}),MWF.xApplication.Attendance.MyDetail.DetailStaticExplorer=new Class({Extends:MWF.xApplication.Attendance.MyDetail.Explorer,load:function(){this.loadContentNode(),this.setNodeScroll();var t={cycleYear:this.preMonthDate.getFullYear().toString(),cycleMonth:this.preMonthDate.format(this.app.lp.dateFormatOnlyMonth)};this.loadView(t)},loadFilter:function(){this.fileterNode=new Element("div.fileterNode",{styles:this.css.fileterNode}).inject(this.node);var t=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.filterTable,class:"filterTable"}).inject(this.fileterNode);t.setStyle("width","360px");var e=new Element("tr").inject(t);this.createYearSelectTd(e),this.createMonthSelectTd(e),this.createActionTd(e)},createMonthSelectTd:function(t){var e=this,i=new Element("td",{styles:this.css.filterTableTitle,text:"月份"}).inject(t);i=new Element("td",{styles:this.css.filterTableValue}).inject(t);this.cycleMonth=new MDomItem(i,{name:"cycleMonth",type:"select",selectValue:["","01","02","03","04","05","06","07","08","09","10","11","12"],event:{change:function(){e.dateSelecterTd&&e.createDateSelectTd()}}},!0,this.app),this.cycleMonth.load()},createActionTd:function(t){var e=new Element("td",{styles:this.css.filterTableValue}).inject(t);new Element("button",{text:"查询",styles:this.css.filterButton}).inject(e).addEvent("click",function(){var t=this.preMonthDate.getFullYear().toString(),e=(this.preMonthDate.getMonth()+1).toString();1==e.length&&(e="0"+e);var i={cycleYear:t,cycleMonth:e};this.isAbsent&&""!=this.isAbsent.getValue()&&(i.isAbsent=this.isAbsent.getValue()),this.isLeaveEarlier&&""!=this.isLeaveEarlier.getValue()&&(i.isLeaveEarlier=this.isLeaveEarlier.getValue()),this.isLate&&""!=this.isLate.getValue()&&(i.isLate=this.isLate.getValue()),this.q_date&&""!=this.q_date.getValue()&&(i.q_date=t+"-"+e+"-"+this.q_date.getValue()),this.loadView(i)}.bind(this))},loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.MyDetail.DetailStaticView(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.listItemUrl=this.path+"listItem_detailStatic.json",this.view.load(),this.setContentSize()}}),MWF.xApplication.Attendance.MyDetail.SelfHolidayStaticExplorer=new Class({Extends:MWF.xApplication.Attendance.MyDetail.Explorer,loadView:function(t){this.elementContentNode.empty(),this.view&&delete this.view,this.view=new MWF.xApplication.Attendance.MyDetail.SelfHolidayStaticView(this.elementContentNode,this.app,this),this.view.filterData=t,this.view.load(),this.setContentSize()}}),MWF.xApplication.Attendance.MyDetail.View=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.MyDetail.Document(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){e||(e=100);var i=this.items.length?this.items[this.items.length-1].data.id:"(0)",s=this.filterData||{};s.key=this.sortField||this.sortFieldDefault||"",s.order=this.sortType||this.sortTypeDefault||"",s.q_empName=layout.desktop.session.user.distinguishedName,this.actions.listDetailFilterNext(i,e,s,function(e){var i=e.data;i.each(function(t){t.APPEALABLE=this.explorer.config.APPEALABLE}.bind(this)),e.data=i,t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.MyDetail.SelfHolidayView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.MyDetail.SelfHolidayDocument(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.filterData||{};i.q_empName=layout.desktop.session.user.distinguishedName,this.actions.listDetailFilterUser(i,function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.MyDetail.DetailStaticView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.MyDetail.DetailStaticDocument(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.filterData||{};i.key=this.sortField||this.sortFieldDefault||"",i.order=this.sortType||this.sortTypeDefault||"",i.q_empName=layout.desktop.session.user.distinguishedName;var s=((new Date).getMonth()+1).toString();1==s.length&&(s="0"+s),i.cycleMonth=s,this.actions.listStaticMonthPerson(i.q_empName,i.cycleYear,i.cycleMonth,function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.MyDetail.SelfHolidayStaticView=new Class({Extends:MWF.xApplication.Attendance.Explorer.View,_createItem:function(t){return new MWF.xApplication.Attendance.MyDetail.SelfHolidayStaticDocument(this.table,t,this.explorer,this)},_getCurrentPageData:function(t,e){var i=this.filterData||{};this.actions.listDetailFilterUser(i,function(e){t&&t(e)}.bind(this))},_removeDocument:function(t,e){},_createDocument:function(){},_openDocument:function(t){}}),MWF.xApplication.Attendance.MyDetail.Document=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document,appeal:function(){"BUILTIN"==this.explorer.configSetting.APPEAL_AUDIFLOWTYPE.configValue?new MWF.xApplication.Attendance.MyDetail.Appeal(this.explorer,this.data).create():this.loadProcess(this.explorer.configSetting.APPEAL_AUDIFLOW_ID.configValue,{record:this.data},null)},loadProcess:function(t,e,i){this.getProcess(t,function(t){MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){new MWF.xApplication.process.TaskCenter.ProcessStarter(t,this.app,{latest:i,workData:e,onStarted:function(t,e,i){this.afterStartProcess(t,e,i)}.bind(this)}).load()}.bind(this))}.bind(this))},afterStartProcess:function(t,e,i){var s=[],a=[];if(t.each(function(t){-1!==t.currentTaskIndex&&a.push(t.taskList[t.currentTaskIndex].work),s.push(this.getStartWorkInforObj(t))}.bind(this)),1===a.length){var n={workId:a[0],appId:a[0]};this.app.desktop.openApplication(null,"process.Work",n),this.createStartWorkResault(s,e,i,!1)}else this.createStartWorkResault(s,e,i,!0)},createStartWorkResault:function(t,e,i,s){var a="";t.each(function(t){var e=[];t.users.each((function(t){e.push(MWF.name.cn(t))})),a+="<div><b>"+this.app.lp.nextActivity+'<font style="color: #ea621f">'+t.activity+"</font>, "+this.app.lp.nextUser+'<font style="color: #ea621f">'+e.join(", ")+"</font></b>",t.currentTask&&s?a+='&nbsp;&nbsp;&nbsp;&nbsp;<span value="'+t.currentTask+'">'+this.app.lp.deal+"</span></div>":a+="</div>"}.bind(this));var n=t[0].title||e,o={subject:this.app.lp.processStarted,content:"<div>"+this.app.lp.processStartedMessage+"“["+i+"]"+n+"”</div>"+a},l=layout.desktop.message.addTooltip(o),r=layout.desktop.message.addMessage(o);this.setStartWorkResaultAction(l),this.setStartWorkResaultAction(r)},getStartWorkInforObj:function(t){var e="",i=[],s="";return t.taskList.each(function(a,n){e=a.title,i.push(a.person+"("+a.department+")"),t.currentTaskIndex===n&&(s=a.id)}.bind(this)),{activity:t.fromActivityName,users:i,currentTask:s,title:e}},setStartWorkResaultAction:function(t){var e=t.node.getElements("span");e.setStyles(this.css.dealStartedWorkAction);var i=this;e.addEvent("click",(function(t){var e={taskId:this.get("value"),appId:this.get("value")};i.app.desktop.openApplication(t,"process.Work",e)}))},getProcess:function(t,e){this.action=new o2.xDesktop.Actions.RestActions("","x_processplatform_assemble_surface",""),this.action.actions={getProces:{uri:"/jaxrs/process/{id}/complex"}},this.action.invoke({name:"getProces",async:!1,parameter:{id:t},success:function(t){e&&e(t.data)}.bind(this)})},seeAppeal:function(){if(this.data.appealInfos[0].appealAuditInfo&&this.data.appealInfos[0].appealAuditInfo.workId){var t=this.data.appealInfos[0].appealAuditInfo.workId,e={workId:t,appId:"process.Work"+t};this.app.desktop.openApplication(null,"process.Work",e)}else{new MWF.xApplication.Attendance.MyDetail.Appeal(this.explorer,this.data).open()}}}),MWF.xApplication.Attendance.MyDetail.SelfHolidayDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document}),MWF.xApplication.Attendance.MyDetail.DetailStaticDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document}),MWF.xApplication.Attendance.MyDetail.SelfHolidayStaticDocument=new Class({Extends:MWF.xApplication.Attendance.Explorer.Document}),MWF.xApplication.Attendance.MyDetail.Appeal=new Class({Extends:MWF.widget.Common,initialize:function(t,e){this.explorer=t,this.app=t.app,this.detailData=e,this.css=this.explorer.css,this.load()},load:function(){},open:function(t){this.isNew=!1,this.isEdited=!1,this.app.restActions.getAppeal(this.detailData.id,function(t){this.data=t.data,this.data.onDutyTime=this.detailData.onDutyTime,this.data.offDutyTime=this.detailData.offDutyTime}.bind(this),null,!1),this.data||(this.data=this.detailData||{}),this._open()},create:function(){this.isNew=!0,this.data=this.detailData||{},this._open()},edit:function(){this.isEdited=!0,this.app.restActions.getAppeal(this.detailData.id,function(t){this.data=t.data,this.data.onDutyTime=this.detailData.onDutyTime,this.data.offDutyTime=this.detailData.offDutyTime}.bind(this),null,!1),this.data||(this.data=this.detailData||{}),this._open()},_open:function(){this.createMarkNode=new Element("div",{styles:this.css.createMarkNode,events:{mouseover:function(t){t.stopPropagation()},mouseout:function(t){t.stopPropagation()}}}).inject(this.app.content,"after"),this.createAreaNode=new Element("div",{styles:this.css.createAreaNode}),this.createNode(),this.createAreaNode.inject(this.createMarkNode,"after"),this.createAreaNode.fade("in"),this.setCreateNodeSize(),this.setCreateNodeSizeFun=this.setCreateNodeSize.bind(this),this.addEvent("resize",this.setCreateNodeSizeFun)},createNode:function(){var t=this;this.createNode=new Element("div",{styles:this.css.createNode}).inject(this.createAreaNode),this.createContainerNode=new Element("div",{styles:this.css.createContainerNode}).inject(this.createNode),this.setScrollBar(this.createContainerNode),this.createIconNode=new Element("div",{styles:this.isNew?this.css.createNewNode:this.css.createIconNode}).inject(this.createContainerNode),this.createFormNode=new Element("div",{styles:this.css.createFormNode}).inject(this.createContainerNode),this.createTableContainer=new Element("div",{styles:this.css.createTableContainer}).inject(this.createFormNode),this.createTableArea=new Element("div",{styles:this.css.createTableArea}).inject(this.createTableContainer);var e=this.data,i=[];e.isGetSelfHolidays&&"全天"==e.selfHolidayDayTime?i.push("请假或外出报备"):e.isAbnormalDuty&&"全天"==e.abnormalDutyDayTime?i.push("异常打卡"):e.isLackOfTime?i.push("工时不足"):(e.isGetSelfHolidays&&"上午"==e.selfHolidayDayTime?i.push("请假或外出报备"):e.isLate?i.push("迟到"):!e.isAbsent||"上午"!=e.absentDayTime&&"全天"!=e.absentDayTime?!e.isAbnormalDuty||"全天"!=e.abnormalDutyDayTime&&"上午"!=e.abnormalDutyDayTime||i.push("异常打卡"):i.push("缺勤"),e.isGetSelfHolidays&&"下午"==e.selfHolidayDayTime?i.push("请假或外出报备"):e.isAbsent&&"下午"==e.absentDayTime?i.push("缺勤"):e.isAbnormalDuty&&"下午"==e.abnormalDutyDayTime&&i.push("异常打卡")),this.data.statusShow=i.unique().join();var s="发起";0==e.status?s="待处理":1==e.status?s="审批通过":-1==e.status&&(s="审批未通过"),this.data.appealStatusShow=s;var a=this.getIdentity(),n="<table width='100%' bordr='0' cellpadding='5' cellspacing='0' styles='formTable'><tr><td colspan='4' styles='formTableHead'>申诉申请单</td></tr><tr><td styles='formTableTitle'>员工姓名</td>    <td styles='formTableValue'>"+this.data.empName.split("@")[0]+"</td>    <td styles='formTableTitle' lable='recordDateString'></td>    <td styles='formTableValue' item='recordDateString'></td></tr><tr><td styles='formTableTitle' lable='onDutyTime'></td>    <td styles='formTableValue' item='onDutyTime'></td>"+("2"==this.data.signProxy||"3"==this.data.signProxy?"    <td styles='formTableTitle' lable='morningOffDutyTime'></td>    <td styles='formTableValue' item='morningOffDutyTime'></td></tr><tr><td styles='formTableTitle' lable='afternoonOnDutyTime'></td>    <td styles='formTableValue' item='afternoonOnDutyTime'></td>":"")+"    <td styles='formTableTitle' lable='offDutyTime'></td>    <td styles='formTableValue' item='offDutyTime'></td></tr>"+(this.isNew&&a.identities.length>1?"<tr><td styles='formTableTitle' lable='identity'></td>    <td styles='formTableValue' item='identity'  colspan='3'></td></tr>":"")+(this.isNew?"<tr><td styles='formTableTitle' lable='statusShow'></td>    <td styles='formTableValue' item='statusShow'></td>    <td styles='formTableTitle' lable='appealStatusShow'></td>    <td styles='formTableValue' item='appealStatusShow'></td></tr>":"<tr><td styles='formTableTitle' lable='appealStatusShow'></td>    <td styles='formTableValue' item='appealStatusShow'  colspan='3'></td></tr>")+"<tr><td styles='formTableTitle' lable='appealReason'></td>    <td styles='formTableValue' item='appealReason' colspan='3'></td></tr><tr contain='selfHolidayType'><td styles='formTableTitle' lable='selfHolidayType'></td>    <td styles='formTableValue' item='selfHolidayType' colspan='3'></td></tr><tr contain='address'><td styles='formTableTitle' lable='address'></td>    <td styles='formTableValue' item='address' colspan='3'></td></tr><tr contain='startTime'><td styles='formTableTitle' lable='startTime'></td>    <td styles='formTableValue' item='startTime' colspan='3'></td></tr><tr contain='endTime'><td styles='formTableTitle' lable='endTime'></td>    <td styles='formTableValue' item='endTime' colspan='3'></td></tr><tr contain='appealDescription'><td styles='formTableTitle' lable='appealDescription'></td>    <td styles='formTableValue' item='appealDescription' colspan='3'></td></tr></table>";this.createTableArea.set("html",n);var o=this.app.lp.schedule,l=this.data.signProxy||1;this.document=new MForm(this.createTableArea,this.data,{style:"popup",isEdited:this.isEdited||this.isNew,itemTemplate:{recordDateString:{text:"考勤日期",type:"innertext"},onDutyTime:{text:"上班打卡时间",type:"innertext"},morningOffDutyTime:{text:1==l?"":o.signProxy[l].middayRestStartTime,type:"innertext"},afternoonOnDutyTime:{text:1==l?"":o.signProxy[l].middayRestEndTime,type:"innertext"},offDutyTime:{text:"下班打卡时间",type:"innertext"},statusShow:{text:"考勤状态",type:"innertext"},appealStatusShow:{text:"审批状态",type:"innertext"},appealReason:{notEmpty:!0,text:"申述原因",type:"select",selectValue:["","临时请假","出差","因公外出","其他"],event:{change:function(e){t.switchFieldByAppealReason(e.getValue())}}},identity:{notEmpty:!0,text:"选择部门",type:"radio",defaultValue:function(){return a.identities[0]}.bind(this),selectText:a.units,selectValue:a.identities},address:{text:"地点"},selfHolidayType:{text:"请假类型",type:"select",selectValue:["","带薪年休假","带薪病假","带薪福利假","扣薪事假","其他"]},startTime:{text:"开始日期",tType:"datetime"},endTime:{text:"结束日期",tType:"datetime"},appealDescription:{text:"事由"}}},this.app,this.css),this.document.load(),t.switchFieldByAppealReason(this.data.appealReason),this.cancelActionNode=new Element("div",{styles:this.css.createCancelActionNode,text:this.app.lp.cancel}).inject(this.createFormNode),this.cancelActionNode.addEvent("click",function(t){this.cancelCreate(t)}.bind(this)),(this.isNew||this.isEdited)&&(this.createOkActionNode=new Element("div",{styles:this.css.createOkActionNode,text:this.app.lp.ok}).inject(this.createFormNode),this.createOkActionNode.addEvent("click",function(t){this.okCreate(t)}.bind(this)))},switchFieldByAppealReason:function(t){var e=[];"临时请假"==t?e=["selfHolidayType","startTime","endTime"]:"出差"==t?e=["address","startTime","endTime"]:"因公外出"==t?e=["address","startTime","endTime","appealDescription"]:"其他"==t&&(e=["appealDescription"]),["selfHolidayType","startTime","endTime","address","appealDescription"].each(function(t){this.createTableArea.getElement("[contain='"+t+"']").setStyle("display",e.contains(t)?"":"none"),(this.isNew||this.isEdited)&&(this.document.items[t].options.notEmpty=!!e.contains(t))}.bind(this))},getIdentity:function(){var t={identities:[],units:[]};return this.app.personActions.getPerson(function(e){e.data.woIdentityList.each(function(e){var i=e.woUnit;t.identities.push(e.distinguishedName),t.units.push(i.name)}.bind(this))}.bind(this),null,!1),t},getAuditor:function(){var t={},e=[];if(this.app.restActions.listSetting(function(e){e.data.each(function(e){t[e.configCode]=e}.bind(this))}.bind(this),null,!1),t.APPEAL_AUDITOR_TYPE&&""!=t.APPEAL_AUDITOR_TYPE.configValue&&t.APPEAL_AUDITOR_VALUE&&""!=t.APPEAL_AUDITOR_VALUE.configValue){if("汇报对象"==t.APPEAL_AUDITOR_TYPE.configValue){var i={personList:[layout.desktop.session.user.distinguishedName]};this.app.orgActions.listPersonSupDirectValue(i,function(t){var i=t.data.personList;if(i&&i[0]){var s=i[0];"i"==s.split("@")[s.split("@").length-1].toLowerCase()?e.push(this.getPersonByIdentity(s)):e.push(s)}else this.app.notice("组织管理中没有配置您的汇报对象，请联系管理员","error")}.bind(this),null,!1)}else if("所属部门职位"==t.APPEAL_AUDITOR_TYPE.configValue)this.app.personActions.getPerson(function(i){i.data.woIdentityList.each(function(i){var s=i.woUnit,a={name:t.APPEAL_AUDITOR_VALUE.configValue,unit:s.distinguishedName};this.app.orgActions.getDutyValue(a,function(i){var a=i.data?i.data.identityList:[];"array"==typeOf(a)&&a[0]?a.each(function(t){e=e.concat(this.getPersonByIdentity(t))}.bind(this)):this.app.notice("系统中没有配置"+s.name+"的"+t.APPEAL_AUDITOR_VALUE.configValue+"职位，请联系管理员","error")}.bind(this),null,!1)}.bind(this))}.bind(this),null,!1);else if("人员属性"==t.APPEAL_AUDITOR_TYPE.configValue)this.app.personActions.getPerson(function(i){var s=t.APPEAL_AUDITOR_VALUE.configValue;i.data.woPersonAttributeList.each((function(t){if(t.name==s){var i=t.attributeList[0];i&&("i"==i.split("@")[i.split("@").length-1].toLowerCase()?e.push(this.getPersonByIdentity(i)):e.push(i))}}))}.bind(this),null,!1),0==e.length&&this.app.notice("系统中没有配置您的人员属性“"+t.APPEAL_AUDITOR_VALUE.configValue+"”，请联系管理员","error");else if("指定人"==t.APPEAL_AUDITOR_TYPE.configValue){var s=t.APPEAL_AUDITOR_TYPE.configValue;"i"==s.split("@")[s.split("@").length-1].toLowerCase()?e.push(this.getPersonByIdentity(s)):e.push(s)}}else this.app.personActions.getPerson(function(t){t.data.woPersonAttributeList.each((function(t){if("直接主管"==t.name){var i=t.attributeList[0];i&&("i"==i.split("@")[i.split("@").length-1].toLowerCase()?e.push(this.getPersonByIdentity(i)):e.push(i))}}))}.bind(this),null,!1),this.app.notice("系统中没有配置您的人员属性“直接主管”，请联系管理员","error");return e},getPersonByIdentity:function(t){var e={identityList:[t]},i=[];return this.app.orgActions.listPersonWithIdentityValue(e,function(t){i=t.data.personList}.bind(this),null,!1),i},setCreateNodeSize:function(){var t=this.app.node.getSize();this.app.content.getSize();this.createAreaNode.setStyles({width:t.x+"px",height:t.y+"px"});var e=(t.y-"580")/2;this.createNode.setStyles({height:"580px","margin-top":e+"px",width:"800px"}),this.createContainerNode.setStyles({height:"580px"});var i="580"-(this.createIconNode?this.createIconNode.getSize():{x:0,y:0}).y-20;this.createFormNode.setStyles({height:i+"px","margin-top":"20px"})},cancelCreate:function(t){this.createMarkNode.destroy(),this.createAreaNode.destroy()},okCreate:function(t){var e=this.document.getResult(!0,",",!0,!1,!0);if(e){var i=e.startTime,s=e.endTime;if(""!=i&&""!=s)if(new Date(i.replace(/-/g,"/"))>=new Date(s.replace(/-/g,"/")))return void this.app.notice("开始日期不能晚于结束日期","error");this._ok(e)}},_ok:function(t){this.app.restActions.createAppeal(this.data.id,t,function(t){"ERROR"==t.type?this.app.notice(t.message,"error"):(this.createMarkNode.destroy(),this.createAreaNode.destroy(),this.explorer.view&&this.explorer.view.reload(),this.app.notice("申诉已提交","success"))}.bind(this))},selectDateTime:function(t,e,i,s){var a={style:"xform",timeOnly:e,isTime:i,target:this.app.content};s&&(a.baseDate=s),MWF.require("MWF.widget.Calendar",function(){new MWF.widget.Calendar(t,a).show()}.bind(this))},getUnitByPerson:function(t){var e={personList:[layout.desktop.session.user.distinguishedName]};this.app.orgActions.listUnitWithPerson(function(e){e.data.length>0?t&&t(e.data):this.app.notice("未找到您所在的部门，请联系管理员！","error")}.bind(this),function(){this.app.notice("未找到您所在的部门，请联系管理员！","error")}.bind(this),e,!1)}});