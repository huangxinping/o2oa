MWF.xApplication.cms=MWF.xApplication.cms||{},MWF.CMSE=MWF.xApplication.cms.Module=MWF.xApplication.cms.Module||{},MWF.require("MWF.widget.O2Identity",null,!1),MWF.xApplication.cms.Module.options={multitask:!1,executable:!0},MWF.xApplication.cms.Module.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"cms.Module",icon:"icon.png",width:"1200",height:"700",isResize:!0,isMax:!0,isCategory:!1,searchKey:"",title:MWF.xApplication.cms.Module.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.cms.Module.LP},onQueryClose:function(){window.clipboardData?(this.keyCopyItemsFun&&this.removeEvent("copy",this.keyCopyItemsFun),this.keyPasteItemsFun&&this.removeEvent("paste",this.keyPasteItemsFun)):(this.keyCopyItemsFun&&document.removeEventListener("copy",this.keyCopyItemsFun),this.keyPasteItemsFun&&document.removeEventListener("paste",this.keyPasteItemsFun))},loadApplication:function(t){this.isAdmin=!1,this.restActions=MWF.Actions.get("x_cms_assemble_control"),this.createNode(),this.loadApplicationContent()},createNode:function(){this.content.setStyle("overflow","hidden"),this.node=new Element("div",{styles:this.css.node}).inject(this.content),this.naviContainerNode=new Element("div.naviContainerNode",{styles:this.css.naviContainerNode}).inject(this.node),this.leftTitleNode=new Element("div.leftTitleNode",{styles:this.css.leftTitleNode}).inject(this.naviContainerNode),this.rightContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node),this.titleBar=new Element("div",{styles:this.css.titleBar}).inject(this.rightContentNode),this.titleActionBar=new Element("div",{styles:this.css.titleActionBar}).inject(this.titleBar)},loadApplicationContent:function(){var t=this.options.columnData&&this.options.columnData.id||this.status&&this.status.columnId||this.options.columnId,e=this.options.columnAlias||this.options.columnData&&this.options.columnData.columnAlias||this.status&&this.status.columnAlias;t?this.loadColumnData(t,function(){this.loadController(function(){this.loadTitle(function(){this.loadMenu()}.bind(this))}.bind(this))}.bind(this)):e&&this.restActions.getColumnByAlias(e,function(t){this.columnData=t.data,this.setColumnDataConfig(),this.setTitle(this.columnData.appName),this.loadController(function(){this.loadTitle(function(){this.loadMenu()}.bind(this))}.bind(this))}.bind(this))},setColumnDataConfig:function(){this.columnData.config?"string"===typeOf(this.columnData.config)&&(this.columnData.config=JSON.parse(this.columnData.config||{})):this.columnData.config={}},loadColumnData:function(t,e){this.restActions.getColumn(t,function(t){this.columnData=t.data,this.setTitle(this.columnData.appName),this.setColumnDataConfig(),e&&e()}.bind(this))},loadController:function(t){this.restActions.isAppInfoManager(this.columnData.id,function(e){this.isAdmin=MWF.AC.isCMSManager()||e.data.value,t&&t(e)}.bind(this))},loadTitle:function(t){this.isAdmin,this.loadCreateDocumentActionNode(function(){this.loadTitleIconNode(),this.loadTitleContentNode(),this.loadBatchAction(),this.loadPastEvent(),this.loadSearchNode(),t&&t()}.bind(this))},loadBatchAction:function(){this.isAdmin&&(this.batchAction=new Element("div",{styles:this.css.batchAction,text:"选择"}).inject(this.titleActionBar),this.batchAction.addEvents({click:function(t){this.view&&(this.view.selectEnable?(this.selectEnable=!1,this.batchAction.setStyles(this.css.batchAction),this.batchAction.set("text","选择"),this.view.disableSelectMode(),this.cancelBatchRemoveAction(),this.cancelChangeCategoryAction(),this.cancelCopyActionNode()):(this.selectEnable=!0,this.batchAction.setStyles(this.css.batchAction_over),this.batchAction.set("text","取消选择"),this.view.selectMode(),this.loadCopyActionNode(),this.loadChangeCategoryAction(),this.loadBatchRemoveAction()))}.bind(this),mouseover:function(t){this.view.selectEnable||this.batchAction.setStyles(this.css.batchAction_over)}.bind(this),mouseout:function(t){this.view.selectEnable||this.batchAction.setStyles(this.css.batchAction)}.bind(this)}))},getSearchBarSize:function(){var t=this.titleActionBar.getSize().x;return this.titleBar.getSize().x-t},loadPastEvent:function(){this.isAdmin&&(this.keyPasteItemsFun=this.keyPasteItems.bind(this),window.clipboardData?this.addEvent("paste",this.keyPasteItemsFun):document.addEventListener("paste",this.keyPasteItemsFun))},loadCreateDocumentActionNode:function(t){this.restActions.listCategoryByPublisher(this.columnData.id,function(e){e.data&&e.data.length&&(this.createDocumentAction=new Element("div",{styles:this.css.createDocumentAction,text:this.lp.start}).inject(this.titleActionBar),this.createDocumentAction.addEvents({click:function(t){MWF.xDesktop.requireApp("cms.Index","Newer",null,!1),this.creater=new MWF.xApplication.cms.Index.Newer(this.columnData,null,this,this.view,{restrictToColumn:!0}),this.creater.load()}.bind(this),mouseover:function(t){this.createDocumentAction.setStyles(this.css.createDocumentAction_over)}.bind(this),mouseout:function(t){this.createDocumentAction.setStyles(this.css.createDocumentAction)}.bind(this)})),t&&t()}.bind(this))},cancelChangeCategoryAction:function(){this.moveAction&&this.moveAction.destroy(),this.moveAction=null},loadChangeCategoryAction:function(){this.isAdmin&&(this.moveAction=new Element("div",{styles:this.css.moveDocumentAction,text:"移动"}).inject(this.titleActionBar),this.moveAction.addEvents({click:function(t){var e=this;if(this.view){var i=this.view.getSelectedIds();if(!i.length)return void this.notice("请先选择文档","error");this.loadSelectColumnDialog(function(s){if(s&&s.id){var n="移动后将在本分类删除，确定要移动选中的"+i.length+"个文档到"+s.categoryName+"？";this.confirm("warn",t,"移动确认",n,350,120,(function(){e.restActions.moveDocumentToCategory({ids:i,categoryId:s.id},function(){e.notice("移动成功","success"),e.view.reload(),this.close()}.bind(this))}),(function(){this.close()}))}}.bind(this))}}.bind(this),mouseover:function(t){this.moveAction.setStyles(this.css.moveDocumentAction_over)}.bind(this),mouseout:function(t){this.moveAction.setStyles(this.css.moveDocumentAction)}.bind(this)}))},cancelBatchRemoveAction:function(){this.batchRemoveAction&&this.batchRemoveAction.destroy(),this.batchRemoveAction=null},loadBatchRemoveAction:function(){if(this.isAdmin){var t=this;this.batchRemoveAction=new Element("div",{styles:this.css.batchRemoveDocumentAction,text:this.lp.batchRemove}).inject(this.titleActionBar),this.batchRemoveAction.addEvents({click:function(e){if(this.view){var i=this.view.getSelectedIds();if(i.length){t.readyRemove=!0;var s="删除后无法恢复，确定要删除选中的"+i.length+"个文档？";this.confirm("warn",e,"清除确认",s,350,120,(function(){t.removeDocumentList(i),this.close()}),(function(){t.readyRemove=!1,this.close()}))}else this.notice("请先选择文档","error")}}.bind(this),mouseover:function(t){this.batchRemoveAction.setStyles(this.css.batchRemoveDocumentAction_over)}.bind(this),mouseout:function(t){this.batchRemoveAction.setStyles(this.css.batchRemoveDocumentAction)}.bind(this)})}},removeDocumentList:function(t){var e=0;t.each(function(i){this.restActions.removeDocument(i,function(i){++e===t.length&&(this.notice("清除成功","success"),this.view.reload())}.bind(this))}.bind(this))},cancelCopyActionNode:function(){window.clipboardData?this.keyCopyItemsFun&&this.removeEvent("copy",this.keyCopyItemsFun):this.keyCopyItemsFun&&document.removeEventListener("copy",this.keyCopyItemsFun),this.keyCopyItemsFun=null,this.copyAction&&this.copyAction.destroy(),this.copyAction=null},loadCopyActionNode:function(){this.isAdmin&&(this.copyAction=new Element("div",{styles:this.css.copyDocumentAction,text:"启用复制"}).inject(this.titleActionBar),this.copyAction.addEvents({click:function(t){if(this.view){if(this.keyCopyItemsFun)return;this.keyCopyItemsFun=this.keyCopyItems.bind(this),window.clipboardData?this.addEvent("copy",this.keyCopyItemsFun):document.addEventListener("copy",this.keyCopyItemsFun),this.notice(this.lp.copyInfor)}}.bind(this),mouseover:function(t){this.copyAction.setStyles(this.css.copyDocumentAction_over)}.bind(this),mouseout:function(t){this.copyAction.setStyles(this.css.copyDocumentAction)}.bind(this)}))},keyCopyItems:function(t){if(layout.desktop.currentApp&&layout.desktop.currentApp.appId===this.appId){var e=this.view.getSelectedIds();if(e.length){var i=[],s=0,n=function(t){if(s>=e.length&&i.length){var n=JSON.encode(i);t&&t.clipboardData?(t.clipboardData.setData("text/plain",n),t.preventDefault()):window.clipboardData.setData("Text",n),this.notice(this.lp.copyed,"success")}}.bind(this);e.each(function(e){this.restActions.getDocument(e,function(e){e.data.elementType="cmsDocument",i.push(e.data),s++,n(t)}.bind(this),null,!1)}.bind(this))}}},keyPasteItems:function(t){if(layout.desktop.currentApp&&layout.desktop.currentApp.appId===this.appId){var e="";e=t&&t.clipboardData?t.clipboardData.getData("text/plain"):window.clipboardData.getData("Text");var i=JSON.decode(e);this.listPublishableCategoryInfo(function(){this.pasteItem(i,0)}.bind(this))}},listPublishableCategoryInfo:function(t){this.publishableCategoryInfoObject_id={},this.publishableCategoryInfoObject_alias={},this.publishableCategoryInfoObject_name={},this.categoryTransformMap={},this.categoryRadioHtml="",o2.Actions.load("x_cms_assemble_control").CategoryInfoAction.listPublishableCategoryInfo(this.columnData.id,function(e){(e.data||[]).each(function(t){this.publishableCategoryInfoObject_id[t.id]=t,this.publishableCategoryInfoObject_alias[t.categoryAlias]=t,this.publishableCategoryInfoObject_name[t.categoryName]=t,this.categoryRadioHtml+="<div><input type='radio' name='categoryRadio' value='"+t.id+"'/>"+t.categoryName+"("+t.categoryAlias+")</div>"}.bind(this)),this.categoryRadioHtml="<div style='overflow: hidden; margin: 10px 0px; padding: 5px 10px; background-color: #ffffff; border-radius: 6px;'>"+this.categoryRadioHtml+"</div>",t&&t()}.bind(this))},pasteItem:function(t,e){if(e<t.length){var i=t[e];"cmsDocument"===i.elementType?this.saveItemAs(i,function(){e++,this.pasteItem(t,e)}.bind(this),function(){e++,this.pasteItem(t,e)}.bind(this),function(){this.view.reload()}.bind(this)):(e++,this.pasteItem(t,e))}else this.view.reload()},saveItemAs:function(t,e,i,s){var n=this.lp,o=this;if(this.publishableCategoryInfoObject_id[t.document.categoryId])this._saveItemAs(t,e,i,s);else if(this.categoryTransformMap[t.document.categoryId])this._saveItemAs(t,e,i,s,this.categoryTransformMap[t.document.categoryId]);else{var a;a=(a=(a=this.publishableCategoryInfoObject_alias[t.document.categoryAlias]?n.copyConfirmCategoryInfor_hasSameAlias+"。<br/>"+n.copyConfirmCateogyrInfor_withChoice:this.publishableCategoryInfoObject_name[t.document.categoryName]?n.copyConfirmCategoryInfor_hasSameName+"。<br/>"+n.copyConfirmCateogyrInfor_withChoice:n.copyConfirmCategoryInfor_noCategory+"：").replace("{alias}","（<span style='color:red;'>"+t.document.categoryAlias+"</span>）")).replace("{name}","（<span style='color:red;'>"+t.document.categoryName+"</span>）");var c="<div style='overflow-y:auto;height:300px'>";c+="<div style='overflow: hidden; margin: 10px 0px; padding: 5px 10px; background-color: #ffffff; border-radius: 6px;'>",c+="\t<div style='clear: both;font-weight: bold; font-size:14px;'>"+n.copyTarget+" "+t.document.title+"</div>",c+="\t<div style='font-size:12px; color: #666666; float: left;'>"+t.document.publishTime+"</div>",c+="\t<div style='font-size:12px; color: #666666; float: left; margin-left: 20px;'>"+MWF.name.cn(t.document.creatorPersonShort)+"</div>",c+="</div>",c+="<div>"+a+"</div>"+this.categoryRadioHtml,c+="<div><input type='checkbox' value='true' name='useSameChoice'>"+n.copyConfirm_SameCategory+"</div>",c+="</div>",this.dlg("inofr",null,n.copyConfirmCategoryTitle,{html:c},500,360,[{text:n.copy,action:function(){for(var a,c=this.node.getElements("[name='categoryRadio']"),h=this.node.getElement("[name='useSameChoice']"),l=0;l<c.length;l++)c[l].checked&&(a=o.publishableCategoryInfoObject_id[c[l].get("value")]);a||(o.publishableCategoryInfoObject_alias[t.document.categoryAlias]?a=o.publishableCategoryInfoObject_alias[t.document.categoryAlias]:o.publishableCategoryInfoObject_name[t.document.categoryName]&&(a=o.publishableCategoryInfoObject_name[t.document.categoryName])),a?(h.checked&&(o.categoryTransformMap[t.document.categoryId]=a),this.close(),o._saveItemAs(t,e,i,s,a)):o.notice(n.notSelectCategory,"error")}},{text:n.copyConfirm_skip,action:function(){this.close(),e&&e()}},{text:n.copyConfirm_cancel,action:function(){this.close(),s&&s()}}])}},_saveItemAs:function(t,e,i,s,n){this.restActions.getDocument(t.document.id,function(o){var a=o.data,c=!1;if(a&&(n&&n.id!==a.document.categoryId?this.saveItemAsNew(t,e,i,!0,n):c=!0,c)){var h=this.lp,l=this,d=(new Date).parse(t.document.publishTime),r=(new Date).parse(a.document.publishTime),u="<div>"+h.copyConfirmInfor+"</div>";u+="<div style='overflow: hidden; margin: 10px 0px; padding: 5px 10px; background-color: #ffffff; border-radius: 6px;'><div style='font-weight: bold; font-size:14px;'>"+h.copySource+" "+a.document.title+"</div>",u+="<div style='font-size:12px; color: #666666; float: left'>"+a.document.publishTime+"</div><div style='font-size:12px; color: #666666; float: left; margin-left: 20px;'>"+MWF.name.cn(a.document.creatorPersonShort)+"</div><div style='color: red; float: right;'>"+(d>=r?"":h.copynew)+"</div></div>",u+="<div style='overflow: hidden; margin: 10px 0px; padding: 5px 10px; background-color: #ffffff; border-radius: 6px;'><div style='clear: both;font-weight: bold; font-size:14px;'>"+h.copyTarget+" "+t.document.title+"</div>",u+="<div style='font-size:12px; color: #666666; float: left;'>"+t.document.publishTime+"</div><div style='font-size:12px; color: #666666; float: left; margin-left: 20px;'>"+MWF.name.cn(t.document.creatorPersonShort)+"</div><div style='color: red; float: right;'>"+(d<=r?"":h.copynew)+"</div></div>",this.dlg("inofr",null,h.copyConfirmTitle,{html:u},500,290,[{text:h.copyConfirm_overwrite,action:function(){l.saveItemAsUpdate(a,t,e,i),this.close()}},{text:h.copyConfirm_new,action:function(){l.saveItemAsNew(t,e,i,!0,n),this.close()}},{text:h.copyConfirm_skip,action:function(){this.close(),e&&e()}},{text:h.copyConfirm_cancel,action:function(){this.close(),s&&s()}}])}}.bind(this),function(){this.saveItemAsNew(t,e,i,!1,n)}.bind(this))},saveItemAsUpdate:function(t,e,i,s){var n=e.document;n.id=t.document.id,n.isNewDocument=!1,n.appId=t.document.appId,n.appName=t.document.appName,n.categoryId=t.document.categoryId,n.categoryName=t.document.categoryName,n.categoryAlias=t.document.categoryAlias,n.form=t.document.form,n.formName=t.document.formName,n.readFormId=t.document.readFormId,n.readFormName=t.document.readFormName,n.docData=e.data,this.restActions.saveDocument(n,function(){i&&i()}.bind(this),function(){s&&s()}.bind(this))},saveItemAsNew:function(t,e,i,s,n){var o=this.columnData,a=t.document;s&&delete a.id,delete a.documentType,delete a.appId,delete a.appName,delete a.appAlias,delete a.categoryName,delete a.categoryAlias,delete a.form,delete a.formName,delete a.readFormId,delete a.readFormName,a.appId=o.id,a.docData=t.data,delete a.docData.$document;var c=function(t){this.restActions.publishDocumentComplex(t,function(){e&&e()}.bind(this),function(){i&&i()}.bind(this))}.bind(this);n?(a.categoryId=n.id,c(a)):this.restActions.getCategory(t.document.categoryId,function(e){e.data.appId===o.id?(a.categoryId=t.document.categoryId,c(a)):this.loadSelectCategoryDialog("选择"+t.document.title+"的分类",function(t){a.categoryId=t,c(a)}.bind(this))}.bind(this),function(){this.loadSelectCategoryDialog("选择"+t.document.title+"的分类",function(t){a.categoryId=t,c(a)}.bind(this))}.bind(this))},loadSelectColumnDialog:function(t){MWF.xDesktop.requireApp("Selector","package",null,!1);var e={type:"CMSCategory",count:1,onComplete:function(e){e.each(function(e){t&&t(e.data)}.bind(this))}.bind(this)};new MWF.O2Selector(this.content,e)},loadSelectCategoryDialog:function(t,e){this.categoryList||(this.categoryList=[],this.restActions.listCategory(this.columnData.id,function(t){t.data.each(function(t){this.categoryList.push({name:t.categoryName,id:t.id})}.bind(this))}.bind(this),null,!1)),MWF.xDesktop.requireApp("Template","Selector.Custom",null,!1);var i={count:1,title:"选择分类",selectableItems:this.categoryList,values:[],onComplete:function(t){if(t&&0!=t.length){var i=t[0].data.id;e(i)}}.bind(this)};new MWF.xApplication.Template.Selector.Custom(this.content,i).load()},loadImportActionNode:function(){this.importAction=new Element("div",{styles:this.css.importAction,text:this.lp.import}).inject(this.titleActionBar),this.importAction.setStyle("display","none"),this.importAction.addEvents({click:function(t){MWF.xDesktop.requireApp("cms.Module","ExcelForm",null,!1);var e=this.navi.currentObject.isCategory?this.navi.currentObject.data:this.navi.currentObject.category.data;this.import=new MWF.xApplication.cms.Module.ImportForm({app:this},e,{}),this.import.edit()}.bind(this),mouseover:function(t){this.importAction.setStyles(this.css.importAction_over)}.bind(this),mouseout:function(t){this.importAction.setStyles(this.css.importAction)}.bind(this)})},loadExportActionNode:function(){this.exportAction=new Element("div",{styles:this.css.exportAction,text:this.lp.export}).inject(this.titleActionBar),this.exportAction.setStyle("display","none"),this.exportAction.addEvents({click:function(t){MWF.xDesktop.requireApp("cms.Module","ExcelForm",null,!1);var e=this.navi.currentObject.isCategory?this.navi.currentObject.data:this.navi.currentObject.category.data;this.export=new MWF.xApplication.cms.Module.ExportForm({app:this},e,{}),this.export.edit()}.bind(this),mouseover:function(t){this.exportAction.setStyles(this.css.exportAction_over)}.bind(this),mouseout:function(t){this.exportAction.setStyles(this.css.exportAction)}.bind(this)})},loadTitleIconNode:function(){this.defaultColumnIcon="../x_component_cms_Index/$Main/"+this.options.style+"/icon/column.png";var t=this.iconAreaNode=new Element("div",{styles:this.css.titleIconAreaNode}).inject(this.leftTitleNode),e=this.iconNode=new Element("img",{styles:this.css.titleIconNode}).inject(t);this.columnData.appIcon?this.iconNode.set("src","data:image/png;base64,"+this.columnData.appIcon):this.iconNode.set("src",this.defaultColumnIcon),e.makeLnk({par:this._getLnkPar()})},_getLnkPar:function(){var t=this.defaultColumnIcon;this.columnData.appIcon&&(t="data:image/png;base64,"+this.columnData.appIcon);var e="cms.Module"+this.columnData.id;return{icon:t,title:this.columnData.appName,par:'cms.Module#{"columnId": "'+this.columnData.id+'", "appId": "'+e+'"}'}},loadTitleContentNode:function(){this.titleContentNode=new Element("div.titleContentNode",{styles:this.css.titleContentNode}).inject(this.leftTitleNode),this.titleTextNode=new Element("div.titleTextNode",{styles:this.css.titleTextNode,text:this.columnData.appName,title:this.columnData.appName}).inject(this.titleContentNode),this.titleDescriptionNode=new Element("div.titleDescriptionNode",{styles:this.css.titleDescriptionNode,text:this.columnData.description?this.columnData.description:this.lp.noDescription,title:this.columnData.description?this.columnData.description:this.lp.noDescription}).inject(this.titleContentNode)},loadSearchNode:function(){this.searchNode=new Element("div").inject(this.titleBar)},loadMenu:function(t){this.naviNode=new Element("div.naviNode",{styles:this.css.naviNode}).inject(this.naviContainerNode),MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.naviContainerNode,{style:"xApp_ProcessManager_StartMenu",distance:100,friction:4,axis:{x:!1,y:!0}})}.bind(this)),this.addEvent("resize",function(){this.setNaviSize()}.bind(this)),"all"==this.options.categoryId&&(this.options.categoryId="whole"),this.status&&this.status.categoryId?this._loadMenu(this.status):this.options.categoryId&&""!=this.options.categoryId?this.options.viewId&&""!=this.options.viewId?this._loadMenu({categoryId:this.options.categoryId,viewId:this.options.viewId}):this._loadMenu({categoryId:this.options.categoryId,isCategory:!0,naviIndex:this.options.naviIndex||0}):this.options.categoryAlias&&""!=this.options.categoryAlias?this.restActions.getCategoryByAlias(this.options.categoryAlias,function(t){this.options.categoryId=t.data.id,this.options.viewId&&""!=this.options.viewId?this._loadMenu({categoryId:this.options.categoryId,viewId:this.options.viewId}):this._loadMenu({categoryId:this.options.categoryId,isCategory:!0,naviIndex:this.options.naviIndex||0})}.bind(this)):this._loadMenu({categoryId:"whole"})},_loadMenu:function(t){this.navi=new MWF.xApplication.cms.Module.Navi(this,this.naviNode,this.columnData,t),this.setNaviSize()},clearContent:function(){this.moduleContent&&(this.view&&delete this.view,this.moduleContent.destroy(),this.searchNode.empty(),this.moduleContent=null)},openView:function(t,e,i,s,n){i&&"queryview"==i.type?this.loadQueryView(t,e,i,s,n):this.loadList(t,e,i,s,n)},loadQueryView:function(t,e,i,s,n){MWF.xDesktop.requireApp("cms.Module","ViewExplorer",function(){this.clearContent(),this.moduleContent=new Element("div",{styles:this.css.moduleContent}).inject(this.rightContentNode),this.view=new MWF.xApplication.cms.Module.ViewExplorer(this.moduleContent,this,this.columnData,e,i,{isAdmin:this.isAdmin,searchKey:s},this.searchNode),this.view.selectEnable=this.selectEnable,this.view.load()}.bind(this))},loadList:function(t,e,i,s,n){MWF.xDesktop.requireApp("cms.Module","ListExplorer",function(){this.clearContent(),this.moduleContent=new Element("div",{styles:this.css.moduleContent}).inject(this.rightContentNode),this.restActions||(this.restActions=MWF.Actions.get("x_cms_assemble_control")),this.view=new MWF.xApplication.cms.Module.ListExplorer(this.moduleContent,this.restActions,this.columnData,e,i,{isAdmin:this.isAdmin,searchKey:s},this.searchNode),this.view.app=this,this.view.selectEnable=this.selectEnable,this.view.load()}.bind(this))},recordStatus:function(){var t=this.navi.currentObject;if(t){var e=t.getCategoryId();return e?{columnId:this.columnData.id,categoryId:e,isCategory:t.isCategory,viewId:t.data.id}:{columnId:this.columnData.id,categoryId:"whole"}}return{columnId:this.columnData.id,categoryId:"whole"}},setNaviSize:function(){var t=this.node.getSize();this.naviContainerNode.setStyle("height",t.y+"px")}}),MWF.xApplication.cms.Module.Navi=new Class({Implements:[Options,Events],options:{categoryId:"",viewId:"",isCategory:!1,navi:-1},initialize:function(t,e,i,s){this.setOptions(s),this.app=t,this.node=$(e),this.columnData=i,this.categoryList=[],this.css=this.app.css,this.load()},load:function(){var t=("boolean"!==typeOf(this.columnData.showAllDocuments)||this.columnData.showAllDocuments).toString();"false"!==t&&(this.allView=new MWF.xApplication.cms.Module.NaviAllView(this,this.node,{})),!1===this.columnData.config.latest&&(this.draftView=new MWF.xApplication.cms.Module.NaviDraftView(this,this.node,{})),new Element("div",{styles:this.css.viewNaviBottom}).inject(this.node),this.app.restActions.listCategory(this.columnData.id,function(e){e.data.each(function(e,i){var s=new MWF.xApplication.cms.Module.NaviCategory(this,this.node,e,{});this.categoryList.push(s),"false"==t&&0===i&&s.setCurrent(),this.fireEvent("postLoad")}.bind(this))}.bind(this))}}),MWF.xApplication.cms.Module.NaviCategory=new Class({Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i,s){this.setOptions(s),this.navi=t,this.app=t.app,this.container=$(e),this.data=i,this.css=this.app.css,this.load()},load:function(){var t=this;this.isCategory=!0,this.isCurrent=!1,this.isExpended=!1,this.hasSub=!1,this.naviViewList=[],this.navi.options.categoryId==this.data.id&&this.navi.options.isCategory&&(this.isCurrent=!0),this.reveal=this.getRevealData(),this.node=new Element("div.categoryNaviNode",{styles:this.css.categoryNaviNode}).inject(this.container),this.expendNode=new Element("div.expendNode").inject(this.node),this.setExpendNodeStyle(),this.hasSub&&this.expendNode.addEvent("click",function(t){this.triggerExpend(),t.stopPropagation()}.bind(this)),this.textNode=new Element("div.categoryNaviTextNode",{styles:this.css.categoryNaviTextNode,text:this.data.name}).inject(this.node),this.node.addEvents({mouseover:function(){t.isCurrent||this.setStyles(t.app.css.categoryNaviNode_over)},mouseout:function(){t.isCurrent||this.setStyles(t.app.css.categoryNaviNode)},click:function(){t.setCurrent(this)}}),this.listNode=new Element("div.viewNaviListNode",{styles:this.css.viewNaviListNode}).inject(this.container),this.loadListContent(),this.isCurrent&&this.setCurrent()},getRevealData:function(){var t=this.data.extContent;t&&(this.extContent=JSON.parse(t)),this.extContent&&this.extContent.reveal&&0!=this.extContent.reveal.length||(this.extContent={reveal:[]},this.app.restActions.listViewByCategory(this.data.id,function(t){(t.data||[]).each(function(t){var e={type:"list",name:t.name,showName:t.name,id:t.id,alias:t.alias,appId:t.appId,formId:t.formId,formName:t.formName};this.extContent.reveal.push(e)}.bind(this))}.bind(this),null,!1)),this.extContent.reveal.each(function(t,e){this.data.defaultViewName&&t.id==this.data.defaultViewName?this.defaultRevealData=t:e>0&&(this.isExpended=!0,this.hasSub=!0)}.bind(this)),this.extContent&&this.extContent.reveal&&0!=this.extContent.reveal.length||(this.extContent={reveal:[{id:"defaultList",showName:"系统列表",name:"系统列表"}]}),this.revealData=this.extContent.reveal,this.defaultRevealData||(this.defaultRevealData={id:"defaultList",showName:"系统列表",name:"系统列表"})},setExpendNodeStyle:function(){var t;t=this.hasSub?this.isExpended?this.isCurrent?this.css.categoryExpendNode_selected:this.css.categoryExpendNode:this.isCurrent?this.css.categoryCollapseNode_selected:this.css.categoryCollapseNode:this.css.emptyExpendNode,this.expendNode.setStyles(t)},triggerExpend:function(){this.hasSub&&(this.isExpended?(this.isExpended=!1,this.listNode.setStyle("display","none")):(this.isExpended=!0,this.listNode.setStyle("display","")),this.setExpendNodeStyle())},setCurrent:function(){this.navi.currentObject&&this.navi.currentObject.cancelCurrent(),this.node.setStyles(this.css.categoryNaviNode_selected),this.hasSub&&(this.isExpended?this.expendNode.setStyles(this.css.categoryExpendNode_selected):this.expendNode.setStyles(this.css.categoryCollapseNode_selected)),this.isCurrent=!0,this.navi.currentObject=this;var t=this.app.importAction;t&&t.setStyle("display",this.data.importViewId&&this.app.isAdmin?"":"none"),(t=this.app.exportAction)&&t.setStyle("display",this.data.importViewId&&this.app.isAdmin?"":"none"),this.loadView()},cancelCurrent:function(){this.isCurrent=!1,this.node.setStyles(this.css.categoryNaviNode),this.hasSub&&(this.isExpended?this.expendNode.setStyles(this.css.categoryExpendNode):this.expendNode.setStyles(this.css.categoryCollapseNode))},loadView:function(t){this.app.openView(this,this.data,this.viewData||this.defaultRevealData,t||"",this)},loadListContent:function(){this.revealData.each(function(t,e){if(t.id!=this.defaultRevealData.id){var i=new MWF.xApplication.cms.Module.NaviView(this.navi,this,this.listNode,t,{style:this.options.style,index:e});this.naviViewList.push(i)}}.bind(this)),new Element("div",{styles:this.css.viewNaviSepartorNode}).inject(this.listNode)},getCategoryId:function(){return this.data.id}}),MWF.xApplication.cms.Module.NaviView=new Class({Implements:[Options,Events],options:{style:"default",index:0},initialize:function(t,e,i,s,n){this.setOptions(n),this.navi=t,this.category=e,this.app=t.app,this.data=s,this.container=$(i),this.css=this.app.css,this.load()},load:function(){this.isDefault="defaultList"==this.data.id,this.isCurrent=!1,this.isCategory=!1,this.navi.options.categoryId!=this.category.data.id||this.navi.options.isCategory||("defaultList"==this.navi.options.viewId&&this.isDefault||this.navi.options.viewId==this.data.id||this.navi.options.naviIndex==this.options.index)&&(this.isCurrent=!0);var t=this;this.node=new Element("div.viewNaviNode",{styles:this.css.viewNaviNode,text:this.isDefault&&!this.data.showName?this.app.lp.defaultView:this.data.showName}).inject(this.container),this.node.addEvents({mouseover:function(){t.isCurrent||this.setStyles(t.css.viewNaviNode_over)},mouseout:function(){t.isCurrent||this.setStyles(t.css.viewNaviNode)},click:function(e){t.setCurrent()}}),this.isCurrent&&this.setCurrent()},setCurrent:function(){this.navi.currentObject&&this.navi.currentObject.cancelCurrent(),this.node.setStyles(this.css.viewNaviNode_selected),this.isCurrent=!0,this.navi.currentObject=this;var t=this.app.importAction;t&&t.setStyle("display",this.category.data.importViewId&&this.app.isAdmin?"":"none"),(t=this.app.exportAction)&&t.setStyle("display",this.category.data.importViewId&&this.app.isAdmin?"":"none"),this.loadView()},cancelCurrent:function(){this.isCurrent=!1,this.node.setStyles(this.css.viewNaviNode)},getCategoryId:function(){return this.category.data.id},loadView:function(t){this.app.openView(this,this.category.data,this.data,t||"",this)}}),MWF.xApplication.cms.Module.NaviAllView=new Class({Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i){this.setOptions(i),this.navi=t,this.app=t.app,this.container=$(e),this.css=this.app.css,this.data={isAll:!0,id:"defaultList"},this.load()},load:function(){var t=this;this.isDefault=!0,this.isAll=!0,this.isCurrent=!1,this.isCategory=!1,"whole"==this.navi.options.categoryId&&(this.isCurrent=!0),this.listNode=new Element("div.viewNaviListNode_all",{styles:this.css.viewNaviListNode_all}).inject(this.container),this.node=new Element("div.viewNaviNode_all",{styles:this.css.viewNaviNode_all,text:this.app.lp.allDocument}).inject(this.listNode),this.node.addEvents({mouseover:function(){t.isCurrent||this.setStyles(t.css.viewNaviNode_all_over)},mouseout:function(){t.isCurrent||this.setStyles(t.css.viewNaviNode_all)},click:function(e){t.setCurrent()}}),new Element("div",{styles:this.css.viewNaviSepartorNode}).inject(this.listNode),this.isCurrent&&this.setCurrent()},setCurrent:function(){var t;this.navi.currentObject&&this.navi.currentObject.cancelCurrent(),this.node.setStyles(this.css.viewNaviNode_all_selected),this.isCurrent=!0,this.navi.currentObject=this,(t=this.app.importAction)&&t.setStyle("display","none"),(t=this.app.exportAction)&&t.setStyle("display","none"),this.loadView()},cancelCurrent:function(){this.isCurrent=!1,this.node.setStyles(this.css.viewNaviNode_all)},getCategoryId:function(){return null},loadView:function(t){this.app.openView(this,null,this.data,t||"",this)}}),MWF.xApplication.cms.Module.NaviDraftView=new Class({Implements:[Options,Events],options:{style:"default"},initialize:function(t,e,i){this.setOptions(i),this.navi=t,this.app=t.app,this.container=$(e),this.css=this.app.css,this.data={isDraft:!0,id:"defaultList"},this.load()},load:function(){var t=this;this.isDefault=!0,this.isAll=!0,this.isCurrent=!1,this.isCategory=!1,this.listNode=new Element("div.viewNaviListNode_all",{styles:this.css.viewNaviListNode_all}).inject(this.container),this.node=new Element("div.viewNaviNode_all",{styles:this.css.viewNaviNode_all,text:this.app.lp.draftStatus}).inject(this.listNode),this.node.addEvents({mouseover:function(){t.isCurrent||this.setStyles(t.css.viewNaviNode_all_over)},mouseout:function(){t.isCurrent||this.setStyles(t.css.viewNaviNode_all)},click:function(e){t.setCurrent()}}),new Element("div",{styles:this.css.viewNaviSepartorNode}).inject(this.listNode),this.isCurrent&&this.setCurrent()},setCurrent:function(){var t;this.navi.currentObject&&this.navi.currentObject.cancelCurrent(),this.node.setStyles(this.css.viewNaviNode_all_selected),this.isCurrent=!0,this.navi.currentObject=this,(t=this.app.importAction)&&t.setStyle("display","none"),(t=this.app.exportAction)&&t.setStyle("display","none"),this.loadView()},cancelCurrent:function(){this.isCurrent=!1,this.node.setStyles(this.css.viewNaviNode_all)},getCategoryId:function(){return null},loadView:function(t){this.app.openView(this,null,this.data,t||"",this)}});