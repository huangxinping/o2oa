layout=window.layout||{},layout.desktop=layout,layout.desktop.type="app";var locate=window.location;layout.protocol=locate.protocol,layout.inBrowser=!0,layout.session=layout.session||{},layout.debugger=-1!==locate.href.toString().indexOf("debugger"),layout.anonymous=-1!==locate.href.toString().indexOf("anonymous"),o2.xApplication=o2.xApplication||{},o2.xDesktop=o2.xDesktop||{},o2.xDesktop.requireApp=function(o,e,t,n){o2.requireApp(o,e,t,n)},function(o){o.readys=[],o.addReady=function(){for(var e=0;e<arguments.length;e++)"function"===o2.typeOf(arguments[e])&&(o.isReady?arguments[e].apply(window):o.readys.push(arguments[e]))};var e=function(e){(function(o){return!(!window.o2android||!window.o2android.openO2Work)&&(o.workId?window.o2android.openO2Work(o.workId,"",o.title||o.docTitle||""):o.workCompletedId&&window.o2android.openO2Work("",o.workCompletedId,o.title||o.docTitle||""),!0)})(e)||function(o){return!!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Work)&&(o.workId?window.webkit.messageHandlers.openO2Work.postMessage({work:o.workId,workCompleted:"",title:o.title||o.docTitle||""}):o.workCompletedId&&window.webkit.messageHandlers.openO2Work.postMessage({work:"",workCompleted:o.workCompletedId,title:o.title||o.docTitle||""}),!0)}(e)||function(e){var t=new URI(window.location.href).getData("redirectlink");t=t?encodeURIComponent(t):encodeURIComponent(locate.pathname+locate.search);var n="../x_desktop/workmobilewithaction.html".toURI();e.draft?n="../x_desktop/workmobilewithaction.html?"+("draft="+encodeURIComponent(JSON.stringify(e.draft))):n=n.setData(e).toString();var i=e.jobid||e.jobId||e.job;i&&(n+=(-1!=n.indexOf("?")?"&":"?")+"jobid="+i),n+=t?"&redirectlink="+t:"",n+=o.debugger?"&debugger":"",window.location=o2.filterUrl(n)}(e)},t=function(t,n,i){switch(t){case"process.Work":e(n);break;case"cms.Document":!function(e,t,n){var i="object"===typeOf(t)?t.docTitle||t.title:"";i=i||"";var a="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):"");window.o2android&&window.o2android.openO2CmsDocument?window.o2android.openO2CmsDocument(t.documentId,i):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2CmsDocument?window.webkit.messageHandlers.openO2CmsDocument.postMessage({docId:t.documentId,docTitle:i}):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+a+(o.debugger?"&debugger":""))}(t,n,i);break;case"cms.Module":!function(e,t,n){var i="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):"");window.o2android&&window.o2android.openO2CmsApplication?window.o2android.openO2CmsApplication(t.columnId,t.title||""):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2CmsApplication?window.webkit.messageHandlers.openO2CmsApplication.postMessage(t.columnId):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+i+(o.debugger?"&debugger":""))}(t,n,i);break;case"Meeting":!function(e,t,n){var i="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):"");window.o2android&&window.o2android.openO2Meeting?window.o2android.openO2Meeting(""):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Meeting?window.webkit.messageHandlers.openO2Meeting.postMessage(""):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+i+(o.debugger?"&debugger":""))}(t,n,i);break;case"Calendar":!function(e,t,n){var i="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):"");window.o2android&&window.o2android.openO2Calendar?window.o2android.openO2Calendar(""):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2Calendar?window.webkit.messageHandlers.openO2Calendar.postMessage(""):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+i+(o.debugger?"&debugger":""))}(t,n,i);break;case"process.TaskCenter":!function(e,t,n){var i="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):""),a=(t&&t.navi?t.navi:"task").toLowerCase();"done"===a&&(a="taskCompleted"),"readed"===a&&(a="readCompleted"),window.o2android&&window.o2android.openO2WorkSpace?window.o2android.openO2WorkSpace(a):window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.openO2WorkSpace?window.webkit.messageHandlers.openO2WorkSpace.postMessage(a):window.location=o2.filterUrl("../x_desktop/appMobile.html?"+i+(o.debugger?"&debugger":""))}(t,n,i);break;default:var a=new URI(window.location.href),s=a.getData("option"),d=a.getData("status");window.location=o2.filterUrl("../x_desktop/appMobile.html?app="+t+"&option="+(s||"")+"&status="+(d||"")+(o.debugger?"&debugger":""))}};o.openApplication=function(e,n,i,a,s,d,p){if("@url"===n.substring(0,4)){var r=n.replace(/\@url\:/i,""),l=new Element("a",{href:r,target:"_blank"});return l.click(),l.destroy(),l=null,!0}if(o.app){if(!o.mobile)return function(e,t,n){t&&delete t.docTitle;var i="app="+encodeURIComponent(e)+"&status="+encodeURIComponent(n?JSON.encode(n):"")+"&option="+encodeURIComponent(t?JSON.encode(t):"");switch(e){case"process.Work":var a="../x_desktop/work.html".toURI();a=t.draft?"../x_desktop/app.html?"+i:a.setData(t).toString();var s=t.jobid||t.jobId||t.job;return s&&(a+=(-1!=a.indexOf("?")?"&":"?")+"jobid="+s),a+=o.debugger?"&debugger":"",o.app.$openWithSelf?window.location=o2.filterUrl(a):window.open(o2.filterUrl(a),i);case"cms.Document":return a=(a="../x_desktop/cmsdoc.html".toURI()).setData(t).toString(),a+=o.debugger?"&debugger":"",o.app.$openWithSelf?window.location=o2.filterUrl(a):window.open(o2.filterUrl(a),i);default:return o.app.$openWithSelf?window.location=o2.filterUrl("../x_desktop/app.html?"+i+(o.debugger?"&debugger":"")):window.open(o2.filterUrl("../x_desktop/app.html?"+i+(o.debugger?"&debugger":"")),i)}}(n,i,a);t(n,i,a)}else{var c=n.split("."),u=c[c.length-1];!function(o,e,t){var n=o.split("."),i=o2.xApplication;n.each(function(o,e){e<n.length-1?i[o]=i[o]||{}:i[o]=i[o]||{options:Object.clone(o2.xApplication.Common.options)},i=i[o]}.bind(this)),i.options||(i.options=Object.clone(o2.xApplication.Common.options));o2.xDesktop.requireApp(o,"lp."+o2.language,{onFailure:function(){o2.xDesktop.requireApp(o,"lp.zh-cn",null,!1)}.bind(this)},!1),o2.xDesktop.requireApp(o,t,(function(){e&&e(i)}))}(n,function(t){var n=i&&i.appId?i.appId:t.options.multitask?"":u;n&&o.desktop.apps&&o.desktop.apps[n]?o.desktop.apps[n].setCurrent():(i&&(i.appId=n),function(e,t,n,i,a,s,d,p){i?i.event=e:i={event:e};var r=new t.Main(o.desktop,i);if(r.desktop=o.desktop,r.status=a,r.inBrowser=!(!s&&!o.inBrowser),"layout"===o.desktop.type){if(r.appId=i.appId?i.appId:t.options.multitask?n+"-"+new o2.widget.UUID:n,r.options.appId=r.appId,o.desktop.createTaskItem&&(d||(d=o.desktop.createTaskItem(r)),r.taskitem=d,r.taskitem.app=r),r.isLoadApplication=!0,r.load(!p),o.desktop.apps||(o.desktop.apps={}),o.desktop.apps[r.appId])o.desktop.apps[r.appId];else o.desktop.apps[r.appId]=r;o.desktop.appArr.push(r),o.desktop.appCurrentList.push(r),p||(o.desktop.currentApp=r)}else r.load(!0),o.app=r;var l=document.getElementById("appContentMask");l&&l.destroy()}(e,t,u,i||{appId:n},a,s,d,p))}.bind(this))}},o.refreshApp=function(e){var t=e.recordStatus(),n=new URI(window.location.href),i=n.getData("app"),a=n.getData("option"),s=n.getData("status");t&&(s=JSON.encode(t));var d=n.get("port");window.location=o2.filterUrl(n.get("scheme")+"://"+n.get("host")+(d?":"+d+"/":"")+n.get("directory ")+"?app="+encodeURIComponent(i)+"&status="+encodeURIComponent(s)+"&option="+encodeURIComponent(a?JSON.encode(a):"")+(o.debugger?"&debugger":""))},o.load=function(e,t,n){o.apps=[],o.node=$("layout");var i=e,a=n,s=t,d=window.opener;if(d)try{i||(i=d.layout.desktop.openBrowserApp),a||(a=d.layout.desktop.openBrowserStatus),s||(s=d.layout.desktop.openBrowserOption)}catch(o){}o.openApplication(null,i,s||{},a)}}(layout),o2.addReady((function(){window.Element&&Element.implement({makeLnk:function(o){}}),layout.desktop.addEvent=function(o,e,t){window.addEvent(o,e,t)},layout.desktop.addEvents=function(o){window.addEvents(o)};var o=window.$?$("loaddingArea"):null,e=0,t=window.document&&document.body?document.body.getSize():null,n=function(){o&&(o.destroy(),o=null)},i=function(i){if(o)if(i)o.setStyles({width:t.x+"px"}),window.setTimeout(n,500);else{var a=++e/4*t.x;o.setStyles({width:a+"px"}),e>=4&&window.setTimeout(n,500)}},a=function(o,e){layout.serviceAddressList=o,layout.centerServer=e,layout.desktop.serviceAddressList=o,layout.desktop.centerServer=e},s=function(o){if("auto"===layout.config.app_protocol&&(layout.config.app_protocol=window.location.protocol),layout.config.configMapping&&(layout.config.configMapping[window.location.host]||layout.config.configMapping[window.location.hostname])){var e=layout.config.configMapping[window.location.host]||layout.config.configMapping[window.location.hostname];e.servers?(layout.serviceAddressList=e.servers,layout.desktop.serviceAddressList=e.servers,e.center&&(center="array"===o2.typeOf(e.center)?e.center[0]:e.center),layout.centerServer=center,layout.desktop.centerServer=center,o&&o()):(e.center&&(layout.config.center="array"===o2.typeOf(e.center)?e.center:[e.center]),o2.xDesktop.getServiceAddress(layout.config,function(e,t){a(e,t),i(),o&&o()}.bind(this)))}else o2.xDesktop.getServiceAddress(layout.config,function(e,t){a(e,t),i(),o&&o()}.bind(this))},d=function(){var o=new URI(window.location.href).get("data");if(o["x-token"]){Cookie.dispose("x-token");var e=window.location.host,t=null;/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(e)?t=e:e.indexOf(".")>0&&(t=e.substring(e.indexOf("."))),t?Cookie.write("x-token",o["x-token"],{domain:t,path:"/"}):Cookie.write("x-token",o["x-token"])}layout.sessionPromise=new Promise((function(o,e){o2.Actions.get("x_organization_assemble_authentication").getAuthentication(function(e){o&&o(e.data)}.bind(this),function(o,t,n){e&&e({xhr:o,text:t,error:n})}.bind(this))})),layout.sessionPromise.then((function(o){layout.user=o,layout.session=layout.session||{},layout.session.user=o,layout.session.token=o.token,layout.desktop.session=layout.session}),(function(){if(layout.anonymous){var o={name:"anonymous",roleList:[]};layout.user=o,layout.session=layout.session||{},layout.session.user=o,layout.session.token=o.token,layout.desktop.session=layout.session}else i(!0),layout.yqwx?layout.openLoginQywx():layout.openLogin()})),function(o){for(o&&(layout.user=o.data,layout.session=layout.session||{},layout.session.user=o.data,layout.session.token=o.data.token,layout.desktop.session=layout.session),i(!0),layout.isReady=!0;layout.readys&&layout.readys.length;)layout.readys.shift().apply(window)}(),layout.openLogin=function(){layout.desktop.type="app",layout.app=null;var o=$("appContent")||$("layout");o&&o.empty(),layout.authentication=new o2.xDesktop.Authentication({style:"flat",onLogin:d.bind(layout)}),layout.authentication.loadLogin(document.body);var e=$("browser_loading");e&&e.fade("out")},layout.openLoginQywx=function(){console.log("开始login。。。。。。。。。。。。。");var o=locate.href.toURI();console.log("执行单点。。。。。。。。。。");var e=new MWF.xDesktop.Actions.RestActions("","x_organization_assemble_authentication","");e.getActions=function(o){this.actions={sso:{uri:"/jaxrs/qiyeweixin/code/{code}",method:"GET"}},o&&o()},e.invoke({name:"sso",async:!0,parameter:{code:o.getData("code")},success:function(o){console.log("单点成功。"),console.log(o),layout.session.user=o.data,d()}.bind(this),failure:function(o,e,t){var n=document.getElementById("loaddingArea");n&&n.destroy(),document.id("layout").set("html","<div>企业微信单点异常！</div>")}.bind(this)})}};layout.config=null;var p=!1,r=!1,l=!1,c=o2.session.path+"/lp/"+o2.language+".js";o2.session.isDebugger&&(o2.session.isMobile||layout.mobile)&&o2.load("../o2_lib/eruda/eruda.js");var u=function(){i(),r=!0;o2.require(["o2.xDesktop.$all"],{onSuccess:function(){l=!0,p&&l&&r&&s((function(){d()}))},onEvery:function(){i()}})};o2.LP?u():o2.load(c,u),o2.getJSON("../x_desktop/res/config/config.json",(function(o){i(),layout.config=o,(p=!0)&&l&&r&&s((function(){d()}))}))}));
//# sourceMappingURL=base.min.js.map
