o2.addReady((function(){window.Element&&Element.implement({makeLnk:function(o){}}),layout.desktop.addEvent=function(o,t,e){window.addEvent(o,t,e)},layout.desktop.addEvents=function(o){window.addEvents(o)};var o=window.$?$("loaddingArea"):null,t=0,e=window.document&&document.body?document.body.getSize():null,n=function(){o&&(o.destroy(),o=null)},s=function(s){if(o)if(s)o.setStyles({width:e.x+"px"}),window.setTimeout(n,500);else{var i=++t/4*e.x;o.setStyles({width:i+"px"}),t>=4&&window.setTimeout(n,500)}},i=function(o,t){layout.serviceAddressList=o,layout.centerServer=t,layout.desktop.serviceAddressList=o,layout.desktop.centerServer=t},a=function(o){if("auto"===layout.config.app_protocol&&(layout.config.app_protocol=window.location.protocol),layout.config.configMapping&&(layout.config.configMapping[window.location.host]||layout.config.configMapping[window.location.hostname])){var t=layout.config.configMapping[window.location.host]||layout.config.configMapping[window.location.hostname];t.servers?(layout.serviceAddressList=t.servers,layout.desktop.serviceAddressList=t.servers,t.center&&(center="array"===o2.typeOf(t.center)?t.center[0]:t.center),layout.centerServer=center,layout.desktop.centerServer=center,o&&o()):(t.center&&(layout.config.center="array"===o2.typeOf(t.center)?t.center:[t.center]),o2.xDesktop.getServiceAddress(layout.config,function(t,e){i(t,e),s(),o&&o()}.bind(this)))}else o2.xDesktop.getServiceAddress(layout.config,function(t,e){i(t,e),s(),o&&o()}.bind(this))},u=function(){var o=new URI(window.location.href).get("data");if(o["x-token"]){Cookie.dispose("x-token");var t=window.location.host,e=null;/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(t)?e=t:t.indexOf(".")>0&&(e=t.substring(t.indexOf("."))),e?Cookie.write("x-token",o["x-token"],{domain:e,path:"/"}):Cookie.write("x-token",o["x-token"])}layout.sessionPromise=new Promise((function(o,t){o2.Actions.get("x_organization_assemble_authentication").getAuthentication(function(t){o&&o(t.data)}.bind(this),function(o,e,n){t&&t({xhr:o,text:e,error:n})}.bind(this))})),layout.sessionPromise.then((function(o){layout.user=o,layout.session=layout.session||{},layout.session.user=o,layout.session.token=o.token,layout.desktop.session=layout.session}),(function(){if(layout.anonymous){var o={name:"anonymous",roleList:[]};layout.user=o,layout.session=layout.session||{},layout.session.user=o,layout.session.token=o.token,layout.desktop.session=layout.session}else s(!0),layout.yqwx?layout.openLoginQywx():layout.openLogin()})),function(o){for(o&&(layout.user=o.data,layout.session=layout.session||{},layout.session.user=o.data,layout.session.token=o.data.token,layout.desktop.session=layout.session),s(!0),layout.isReady=!0;layout.readys&&layout.readys.length;)layout.readys.shift().apply(window)}(),layout.openLogin=function(){layout.desktop.type="app",layout.app=null;var o=$("appContent")||$("layout");o&&o.empty(),layout.authentication=new o2.xDesktop.Authentication({style:"flat",onLogin:u.bind(layout)}),layout.authentication.loadLogin(document.body);var t=$("browser_loading");t&&t.fade("out")},layout.openLoginQywx=function(){console.log("开始login。。。。。。。。。。。。。");var o=locate.href.toURI();console.log("执行单点。。。。。。。。。。");var t=new MWF.xDesktop.Actions.RestActions("","x_organization_assemble_authentication","");t.getActions=function(o){this.actions={sso:{uri:"/jaxrs/qiyeweixin/code/{code}",method:"GET"}},o&&o()},t.invoke({name:"sso",async:!0,parameter:{code:o.getData("code")},success:function(o){console.log("单点成功。"),console.log(o),layout.session.user=o.data,u()}.bind(this),failure:function(o,t,e){var n=document.getElementById("loaddingArea");n&&n.destroy(),document.id("layout").set("html","<div>企业微信单点异常！</div>")}.bind(this)})}};layout.config=null;var l=!1,d=!1,c=!1,r=o2.session.path+"/lp/"+o2.language+".js";o2.session.isDebugger&&(o2.session.isMobile||layout.mobile)&&o2.load("../o2_lib/eruda/eruda.js");var y=function(){s(),d=!0;o2.require(["o2.xDesktop.$all"],{onSuccess:function(){c=!0,l&&c&&d&&a((function(){u()}))},onEvery:function(){s()}})};o2.LP?y():o2.load(r,y),o2.getJSON("../x_desktop/res/config/config.json",(function(o){s(),layout.config=o,(l=!0)&&c&&d&&a((function(){u()}))}))}));