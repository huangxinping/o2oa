MWF.xApplication.Profile.options.multitask=!1,MWF.xApplication.Profile.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"newVersion",name:"Profile",icon:"icon.png",width:"1100",height:"820",isResize:!1,isMax:!1,mvcStyle:"style.css",title:MWF.xApplication.Profile.LP.title},_loadCss:function(){},loadCss:function(t,e){var o=t&&"string"===typeOf(t)?t:"style.css",i=t&&"function"===typeOf(t)?t:e,n=this.path+this.options.style+"/"+o;this.content.loadCss(n,i)},onQueryLoad:function(){this.lp=MWF.xApplication.Profile.LP,this.action=MWF.Actions.get("x_organization_assemble_personal"),MWF.xDesktop.requireApp("Profile","Common",null,!1)},loadApplication:function(t){this.action.getPerson(function(t){this.personData=t.data,this.personData.personIcon=this.action.getPersonIcon(),this.content.loadHtml(this.path+this.options.style+"/"+(this.inBrowser||"Default"==layout.viewMode?"viewBrowser":"view")+".html",{bind:{data:this.personData,lp:this.lp},module:this},function(){this.loadContent()}.bind(this))}.bind(this)),t&&t()},loadContent:function(){var t=this.content.getElements(".o2_profile_configNode");this.contentNode=this.content.getElement(".o2_profile_contentNode"),MWF.require("MWF.widget.Tab",function(){this.tab=new MWF.widget.Tab(this.contentNode,{style:"profileV2"}),this.tab.load(),t.each(function(t){this.tab.addTab(t,t.get("title"))}.bind(this)),this.contentNode.getElement("[name=MWFcontentNodeContainer]").setStyles({height:"calc(100% - 50px)",overflow:"auto"}),this.tab.pages.map(function(t){var e=t.tabNode;e.addEvent("click",function(){this.addClass("mainColor_border"),this.getChildren().addClass("mainColor_color"),this.getSiblings().removeClass("mainColor_border"),this.getSiblings().map((function(t){t.getChildren().removeClass("mainColor_color")}))}.bind(e))}.bind(this)),this.options.tab?(this.tab.pages[this.options.tab].showIm(),this.tab.pages[this.options.tab].tabNode.addClass("mainColor_border"),this.tab.pages[this.options.tab].textNode.addClass("mainColor_color")):(this.tab.pages[0].showIm(),this.tab.pages[0].tabNode.addClass("mainColor_border"),this.tab.pages[0].textNode.addClass("mainColor_color")),this.loadInforConfigActions(),this.inBrowser||"Layout"!=layout.viewMode||this.loadLayoutConfigActions(),this.loadIdeaConfigActions(),this.loadEmPowerConfigAction(),this.loadPasswordConfigActions(),this.loadSSOConfigAction()}.bind(this))},openFaceSet:function(){layout.openApplication(null,"FaceSet")},loadInforConfigActions:function(){this.contentImgNode=this.content.getElement(".o2_profile_inforIconContentImg"),this.content.getElement(".o2_profile_inforIconChange").addClass("mainColor_color mainColor_border").addEvent("click",function(){this.changeIcon()}.bind(this));var t=this.tab.pages[0].contentNode.getElements("input");t.addEvent("focus",(function(){this.addClass("mainColor_border mainColor_color")})).addEvent("blur",(function(){this.removeClass("mainColor_border mainColor_color")})),this.mailInputNode=t[0],this.mobileInputNode=t[1],this.officePhoneInputNode=t[2],this.weixinInputNode=t[3],this.qqInputNode=t[4],this.ipAddressInputNode=t[5],this.signatureInputNode=this.tab.pages[0].contentNode.getElement("textarea"),this.signatureInputNode.addEvent("focus",(function(){this.addClass("mainColor_border mainColor_color")})).addEvent("blur",(function(){this.removeClass("mainColor_border mainColor_color")})),this.content.getElement(".o2_profile_saveInforAction").addEvent("click",function(){this.savePersonInfor()}.bind(this))},loadLayoutConfigActions:function(){var t=this.tab.pages[1].contentNode.getElements(".o2_profile_layoutClearDataAction");this.clearDataAction=t[0],this.defaultDataAction=t.length>1?t[1]:null,this.clearDefaultDataAction=t.length>2?t[2]:null,this.forceDataAction=t.length>3?t[3]:null,this.deleteForceDataAction=t.length>4?t[4]:null,this.clearDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){MWF.UD.deleteData("layout",function(){this.notice(this.lp.clearok,"success"),this.desktop.notRecordStatus=!0}.bind(this))}.bind(this))}.bind(this)),MWF.AC.isAdministrator()&&(this.defaultDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var t=this.lp.setDefaultOk;this.close();var e=layout.desktop.getLayoutStatusData();MWF.UD.putPublicData("defaultLayout",e,function(){MWF.xDesktop.notice("success",{x:"right",y:"top"},t,layout.desktop.desktopNode)}.bind(this))}.bind(this))}.bind(this)),this.clearDefaultDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){MWF.UD.deletePublicData("defaultLayout",function(){this.notice(this.lp.clearok,"success"),this.desktop.notRecordStatus=!0}.bind(this))}.bind(this))}.bind(this)),this.forceDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var t=this.lp.setForceOk;this.close();var e=layout.desktop.getLayoutStatusData();MWF.UD.putPublicData("forceLayout",e,function(){MWF.xDesktop.notice("success",{x:"right",y:"top"},t,layout.desktop.desktopNode)}.bind(this))}.bind(this))}.bind(this)),this.deleteForceDataAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){MWF.UD.deletePublicData("forceLayout",function(){this.notice(this.lp.clearok,"success"),this.desktop.notRecordStatus=!0}.bind(this))}.bind(this))}.bind(this)));var e=this.tab.pages[1].contentNode.getLast();this.loadDesktopBackground(e)},loadIdeaConfigActions:function(){var t=this.inBrowser||"Default"==layout.viewMode?1:2;this.ideasArea=this.tab.pages[t].contentNode.setStyle("min-height","500px").getElement("textarea").addEvent("focus",(function(){this.addClass("mainColor_border mainColor_color")})).addEvent("blur",(function(){this.removeClass("mainColor_border mainColor_color")})),this.ideasSaveAction=this.ideasArea.getNext().addEvent("mouseover",(function(){this.addClass("mainColor_bg")})).addEvent("mouseout",(function(){this.removeClass("mainColor_bg")})),this.ideasSaveDefaultAction=this.ideasSaveAction.getNext()||null,MWF.AC.isAdministrator()&&(this.ideasSaveDefaultAction.addEvent("mouseover",(function(){this.addClass("mainColor_bg")})).addEvent("mouseout",(function(){this.removeClass("mainColor_bg")})),this.ideasSaveDefaultAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var t={};t.ideas=this.ideasArea.get("value").split("\n"),MWF.UD.putPublicData("idea",t,function(){this.notice(this.lp.ideaSaveOk,"success")}.bind(this))}.bind(this))}.bind(this))),MWF.require("MWF.widget.UUID",function(){MWF.UD.getDataJson("idea",function(t){t&&t.ideas&&this.ideasArea.set("value",t.ideas.join("\n"))}.bind(this))}.bind(this)),this.ideasSaveAction.addEvent("click",function(){MWF.require("MWF.widget.UUID",function(){var t={};t.ideas=this.ideasArea.get("value").split("\n"),MWF.UD.putData("idea",t,function(){this.notice(this.lp.ideaSaveOk,"success")}.bind(this))}.bind(this))}.bind(this))},loadEmPowerConfigAction:function(){var t=this.inBrowser||"Default"==layout.viewMode?2:3;this.tab.pages[t].contentNode.setStyle("overflow","auto");var e=this.tab.pages[t].contentNode.getElements("div.o2_profile_emPower_tab");this.emPowerContentNode=this.tab.pages[t].contentNode.getElement("div.o2_profile_emPower_content"),MWF.require("MWF.widget.Tab",function(){this.tabEmpower=new MWF.widget.Tab(this.emPowerContentNode,{style:"empower"}),this.tabEmpower.load(),e.each(function(t){this.tabEmpower.addTab(t,t.get("title"))}.bind(this)),this.tabEmpower.pages.map(function(t){var e=t.tabNode.setStyle("cursor","pointer");e.addEvent("click",function(){this.addClass("mainColor_bg"),this.getSiblings().removeClass("mainColor_bg")}.bind(e))}.bind(this)),this.options.tabEmpower?(this.tabEmpower.pages[this.options.tab].showIm(),this.tabEmpower.pages[this.options.tab].tabNode.addClass("mainColor_bg")):(this.tabEmpower.pages[0].showIm(),this.tabEmpower.pages[0].tabNode.addClass("mainColor_bg"))}.bind(this)),this.loadEmpowerBtn(),this.loadMyEmPower(),this.loadReceiveEmPower(),this.loadMyEmPowerLog(),this.loadReceiveEmPowerLog()},loadEmpowerBtn:function(){var t=new Element("div.o2_profile_emPower_Btnimg"),e=new Element("div.o2_profile_emPower_Btntext"),o=new Element("div.o2_profile_emPower_Add").adopt(t.cloneNode(),e.cloneNode().set("text",this.lp.empower.addEmPower)),i=new Element("div.o2_profile_emPower_WithDraw").adopt(t.cloneNode(),e.cloneNode().set("text",this.lp.empower.withdraw));this.tabEmpower.tabNodeContainerArea.adopt(i,o),this.tabEmpower.tabNodeContainerArea.getElements(".o2_profile_emPower_Add").addEvent("click",function(){var t=new MWF.xApplication.Profile.emPowerPopupForm(null,{},{style:"empower",width:"550",height:layout.desktop.session.user.identityList.length>1?"490":"440",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,draggable:!0,maxAction:!0,closeAction:!0,isFull:!1,startTime:null,endTime:null,isWholeday:!1,title:"新建外出授权",defaultCalendarId:""},{app:this,container:this.content,lp:this.lp,actions:this.action,css:{}});layout.desktop.session.user.identityList.length>=1?t.create():this.notice(this.lp.empower.alert2,"error")}.bind(this)),this.tabEmpower.tabNodeContainerArea.getElements(".o2_profile_emPower_WithDraw").addEvent("click",function(){var t=this.tabEmpower.showPage.contentNode.getElements("td input[name=id]:checked"),e=0;t.forEach(function(t){this.action.deleteEmPower(t.get("value"),function(o){"success"==o.type&&(e+=1),t.getParent().getParent().getParent().destroy()}.bind(this),null,!1)}.bind(this)),0==t.length?this.notice(this.lp.empower.selectEmPower,"error"):t.length&&e==t.length&&this.notice(this.lp.empower.withdrawOk,"success"),1==this.myEmPower.getElements("tr").length&&this.myEmPowerNoDataDiv.setStyle("display","")}.bind(this))},loadMyEmPower:function(){this.myEmPower=this.tabEmpower.pages[0].contentNode,this.getAction(function(){this.action.getMyEmPower(function(t){var e=t.data;this.getEmPowerTable("myEmPower",e,this.myEmPower)}.bind(this))}.bind(this))},loadReceiveEmPower:function(){this.receiveEmPower=this.tabEmpower.pages[1].contentNode,this.getAction(function(){this.action.getReceiveEmPower(function(t){var e=t.data;this.getEmPowerTable("receiveEmPower",e,this.receiveEmPower)}.bind(this))}.bind(this))},loadMyEmPowerLog:function(){this.myEmPowerLog=this.tabEmpower.pages[2].contentNode,this.getEmPowerLogTable("myEmPowerLog","",this.myEmPowerLog)},loadReceiveEmPowerLog:function(){this.receiveEmPowerLog=this.tabEmpower.pages[3].contentNode,this.getEmPowerLogTable("receiveEmPowerLog","",this.receiveEmPowerLog)},getEmPowerLogTable:function(t,e,o){var i=this;new MWF.xApplication.Profile.Common.Content(o,{title:o.get("title"),searchItemList:[],columns:[{width:"30%",title:this.lp.empower.title,field:"subject",formatter:function(t,e){new Element("a",{text:t.title,style:"cursor:pointer"}).inject(e).addEvent("click",(function(e){var o={workId:t.work,appId:"process.Work"+t.work};i.desktop.openApplication(e,"process.Work",o)}))}},"myEmPowerLog"==t?{width:"10%",title:this.lp.empower.toPerson,field:"toPerson",formatter:function(t,e){new Element("div",{text:t.toPerson.split("@")[0]}).inject(e)}}:{width:"10%",title:this.lp.empower.fromPerson,field:"fromPerson",formatter:function(t,e){new Element("div",{text:t.fromPerson.split("@")[0]}).inject(e)}},{width:"15%",title:this.lp.empower.applicationName,field:"applicationName"},{width:"15%",title:this.lp.empower.processName,field:"processName"},{width:"15%",title:this.lp.empower.activityName,field:"activityName"},{width:"15%",title:this.lp.empower.createTime,field:"updateTime"}],opButtonList:[],onBeforeLoadData:function(){i.getAction(function(){"myEmPowerLog"==t?i.action.listWithCurrentPersonPaging(this.options.page,this.options.pageSize,"",function(t){this.dataList=t.data,this.total=t.count}.bind(this),null,!1):i.action.listToCurrentPersonPaging(this.options.page,this.options.pageSize,"",function(t){this.dataList=t.data,this.total=t.count}.bind(this),null,!1)}.bind(this))}}).load(),this[t+"NoDataDiv"]||(this[t+"NoDataDiv"]=new Element("div.o2_profile_emPower_noData").adopt(new Element("img",{src:"../x_component_Profile/$Main/newVersion/icon_wuweituo.png"}),new Element("div",{text:"无待办"})).inject(o.getElement(".profile_common_tableDiv"))),1==o.getElements("tr").length?this[t+"NoDataDiv"].setStyle("display",""):this[t+"NoDataDiv"]&&this[t+"NoDataDiv"].setStyle("display","none")},getEmPowerTable:function(t,e,o){this.emPowerTable=o.getElement("table.emPowerTable"),this.emPowerTable||(this.emPowerTable=new Element("table.emPowerTable",{width:"100%",border:"0",cellpadding:"0",cellspacing:"0"}).inject(o)),this.userName=layout.desktop.session.user.distinguishedName;var i=new Element("tr.first");if("myEmPower"==t){var n=new Element("div.o2_profile_emPower_Btnimg"),s=new Element("div.o2_profile_emPower_Btntext");this.emPowerData={};var a=new Element("label.o2_profile_empower_checkbox").adopt(new Element("input",{name:"allEmpower",id:"allEmpower",type:"checkbox"})).setStyle("float","left").addEvent("click",(function(){this.getElement("input").get("checked")?(this.getParent().getParent().getParent().getElements("input[type=checkbox]").set("checked",!0),this.getParent().getParent().getParent().getElements("label").addClass("o2_profile_empower_checkbox__checked o2_profile_empower_checkbox_checked"),this.getParent().getParent().getParent().getElements("tr").addClass("selected")):(this.getParent().getParent().getParent().getElements("input[type=checkbox]").set("checked",!1),this.getParent().getParent().getParent().getElements("label").removeClass("o2_profile_empower_checkbox__checked o2_profile_empower_checkbox_checked"),this.getParent().getParent().getParent().getElements("tr").removeClass("selected"))}));i.adopt(new Element("th",{width:"16%"}).adopt(a,new Element("div",{text:this.lp.empower.toPerson}).setStyle("float","left")))}else i.adopt(new Element("th",{width:"16%"}).adopt(new Element("div",{text:this.lp.empower.fromPerson})));i.adopt(new Element("th",{width:"7%"}).adopt(new Element("div",{text:this.lp.empower.type}))),i.adopt(new Element("th",{width:"16%"}).adopt(new Element("div",{text:this.lp.empower.applicationName+"/"+this.lp.empower.processName}))),i.adopt(new Element("th",{width:"18%"}).adopt(new Element("div",{text:this.lp.empower.startTime}))),i.adopt(new Element("th",{width:"18%"}).adopt(new Element("div",{text:this.lp.empower.completedTime}))),"myEmPower"==t&&i.adopt(new Element("th",{width:"25%"}).adopt(new Element("div",{text:"操作"}))),this.emPowerTable.adopt(i),e.forEach(function(e){var o=new Element("tr"+(e.enable?"":".disabled")),i=new Element("td"),a=new Element("label.o2_profile_empower_checkbox").adopt(new Element("input",{name:"id",value:e.id,type:"checkbox"})).setStyle("float","left").addEvent("click",(function(){this.getElement("input").get("checked")?(this.addClass("o2_profile_empower_checkbox__checked o2_profile_empower_checkbox_checked"),this.getParent().getParent().addClass("selected")):(this.removeClass("o2_profile_empower_checkbox__checked o2_profile_empower_checkbox_checked"),this.getParent().getParent().removeClass("selected"))})),l=[];"myEmPower"==t?(this.emPowerData[e.id]=e,l.push(i.cloneNode().adopt(a,new Element("div",{name:"toPerson",text:e.toPerson.split("@")[0]})))):l.push(i.cloneNode().adopt(new Element("div",{name:"fromPerson",text:e.fromPerson.split("@")[0]}))),l.push(i.cloneNode().adopt(new Element("div",{name:"type",text:this.lp.empower["type_"+e.type]}))),l.push(i.cloneNode().adopt(new Element("div",{name:"typeName",text:e.applicationName||e.processName||("filter"==e.type?JSON.parse(e.filterListData)[0].value:"-")}))),l.push(i.cloneNode().adopt(new Element("div",{name:"startTime",text:e.startTime}))),l.push(i.cloneNode().adopt(new Element("div",{name:"completedTime",text:e.completedTime})));var r=this;if("myEmPower"==t){new Date(e.completedTime),new Date(e.startTime),new Date;var d=e.enable?"o2_profile_emPower_Disable":"o2_profile_emPower_Enable",c=e.enable?r.lp.empower.disable:r.lp.empower.enable,h=new Element("div."+d).adopt(n.cloneNode(),s.cloneNode().set("text",c)).addEvent("click",function(){this.enable=!this.enable,r.action.editEmPower(this.id,this,function(t){this.notice(this.lp.empower.saveOk,t.type),this.content.getElement(".o2_profile_emPower_tab").getElement("table").empty(),this.loadMyEmPower()}.bind(r),null,!1)}.bind(e));l.push(i.cloneNode().setStyles({margin:"auto"}).adopt(new Element("div.o2_profile_emPower_Edit").adopt(n.cloneNode(),s.cloneNode().set("text",this.lp.empower.edit)).addEvent("click",function(t){this.fromPerson=this.fromIdentity,this.toPerson=this.toIdentity,this.startTime=this.startTime,this.endTime=this.completedTime,new MWF.xApplication.Profile.emPowerPopupForm(null,this,{style:"empower",width:"550",height:layout.desktop.session.user.identityList.length>1?"490":"440",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,draggable:!0,maxAction:!0,closeAction:!0,isFull:!1,startTime:null,endTime:null,isWholeday:!1,title:r.lp.empower.editEmpower,configData:{Process:"process"==this.type?[{name:this.processName,id:this.process,editon:this.edition}]:[],Application:"application"==this.type?[{name:this.applicationName,id:this.application}]:[]},defaultCalendarId:""},{app:r,container:r.content,lp:r.lp,actions:r.action,css:{}}).edit()}.bind(e)),h,new Element("div.o2_profile_emPower_WithDraw").adopt(n.cloneNode(),s.cloneNode().set("text",this.lp.empower.withdraw)).set("empowerid",e.id).addEvent("click",(function(){var t=this;r.action.deleteEmPower(t.get("empowerid"),function(e){this.notice(this.lp.empower.withdrawOk,e.type),t.getParent().getParent().destroy()}.bind(r),null,!1)}))))}o.adopt(l),this.emPowerTable.adopt(o)}.bind(this)),this[t+"NoDataDiv"]||(this[t+"NoDataDiv"]=new Element("div.o2_profile_emPower_noData").adopt(new Element("img",{src:"../x_component_Profile/$Main/newVersion/icon_wuweituo.png"}),new Element("div",{text:this.lp.empower.noData}),"myEmPower"==t?new Element("div.o2_profile_emPower_Add.mainColor_color",{text:"新建委托"}).addEvent("click",function(){var t=new MWF.xApplication.Profile.emPowerPopupForm(null,{},{style:"empower",width:"550",height:layout.desktop.session.user.identityList.length>1?"490":"440",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,draggable:!0,maxAction:!0,closeAction:!0,isFull:!1,startTime:null,endTime:null,isWholeday:!1,title:"新建外出授权",defaultCalendarId:""},{app:this,container:this.content,lp:this.lp,actions:this.action,css:{}});layout.desktop.session.user.identityList.length>=1?t.create():this.notice(this.lp.empower.alert2,"error")}.bind(this)):"").inject(o)),1==this.emPowerTable.getElements("tr").length?this[t+"NoDataDiv"].setStyle("display",""):this[t+"NoDataDiv"]&&this[t+"NoDataDiv"].setStyle("display","none")},loadPasswordConfigActions:function(){var t=this.inBrowser||"Default"==layout.viewMode?3:4,e=this.tab.pages[t].contentNode.setStyle("min-height","300px").getElements("input");this.oldPasswordInputNode=e[0],this.passwordInputNode=e[1],this.morePasswordInputNode=e[2],this.savePasswordAction=this.tab.pages[t].contentNode.getElement(".o2_profile_savePasswordAction"),this.oldPasswordInputNode.addEvents({blur:function(){this.removeClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")},focus:function(){this.addClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")}}),this.passwordInputNode.addEvents({blur:function(){this.removeClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")},focus:function(){this.addClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")},keyup:function(){this.checkPassowrdStrength(encodeURIComponent(this.passwordInputNode.get("value")))}.bind(this)}),this.morePasswordInputNode.addEvents({blur:function(){this.removeClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")},focus:function(){this.addClass("o2_profile_inforContentInput_focus mainColor_border mainColor_color")}}),this.savePasswordAction.addEvent("click",function(){this.changePassword()}.bind(this)).addClass("mainColor_bg")},loadSSOConfigAction:function(){var t=this.inBrowser||"Default"==layout.viewMode?4:5;this.ssoConfigAreaNode=this.tab.pages[t].contentNode.setStyle("min-height","300px").getElement(".o2_profile_ssoConfigArea"),MWF.Actions.get("x_organization_assemble_authentication").listOauthServer(function(t){t.data.each(function(t){new Element("a",{class:"mainColor_color",styles:{"font-size":"14px",display:"block","margin-bottom":"10px"},text:t.displayName,target:"_blank",href:"../x_desktop/oauth.html?oauth="+encodeURIComponent(t.name)+"&redirect=&method=oauthBind"}).inject(this.ssoConfigAreaNode)}.bind(this))}.bind(this))},changeIcon:function(){var t="668",e="510";t=t.toInt(),e=e.toInt();var o=this.content.getSize(),i=(o.x-t)/2,n=(o.y-e)/2;i<0&&(i=0),n<0&&(n=0),layout.mobile&&(i=20,n=0);var s=this;MWF.require("MWF.xDesktop.Dialog",function(){MWF.require("MWF.widget.ImageClipper",function(){var o=new MWF.xDesktop.Dialog({title:this.lp.changePersonIcon,style:"image",top:n,left:i-20,fromTop:n,fromLeft:i-20,width:t,height:e,html:"<div></div>",maskNode:this.content,container:this.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){s.image.uploadImage(function(t){s.action.getPerson(function(t){t.data&&(this.personData=t.data,s.contentImgNode.set("src",s.action.getPersonIcon())),this.close()}.bind(this))}.bind(this),null)}},{text:MWF.LP.process.button.cancel,action:function(){s.image=null,this.close()}}]});o.show(),this.image=new MWF.widget.ImageClipper(o.content.getFirst(),{aspectRatio:1,description:"",imageUrl:this.action.getPersonIcon(),resetEnable:!1,data:null,parameter:null,action:this.action.action,method:"changeIcon"}),this.image.load()}.bind(this))}.bind(this))},uploadPersonIcon:function(){this.image&&this.image.getResizedImage()&&this.action.changeIcon(function(){this.action.getPerson(function(t){t.data&&(this.personData=t.data,this.contentImgNode.set("src",this.action.getPersonIcon()))}.bind(this))}.bind(this),null,this.image.getFormData(),this.image.resizedImage)},savePersonInfor:function(){this.personData.officePhone=this.officePhoneInputNode.get("value"),this.personData.mail=this.mailInputNode.get("value"),this.personData.mobile=this.mobileInputNode.get("value"),this.personData.weixin=this.weixinInputNode.get("value"),this.personData.qq=this.qqInputNode.get("value"),this.personData.ipAddress=this.ipAddressInputNode.get("value"),this.personData.signature=this.signatureInputNode.get("value"),this.action.updatePerson(this.personData,function(){this.notice(this.lp.saveInforOk,"success")}.bind(this))},loadDesktopBackground:function(t){var e=layout.desktop.options.style;MWF.UD.getDataJson("layoutDesktop",function(t){t&&(e=t.src)}.bind(this),!1),MWF.getJSON(layout.desktop.path+"styles.json",function(o){o.each(function(o){var i=MWF.defaultPath+"/xDesktop/$Layout/"+o.style+"/preview.jpg",n=new Element("div.o2_profile_previewBackground").inject(t);e==o.style&&(new Element("img.icon",{src:"../x_component_Profile/$Main/newVersion/icon_ok2_click_copy_2.png"}).inject(n),n.addClass("profile_previewBackground_current")),new Element("img",{src:i}).inject(n),n.store("dskimg",o.style);var s=this;n.addEvent("click",(function(){s.selectDesktopImg(this,t)}))}.bind(this))}.bind(this))},selectDesktopImg:function(t,e){var o=t.retrieve("dskimg");MWF.UD.putData("layoutDesktop",{src:o},function(){e.getChildren().each(function(t){t.removeClass("profile_previewBackground_current"),t.getElement(".icon")&&t.getElement(".icon").destroy()}.bind(this)),new Element("img.icon",{src:"../x_component_Profile/$Main/newVersion/icon_ok2_click_copy_2.png"}).inject(t),t.addClass("profile_previewBackground_current");var i=MWF.defaultPath+"/xDesktop/$Layout/"+o+"/desktop.jpg";layout.desktop.node.setStyle("background-image","url("+i+")")}.bind(this))},changePassword:function(){var t=this.oldPasswordInputNode.get("value"),e=this.passwordInputNode.get("value"),o=this.morePasswordInputNode.get("value"),i=this.contentNode.getElement(".o2_profile_passwordWarmming");if(e!=o)this.notice(this.lp.passwordNotMatch,"error"),this.passwordInputNode.setStyles(this.css.inforContentInputNode_error),this.morePasswordInputNode.setStyles(this.css.inforContentInputNode_error);else if(i)this.notice(i.get("text"),"error");else if(this.action.changePassword(t,e,o,function(){this.oldPasswordInputNode.set("value",""),this.passwordInputNode.set("value",""),this.morePasswordInputNode.set("value",""),this.notice(this.lp.changePasswordOk,"success")}.bind(this)),layout.config.mail){var n="http://"+layout.config.mail+"//names.nsf?changepassword&password="+encodeURIComponent(t)+"&passwordnew="+encodeURIComponent(e)+"&passwordconfirm="+encodeURIComponent(e),s=new Element("iframe",{styles:{display:"none"}}).inject(this.desktop.desktopNode);s.set("src",n),window.setTimeout(function(){s.destroy()}.bind(this),2e3)}},getAction:function(t){this.acrion||(this.action=MWF.Actions.get("x_organization_assemble_personal")),t&&t()},createPasswordStrengthNode:function(){var t=this.passwordRemindContainer,e=new Element("div",{styles:this.css.passwordStrengthNode}).inject(t);this.lowColorNode=new Element("div",{styles:this.css.passwordStrengthColor}).inject(e),this.lowTextNode=new Element("div",{styles:this.css.passwordStrengthText,text:this.lp.weak}).inject(e);var o=new Element("div",{styles:this.css.passwordStrengthNode}).inject(t);this.middleColorNode=new Element("div",{styles:this.css.passwordStrengthColor}).inject(o),this.middleTextNode=new Element("div",{styles:this.css.passwordStrengthText,text:this.lp.middle}).inject(o);var i=new Element("div",{styles:this.css.passwordStrengthNode}).inject(t);this.highColorNode=new Element("div",{styles:this.css.passwordStrengthColor}).inject(i),this.highTextNode=new Element("div",{styles:this.css.passwordStrengthText,text:this.lp.high}).inject(i)},getPasswordLevel:function(t,e){this.getAction(function(){this.action.checkPassword(t,function(t){e&&e(t.data.value)}.bind(this),null,!1)}.bind(this))},getPasswordComplex:function(t){if("string"!=typeof t)return!1;var e=0;t.length<8?e+=5:t.length<=10?e+=10:e+=25;var o=/[a-z]/,i=/[A-Z]/;t.match(o)&&t.match(i)?e+=25:t.match(o)||t.match(i)?e+=10:e+=0;return t.match(/[0-9]{3,}/)?e+=20:t.match(/[0-9]/)?e+=10:e+=0,e},checkPassowrdStrength:function(t){var e=this.inBrowser||"Default"==layout.viewMode?3:4,o=this.tab.pages[e].contentNode.getElement(".o2_profile_passwordStrengthArea"),i=this.tab.pages[e].contentNode.getElement(".o2_profile_passwordRemindNode"),n=o.getElements(".o2_profile_passwordStrengthColor"),s=n[0],a=n[1],l=n[2],r=(n=o.getElements(".o2_profile_passwordStrengthText"))[0],d=n[1],c=n[2];s.removeClass("o2_profile_passwordStrengthColor_low"),a.removeClass("o2_profile_passwordStrengthColor_middle"),l.removeClass("o2_profile_passwordStrengthColor_high"),r.removeClass("o2_profile_passwordStrengthText_current"),d.removeClass("o2_profile_passwordStrengthText_current"),c.removeClass("o2_profile_passwordStrengthText_current"),null==t||""==t||this.getPasswordLevel(t,function(e){if(e)i.addClass("o2_profile_passwordWarmming").set("text",e);else{var o=layout.config.passwordRegexHint||this.lp.paswordRule;i.removeClass("o2_profile_passwordWarmming").set("text",o);var n=this.getPasswordComplex(t);n<=40?(s.addClass("o2_profile_passwordStrengthColor_low"),r.addClass("o2_profile_passwordStrengthText_current")):n<=55?(a.addClass("o2_profile_passwordStrengthColor_middle"),d.addClass("o2_profile_passwordStrengthText_current")):(l.addClass("o2_profile_passwordStrengthColor_high"),c.addClass("o2_profile_passwordStrengthText_current"))}}.bind(this))}}),MWF.xDesktop.requireApp("Template","MPopupForm",null,!1),MWF.xApplication.Profile.emPowerPopupForm=new Class({Extends:MPopupForm,options:{style:"empower",width:"550",height:"440",hasTop:!0,hasIcon:!1,hasTopIcon:!1,hasTopContent:!1,draggable:!0,maxAction:!0,closeAction:!0,isFull:!1,startTime:null,endTime:null,isWholeday:!1,defaultCalendarId:"",onPostCreateBottom:function(){this.formBottomNode.getElement(".formOkActionNode").addClass("mainColor_bg")}},load:function(){this.cssPath="../x_component_Profile/$Main/"+this.options.style+"/css.wcss",this._loadCss(),this.configData=this.options.configData||{},this.lp=this.lp.empower},_createTableContent:function(){this.userName=layout.desktop.session.user.distinguishedName,this.userId=layout.desktop.session.user.id,this.userIdentityList=layout.desktop.session.user.identityList;var t,e,o,i,n,s,a=[],l=[];this.userIdentityList.each((function(t){a.push(t.name+"("+t.unitName+")"),l.push(t.distinguishedName)})),this.data.startTime&&this.data.endTime?(t=this.date="string"==typeOf(this.data.startTime)?Date.parse(this.data.startTime):this.data.startTime,e="string"==typeOf(this.data.endTime)?Date.parse(this.data.endTime):this.data.endTime,o=t.format("%Y-%m-%d"),i=t.format("%H:%M"),n=e.format("%Y-%m-%d"),s=e.format("%H:%M")):(e=(t=this.date=(new Date).increment("hour",1)).clone().increment("hour",1),o=t.format("%Y-%m-%d"),i=t.format("%H")+":00",n=e.format("%Y-%m-%d"),s=e.format("%H")+":00");var r={};this.formTableArea.set("html",this.getHtml()),MWF.xDesktop.requireApp("Template","MForm",function(){this.form=new MForm(this.formTableArea,r,{isEdited:this.isEdited||this.isNew,style:"profile",itemTemplate:{fromPerson:{text:this.lp.fromPerson,type:"select",isEdited:a.length>1,selectText:a,selectValue:l,defaultValue:this.data.fromIdentity||l[0],style:{width:"310px",height:"36px","box-shadow":"rgb(153, 153, 153) 0px 0px 0px","line-height":"36px",background:"#FFFFFF",border:"1px solid #DEDEDE","border-radius":"100px","font-family":"MicrosoftYaHei",padding:"0 5px","font-size":"14px",color:"#666666",margin:"0 0 10px 0"}},toPerson:{text:this.lp.toPerson,type:"org",isEdited:this.isEdited||this.isNew,orgType:["identity"],count:1,orgWidgetOptions:{onLoadedInfor:function(t){}.bind(this)},defaultValue:this.data.toPerson},startDateInput:{text:this.lp.startTime,tType:"date",defaultValue:o,notEmpty:!0},startTimeInput:{tType:"time",defaultValue:i,className:(this.isNew||this.isEdited,"inputTimeUnformatWidth"),disable:r.isAllDayEvent},endDateInput:{text:this.lp.completedTime,tType:"date",defaultValue:n,notEmpty:!0},endTimeInput:{tType:"time",defaultValue:s,className:(this.isNew||this.isEdited,"inputTimeUnformatWidth"),disable:r.isAllDayEvent},type:{text:this.lp.type,type:"radio",selectText:[this.lp.type_all,this.lp.type_application,this.lp.type_process],selectValue:["all","application","process"],defaultValue:this.data.type||"all",event:{click:function(){var t=this.form.getItem("type").getValue();this.formTableArea.getElement("td[item=application]").parentNode.setStyle("display","none"),this.formTableArea.getElement("td[item=process]").parentNode.setStyle("display","none"),"all"==t||this.formTableArea.getElement("td[item="+t+"]").parentNode.setStyle("display","")}.bind(this)}}},onPostLoad:function(){this.formTableArea.getElements("td[item=type] div").forEach((function(t){var e=new Element("label.o2_profile_empower_radio"+(t.getElement("input").get("checked")?".o2_profile_empower_radio__checked.o2_profile_empower_radio_checked":"")).adopt(t.getElement("input")).addEvent("click",(function(){this.getParent().getParent().getElements("label").removeClass("o2_profile_empower_radio__checked o2_profile_empower_radio_checked"),this.addClass("o2_profile_empower_radio__checked o2_profile_empower_radio_checked")}));t.adopt(e,t.getElement("span"))}))}.bind(this)},this.app,this.css),this.form.load()}.bind(this)),this.applicationNode=this.formTableArea.getElement("td[item=application]"),this.selectApplicationNode=new Element("div.selectNode",{width:"30",height:"30"}).inject(this.applicationNode).setStyles(this.css.selectNode).addEvents({hover:function(){this.setStyle("background","url(../x_component_Profile/$Main/newVersion/icon_zengjia_blue2_click.png) center center no-repeat")},blur:function(){this.setStyle("background","url(../x_component_Profile/$Main/newVersion/icon_zengjia_blue2.png) center center no-repeat")}}),this.showApplicationNode=new Element("div.showNode",{width:"200",height:"30"}).inject(this.applicationNode).setStyles(this.css.showNode),this.createApplicationSelect(this.showApplicationNode,this.selectApplicationNode,"Application"),this.processNode=this.formTableArea.getElement("td[item=process]"),this.selectProcessNode=new Element("div.selectNode",{width:"30",height:"30"}).inject(this.processNode).setStyles(this.css.selectNode),this.showProcessNode=new Element("div.showNode",{width:"200",height:"30"}).inject(this.processNode).setStyles(this.css.showNode),this.createApplicationSelect(this.showProcessNode,this.selectProcessNode,"Process")},_ok:function(t,e){var o=[],i={};i.fromIdentity=t.fromPerson,i.fromPerson=t.fromPerson.split("@")[0],i.toIdentity=t.toPerson,i.toPerson=t.toPerson.split("@")[0],i.startTime=t.startDateInput+" "+t.startTimeInput+":00",i.completedTime=t.endDateInput+" "+t.endTimeInput+":00",i.enable=!0,"all"==t.type?(i.type=t.type,o.push(i)):"application"==t.type?this.configData.Application.forEach((function(t){var e=JSON.parse(JSON.stringify(i));e.application=t.id,e.applicationName=t.name,e.applicationAlias=t.alias,e.type="application",o.push(e)})):"process"==t.type&&this.configData.Process.forEach((function(t){var e=JSON.parse(JSON.stringify(i));e.process=t.id,e.processName=t.name,e.processAlias=t.alias,e.edition=t.edition?t.edition:t.id,e.type="process",o.push(e)}));var n=0;(o.forEach(function(t){this.data.id&&0==n?this.actions.editEmPower(this.data.id,t,function(t){n++}.bind(this),null,!1):this.actions.createEmPower(t,function(t){n++}.bind(this),null,!1)}.bind(this)),o.length||this.app.notice(this.lp.alert1,"error"),n>0)&&(this.container.getElement(".o2_profile_emPower_tab").getElement("table").empty(),this.app.loadMyEmPower());o.length&&n==o.length?(this.app.notice(this.lp.saveOk,"success"),this.close()):n>0&&(this.app.notice(this.lp.saveNotAll,"error"),this.close())},createApplicationSelect:function(t,e,o){this.configData[o]&&this.configData[o].length?MWF.require("MWF.widget.O2Identity",function(){new MWF.widget.O2Process(this.configData[o][0],t)}.bind(this)):this.configData[o]=[],e.addEvent("click",function(){MWF.xDesktop.requireApp("Selector","package",function(){var e={type:o,values:this.configData[o],count:0,onComplete:function(e){t.empty(),this[o]={},this.configData[o]=[],e.forEach(function(e,i){MWF.require("MWF.widget.O2Identity",function(){new MWF.widget.O2Process(e.data,t);this[o]={name:e.data.name,id:e.data.id,edition:e.data.edition,application:e.data.application,applicationName:e.data.applicationName,alias:e.data.alias},this.configData[o].include(this[o])}.bind(this))}.bind(this))}.bind(this)};new MWF.O2Selector(this.container,e)}.bind(this))}.bind(this))},getHtml:function(){return"<table width='100%' bordr='0' cellpadding='0' cellspacing='0' styles='formTable' id='empowerEditTable'><tr style='display:"+(this.userIdentityList.length>1?"":"none")+"'><td styles='formTableTitleRight' lable='fromPerson'></td>    <td styles='formTableValue' colspan='2'>       <div item='fromPerson'></div>   </td></tr><tr><td styles='formTableTitleRight' lable='toPerson'></td>    <td styles='formTableValue' colspan='2'>       <div item='toPerson'></div>   </td></tr><tr><td styles='formTableTitleRight' width='100' lable='startDateInput'></td>    <td styles='formTableValue' item='startDateInput' width='205'></td>    <td styles='formTableValue' item='startTimeInput'></td></tr><tr><td styles='formTableTitleRight' lable='endDateInput'></td>    <td styles='formTableValue' item='endDateInput'></td>    <td styles='formTableValue' item='endTimeInput'></td></tr><tr><td styles='formTableTitleRight' ></td>    <td styles='formTableValue' item='type' colspan='2'></td></tr><tr style='display:"+("application"==this.data.type?"":"none")+"'><td styles='formTableTitleRight' lable='application'>"+this.lp.application+"</td>    <td styles='formTableValue1' item='application' colspan='2'></td></tr><tr style='display:"+("process"==this.data.type?"":"none")+"'><td styles='formTableTitleRight' lable='process'>"+this.lp.process+"</td>    <td styles='formTableValue1' item='process' colspan='2'></td></tr></table>"}});